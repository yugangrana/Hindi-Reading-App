import { useState, useEffect, useRef, useCallback } from "react";

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GLOBAL STYLES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const STYLES = `
  @import url('https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;700;800&family=Noto+Sans+Devanagari:wght@400;600;700;800;900&display=swap');
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: 'Baloo 2', sans-serif; background: #FFF9F0; -webkit-tap-highlight-color: transparent; }
  .hin { font-family: 'Noto Sans Devanagari', sans-serif; }
  input, select, button, textarea { font-family: 'Baloo 2', sans-serif; }
  @keyframes fadeUp  { from{opacity:0;transform:translateY(18px)} to{opacity:1;transform:translateY(0)} }
  @keyframes pop     { 0%{transform:scale(.6);opacity:0} 75%{transform:scale(1.1)} 100%{transform:scale(1);opacity:1} }
  @keyframes bounce  { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-12px)} }
  @keyframes pulse   { 0%,100%{transform:scale(1);opacity:1} 50%{transform:scale(1.15);opacity:.7} }
  @keyframes spin    { to{transform:rotate(360deg)} }
  @keyframes ripple  { 0%{transform:scale(0);opacity:.6} 100%{transform:scale(3);opacity:0} }
  @keyframes recDot  { 0%,100%{opacity:1} 50%{opacity:.2} }
  @keyframes barAnim { 0%,100%{transform:scaleY(.3)} 50%{transform:scaleY(1)} }
  @keyframes micRing { 0%{box-shadow:0 0 0 0 rgba(229,57,53,.6)} 70%{box-shadow:0 0 0 16px rgba(229,57,53,0)} 100%{box-shadow:0 0 0 0 rgba(229,57,53,0)} }
  .fade-up { animation: fadeUp .3s ease forwards; }
  .pop-in  { animation: pop .4s cubic-bezier(.4,2,.55,1) forwards; }
  .bounce  { animation: bounce 1.5s ease-in-out infinite; }
  .pulse   { animation: pulse 1s ease-in-out infinite; }
  .spin    { animation: spin 1s linear infinite; }
  .press:active { transform: scale(.94); transition: transform .1s; }
  ::-webkit-scrollbar { width:4px; height:4px; }
  ::-webkit-scrollbar-thumb { background:#FF7043; border-radius:4px; }
  input:focus { outline: none; }
  select:focus { outline: none; }
`;

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DATA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const LEVELS = [
  { id:"bv1", label:"à¤¬à¤¾à¤²à¤µà¤¾à¤Ÿà¤¿à¤•à¤¾ à¥§", en:"Balvatika 1", age:"3â€“4 yrs", color:"#FF7043", bg:"#FBE9E7", icon:"ğŸŒ±" },
  { id:"bv2", label:"à¤¬à¤¾à¤²à¤µà¤¾à¤Ÿà¤¿à¤•à¤¾ à¥¨", en:"Balvatika 2", age:"4â€“5 yrs", color:"#43A047", bg:"#E8F5E9", icon:"ğŸŒ¿" },
  { id:"bv3", label:"à¤¬à¤¾à¤²à¤µà¤¾à¤Ÿà¤¿à¤•à¤¾ à¥©", en:"Balvatika 3", age:"5â€“6 yrs", color:"#1E88E5", bg:"#E3F2FD", icon:"ğŸŒ»" },
  { id:"c1",  label:"à¤•à¤•à¥à¤·à¤¾ à¥§",     en:"Class 1",    age:"6â€“7 yrs", color:"#8E24AA", bg:"#F3E5F5", icon:"â­" },
  { id:"c2",  label:"à¤•à¤•à¥à¤·à¤¾ à¥¨",     en:"Class 2",    age:"7â€“8 yrs", color:"#E53935", bg:"#FFEBEE", icon:"ğŸ†" },
];

const SWAR = [
  {a:"à¤…",eg:"à¤…à¤¨à¤¾à¤°",em:"ğŸ"},{a:"à¤†",eg:"à¤†à¤®",em:"ğŸ¥­"},{a:"à¤‡",eg:"à¤‡à¤®à¤²à¥€",em:"ğŸŒ¿"},
  {a:"à¤ˆ",eg:"à¤ˆà¤–",em:"ğŸ‹"},{a:"à¤‰",eg:"à¤‰à¤²à¥à¤²à¥‚",em:"ğŸ¦‰"},{a:"à¤Š",eg:"à¤Šà¤¨",em:"ğŸ§¶"},
  {a:"à¤",eg:"à¤à¤¡à¤¼à¥€",em:"ğŸ¦¶"},{a:"à¤",eg:"à¤à¤¨à¤•",em:"ğŸ‘“"},{a:"à¤“",eg:"à¤“à¤¸",em:"ğŸ’§"},
  {a:"à¤”",eg:"à¤”à¤œà¤¾à¤°",em:"ğŸ”§"},{a:"à¤…à¤‚",eg:"à¤…à¤‚à¤—à¥‚à¤°",em:"ğŸ‡"},{a:"à¤…à¤ƒ",eg:"à¤…à¤‚à¤¤",em:"ğŸ”š"},
];

const VYANJAN = [
  {a:"à¤•",eg:"à¤•à¤®à¤²",em:"ğŸª·"},{a:"à¤–",eg:"à¤–à¤°à¤—à¥‹à¤¶",em:"ğŸ°"},{a:"à¤—",eg:"à¤—à¤¾à¤¯",em:"ğŸ„"},
  {a:"à¤˜",eg:"à¤˜à¤°",em:"ğŸ "},{a:"à¤š",eg:"à¤šà¤¾à¤à¤¦",em:"ğŸŒ™"},{a:"à¤›",eg:"à¤›à¤¾à¤¤à¤¾",em:"â˜‚ï¸"},
  {a:"à¤œ",eg:"à¤œà¤¹à¤¾à¤œ",em:"âœˆï¸"},{a:"à¤",eg:"à¤à¤‚à¤¡à¤¾",em:"ğŸš©"},{a:"à¤Ÿ",eg:"à¤Ÿà¤®à¤¾à¤Ÿà¤°",em:"ğŸ…"},
  {a:"à¤ ",eg:"à¤ à¤‚à¤¡",em:"â„ï¸"},{a:"à¤¡",eg:"à¤¡à¤®à¤°à¥‚",em:"ğŸ¥"},{a:"à¤¢",eg:"à¤¢à¥‹à¤²",em:"ğŸª˜"},
  {a:"à¤¤",eg:"à¤¤à¤°à¤¬à¥‚à¤œ",em:"ğŸ‰"},{a:"à¤¥",eg:"à¤¥à¤¾à¤²à¥€",em:"ğŸ½ï¸"},{a:"à¤¦",eg:"à¤¦à¤¹à¥€",em:"ğŸ¥›"},
  {a:"à¤§",eg:"à¤§à¤¨à¥à¤·",em:"ğŸ¹"},{a:"à¤¨",eg:"à¤¨à¤²",em:"ğŸš°"},{a:"à¤ª",eg:"à¤ªà¤¤à¤‚à¤—",em:"ğŸª"},
  {a:"à¤«",eg:"à¤«à¤²",em:"ğŸŠ"},{a:"à¤¬",eg:"à¤¬à¤¤à¥à¤¤à¤–",em:"ğŸ¦†"},{a:"à¤­",eg:"à¤­à¤¾à¤²à¥‚",em:"ğŸ»"},
  {a:"à¤®",eg:"à¤®à¤›à¤²à¥€",em:"ğŸŸ"},{a:"à¤¯",eg:"à¤¯à¤¾à¤¨",em:"ğŸš€"},{a:"à¤°",eg:"à¤°à¤¥",em:"ğŸ "},
  {a:"à¤²",eg:"à¤²à¤¡à¥à¤¡à¥‚",em:"ğŸŸ¡"},{a:"à¤µ",eg:"à¤µà¤°à¥à¤·à¤¾",em:"ğŸŒ§ï¸"},{a:"à¤¶",eg:"à¤¶à¥‡à¤°",em:"ğŸ¦"},
  {a:"à¤¸",eg:"à¤¸à¥‡à¤¬",em:"ğŸ"},{a:"à¤¹",eg:"à¤¹à¤¾à¤¥à¥€",em:"ğŸ˜"},
];

const MATRAS = [
  {sym:"à¤¾",name:"à¤† à¤•à¥€ à¤®à¤¾à¤¤à¥à¤°à¤¾",eg:"à¤•à¤¾à¤®",color:"#FF7043"},
  {sym:"à¤¿",name:"à¤‡ à¤•à¥€ à¤®à¤¾à¤¤à¥à¤°à¤¾",eg:"à¤•à¤¿à¤²à¤¾",color:"#43A047"},
  {sym:"à¥€",name:"à¤ˆ à¤•à¥€ à¤®à¤¾à¤¤à¥à¤°à¤¾",eg:"à¤¨à¤¦à¥€",color:"#1E88E5"},
  {sym:"à¥",name:"à¤‰ à¤•à¥€ à¤®à¤¾à¤¤à¥à¤°à¤¾",eg:"à¤¸à¥à¤¨",color:"#FB8C00"},
  {sym:"à¥‚",name:"à¤Š à¤•à¥€ à¤®à¤¾à¤¤à¥à¤°à¤¾",eg:"à¤­à¥‚à¤²",color:"#8E24AA"},
  {sym:"à¥‡",name:"à¤ à¤•à¥€ à¤®à¤¾à¤¤à¥à¤°à¤¾",eg:"à¤¦à¥‡à¤¶",color:"#00897B"},
  {sym:"à¥ˆ",name:"à¤ à¤•à¥€ à¤®à¤¾à¤¤à¥à¤°à¤¾",eg:"à¤ªà¥ˆà¤¸à¤¾",color:"#E53935"},
  {sym:"à¥‹",name:"à¤“ à¤•à¥€ à¤®à¤¾à¤¤à¥à¤°à¤¾",eg:"à¤®à¥‹à¤°",color:"#D81B60"},
  {sym:"à¥Œ",name:"à¤” à¤•à¥€ à¤®à¤¾à¤¤à¥à¤°à¤¾",eg:"à¤ªà¥Œà¤§à¤¾",color:"#6D4C41"},
];

const WORDS = [
  {w:"à¤•à¤®à¤²",m:"Lotus",em:"ğŸª·"},{w:"à¤¨à¤²",m:"Tap",em:"ğŸš°"},{w:"à¤˜à¤°",m:"Home",em:"ğŸ "},
  {w:"à¤«à¤²",m:"Fruit",em:"ğŸ"},{w:"à¤œà¤²",m:"Water",em:"ğŸ’§"},{w:"à¤®à¤¨",m:"Mind",em:"ğŸ§ "},
  {w:"à¤ªà¤²",m:"Moment",em:"â±ï¸"},{w:"à¤°à¤¥",m:"Chariot",em:"ğŸ "},{w:"à¤¹à¤²",m:"Plough",em:"âš’ï¸"},
  {w:"à¤•à¤®à¤°à¤¾",m:"Room",em:"ğŸšª"},{w:"à¤¸à¤¡à¤¼à¤•",m:"Road",em:"ğŸ›£ï¸"},{w:"à¤¬à¤—à¥€à¤šà¤¾",m:"Garden",em:"ğŸŒ¸"},
  {w:"à¤ªà¤¾à¤¨à¥€",m:"Water",em:"ğŸ’§"},{w:"à¤–à¤¾à¤¨à¤¾",m:"Food",em:"ğŸ›"},{w:"à¤•à¤¿à¤¤à¤¾à¤¬",m:"Book",em:"ğŸ“š"},
  {w:"à¤¬à¤šà¥à¤šà¤¾",m:"Child",em:"ğŸ‘¶"},{w:"à¤°à¥‹à¤Ÿà¥€",m:"Bread",em:"ğŸ«“"},{w:"à¤•à¤ªà¤¡à¤¼à¤¾",m:"Cloth",em:"ğŸ‘•"},
  {w:"à¤¸à¥‡à¤¬",m:"Apple",em:"ğŸ"},{w:"à¤—à¤¾à¤¯",m:"Cow",em:"ğŸ„"},{w:"à¤¶à¥‡à¤°",m:"Lion",em:"ğŸ¦"},
  {w:"à¤¹à¤¾à¤¥à¥€",m:"Elephant",em:"ğŸ˜"},{w:"à¤†à¤®",m:"Mango",em:"ğŸ¥­"},{w:"à¤¨à¤®à¤•",m:"Salt",em:"ğŸ§‚"},
  {w:"à¤¦à¥‚à¤§",m:"Milk",em:"ğŸ¥›"},{w:"à¤šà¤¾à¤¯",m:"Tea",em:"ğŸµ"},{w:"à¤šà¤¾à¤µà¤²",m:"Rice",em:"ğŸš"},
  {w:"à¤®à¤›à¤²à¥€",m:"Fish",em:"ğŸŸ"},{w:"à¤«à¥‚à¤²",m:"Flower",em:"ğŸŒ¸"},{w:"à¤ªà¤¤à¥à¤¤à¤¾",m:"Leaf",em:"ğŸƒ"},
];

const SENTENCES = [
  "à¤°à¤¾à¤® à¤–à¤¾à¤¨à¤¾ à¤–à¤¾à¤¤à¤¾ à¤¹à¥ˆà¥¤","à¤¸à¥€à¤¤à¤¾ à¤ªà¤¾à¤¨à¥€ à¤ªà¥€à¤¤à¥€ à¤¹à¥ˆà¥¤","à¤®à¥‹à¤¹à¤¨ à¤¸à¥à¤•à¥‚à¤² à¤œà¤¾à¤¤à¤¾ à¤¹à¥ˆà¥¤",
  "à¤—à¤¾à¤¯ à¤˜à¤¾à¤¸ à¤–à¤¾à¤¤à¥€ à¤¹à¥ˆà¥¤","à¤¬à¤šà¥à¤šà¥‡ à¤–à¥‡à¤²à¤¤à¥‡ à¤¹à¥ˆà¤‚à¥¤","à¤®à¤¾à¤ à¤–à¤¾à¤¨à¤¾ à¤¬à¤¨à¤¾à¤¤à¥€ à¤¹à¥ˆà¥¤",
  "à¤ªà¤•à¥à¤·à¥€ à¤†à¤•à¤¾à¤¶ à¤®à¥‡à¤‚ à¤‰à¤¡à¤¼à¤¤à¥‡ à¤¹à¥ˆà¤‚à¥¤","à¤¸à¥‚à¤°à¤œ à¤¸à¥à¤¬à¤¹ à¤‰à¤—à¤¤à¤¾ à¤¹à¥ˆà¥¤",
  "à¤¹à¤¾à¤¥à¥€ à¤¬à¤¡à¤¼à¤¾ à¤œà¤¾à¤¨à¤µà¤° à¤¹à¥ˆà¥¤","à¤¬à¤¿à¤²à¥à¤²à¥€ à¤¦à¥‚à¤§ à¤ªà¥€à¤¤à¥€ à¤¹à¥ˆà¥¤",
  "à¤•à¥à¤¤à¥à¤¤à¤¾ à¤­à¥Œà¤‚à¤•à¤¤à¤¾ à¤¹à¥ˆà¥¤","à¤®à¤›à¤²à¥€ à¤ªà¤¾à¤¨à¥€ à¤®à¥‡à¤‚ à¤°à¤¹à¤¤à¥€ à¤¹à¥ˆà¥¤",
];

const STORY = `à¤à¤• à¤¬à¤¾à¤° à¤à¤• à¤¶à¥‡à¤° à¤”à¤° à¤à¤• à¤šà¥‚à¤¹à¤¾ à¤¥à¥‡à¥¤\nà¤¶à¥‡à¤° à¤œà¤‚à¤—à¤² à¤®à¥‡à¤‚ à¤¸à¥‹ à¤°à¤¹à¤¾ à¤¥à¤¾à¥¤\nà¤šà¥‚à¤¹à¤¾ à¤‰à¤¸à¤•à¥‡ à¤Šà¤ªà¤° à¤¸à¥‡ à¤•à¥‚à¤¦ à¤—à¤¯à¤¾à¥¤\nà¤¶à¥‡à¤° à¤œà¤¾à¤— à¤—à¤¯à¤¾ à¤”à¤° à¤‰à¤¸à¥‡ à¤ªà¤•à¤¡à¤¼ à¤²à¤¿à¤¯à¤¾à¥¤\nà¤šà¥‚à¤¹à¥‡ à¤¨à¥‡ à¤•à¤¹à¤¾ â€” à¤®à¥à¤à¥‡ à¤›à¥‹à¤¡à¤¼ à¤¦à¥‹à¥¤\nà¤¶à¥‡à¤° à¤¹à¤à¤¸à¤¾ à¤”à¤° à¤‰à¤¸à¥‡ à¤œà¤¾à¤¨à¥‡ à¤¦à¤¿à¤¯à¤¾à¥¤\nà¤à¤• à¤¦à¤¿à¤¨ à¤¶à¥‡à¤° à¤œà¤¾à¤² à¤®à¥‡à¤‚ à¤«à¤à¤¸ à¤—à¤¯à¤¾à¥¤\nà¤šà¥‚à¤¹à¥‡ à¤¨à¥‡ à¤œà¤¾à¤² à¤•à¤¾à¤Ÿ à¤¦à¤¿à¤¯à¤¾à¥¤\nà¤¶à¥‡à¤° à¤†à¤œà¤¼à¤¾à¤¦ à¤¹à¥‹ à¤—à¤¯à¤¾à¥¤\nà¤¦à¥‹à¤¸à¥à¤¤à¥€ à¤¬à¤¡à¤¼à¥€ à¤šà¥€à¤œà¤¼ à¤¹à¥ˆà¥¤`;

const LEADERBOARD_DATA = [
  {name:"à¤ªà¥à¤°à¤¿à¤¯à¤¾ à¤¶à¤°à¥à¤®à¤¾",av:"ğŸ‘§",pts:1240,wpm:42,lvl:"Class 2",streak:7},
  {name:"à¤…à¤°à¥à¤œà¥à¤¨ à¤¸à¤¿à¤‚à¤¹", av:"ğŸ‘¦",pts:1180,wpm:39,lvl:"Class 2",streak:5},
  {name:"à¤®à¥€à¤°à¤¾ à¤ªà¤Ÿà¥‡à¤²",   av:"ğŸ‘§",pts:1050,wpm:35,lvl:"Class 1",streak:4},
  {name:"à¤°à¥‹à¤¹à¤¨ à¤—à¥à¤ªà¥à¤¤à¤¾", av:"ğŸ‘¦",pts:920, wpm:30,lvl:"Class 1",streak:3},
  {name:"à¤†à¤¯à¤¶à¤¾ à¤–à¤¾à¤¨",   av:"ğŸ‘§",pts:870, wpm:25,lvl:"BV 3",   streak:6},
  {name:"à¤¦à¥‡à¤µ à¤•à¥à¤®à¤¾à¤°",   av:"ğŸ‘¦",pts:760, wpm:22,lvl:"BV 3",   streak:2},
];

const BADGES = [
  {icon:"ğŸŒŸ",name:"à¤ªà¤¹à¤²à¤¾ à¤•à¤¦à¤®",   desc:"First lesson done",     pts:50 },
  {icon:"ğŸ“–",name:"à¤ªà¤¾à¤ à¤•",       desc:"10 lessons done",       pts:100},
  {icon:"âš¡",name:"à¤¤à¥‡à¤œà¤¼ à¤ªà¤¾à¤ à¤•",   desc:"Reached 30 WPM",       pts:150},
  {icon:"ğŸ”¥",name:"7-Day Streak",desc:"7 days in a row",      pts:200},
  {icon:"ğŸ…",name:"à¤¸à¥à¤µà¤° à¤µà¤¿à¤¦à¥à¤µà¤¾à¤¨",desc:"All Swar mastered",    pts:100},
  {icon:"ğŸ‘‘",name:"à¤¶à¤¬à¥à¤¦ à¤°à¤¾à¤œà¤¾",   desc:"100 words practised",  pts:200},
  {icon:"ğŸ¤",name:"Voice Star",  desc:"10 voice matches",     pts:150},
  {icon:"â™¾ï¸",name:"Endless Hero",desc:"50 endless questions", pts:300},
];

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   READING TEST DATA â€” 5 LEVELS, LARGE NON-REPEATING POOLS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

// Level 1 â€” individual letters/syllables shown as a tap-grid
const RT_LV1_POOL = [
  "à¤…","à¤†","à¤‡","à¤ˆ","à¤‰","à¤Š","à¤","à¤","à¤“","à¤”","à¤…à¤‚","à¤…à¤ƒ",
  "à¤•","à¤–","à¤—","à¤˜","à¤š","à¤›","à¤œ","à¤","à¤Ÿ","à¤ ","à¤¡","à¤¢",
  "à¤¤","à¤¥","à¤¦","à¤§","à¤¨","à¤ª","à¤«","à¤¬","à¤­","à¤®","à¤¯","à¤°",
  "à¤²","à¤µ","à¤¶","à¤¸","à¤¹","à¤","à¤£","à¤™","à¤·","à¤•à¥à¤·","à¤¤à¥à¤°","à¤œà¥à¤",
  "à¤•à¤¾","à¤•à¤¿","à¤•à¥€","à¤•à¥","à¤•à¥‚","à¤•à¥‡","à¤•à¥‹","à¤•à¥Œ","à¤•à¤‚",
  "à¤®à¤¾","à¤®à¤¿","à¤®à¥€","à¤®à¥","à¤®à¥‚","à¤®à¥‡","à¤®à¥‹","à¤®à¥Œ","à¤®à¤‚",
  "à¤°à¤¾","à¤°à¤¿","à¤°à¥€","à¤°à¥","à¤°à¥‚","à¤°à¥‡","à¤°à¥‹","à¤°à¥Œ","à¤°à¤‚",
  "à¤¸à¤¾","à¤¸à¤¿","à¤¸à¥€","à¤¸à¥","à¤¸à¥‚","à¤¸à¥‡","à¤¸à¥‹","à¤¸à¥Œ","à¤¸à¤‚",
  "à¤ªà¤¾","à¤ªà¤¿","à¤ªà¥€","à¤ªà¥","à¤ªà¥‚","à¤ªà¥‡","à¤ªà¥‹","à¤ªà¥Œ","à¤ªà¤‚",
  "à¤¨à¥€","à¤¨à¤¿","à¤¨à¤¾","à¤¨à¥","à¤¨à¥‚","à¤¨à¥‡","à¤¨à¥‹","à¤¨à¥Œ","à¤¨à¤‚",
  "à¤¤à¤¾","à¤¤à¤¿","à¤¤à¥€","à¤¤à¥","à¤¤à¥‚","à¤¤à¥‡","à¤¤à¥‹","à¤¤à¥Œ","à¤¤à¤‚",
  "à¤¬à¤¾","à¤¬à¤¿","à¤¬à¥€","à¤¬à¥","à¤¬à¥‚","à¤¬à¥‡","à¤¬à¥‹","à¤¬à¥Œ","à¤¬à¤‚",
];

// Level 2 â€” 2-letter words without matras (large pool of 60+)
const RT_LV2_POOL = [
  "à¤¨à¤²","à¤˜à¤°","à¤«à¤²","à¤œà¤²","à¤®à¤¨","à¤ªà¤²","à¤°à¤¥","à¤¹à¤²","à¤—à¤®","à¤¦à¤®",
  "à¤¤à¤¨","à¤§à¤¨","à¤µà¤¨","à¤®à¤¤","à¤ªà¤¦","à¤•à¤®","à¤¬à¤¸","à¤¦à¤¸","à¤¸à¤¬","à¤¤à¤¬",
  "à¤œà¤¬","à¤…à¤¬","à¤ªà¤°","à¤¬à¤²","à¤•à¤²","à¤¯à¤¹","à¤µà¤¹","à¤¤à¤•","à¤°à¤¸","à¤—à¤£",
  "à¤ªà¤—","à¤œà¤—","à¤°à¤¨","à¤šà¤¨","à¤¬à¤¨","à¤¸à¤¨","à¤•à¤¨","à¤œà¤¨","à¤®à¤°","à¤—à¤°",
  "à¤¹à¤°","à¤ªà¤°","à¤¡à¤°","à¤¤à¤°","à¤¬à¤°","à¤¨à¤°","à¤¸à¤°","à¤µà¤°","à¤§à¤°","à¤–à¤°",
  "à¤Ÿà¤¬","à¤¡à¤¬","à¤•à¤ª","à¤¨à¤ª","à¤œà¤ª","à¤¤à¤ª","à¤°à¤ª","à¤®à¤ª","à¤¸à¤Ÿ","à¤ªà¤Ÿ",
  "à¤®à¤Ÿ","à¤—à¤Ÿ","à¤¦à¤Ÿ","à¤œà¤Ÿ","à¤¨à¤Ÿ","à¤•à¤Ÿ","à¤°à¤Ÿ","à¤­à¤Ÿ","à¤¦à¤²","à¤œà¤²",
];

// Level 3 â€” 3-4 letter words with matras (large pool of 80+)
const RT_LV3_POOL = [
  "à¤•à¤¾à¤®","à¤†à¤®","à¤¨à¤¾à¤®","à¤¦à¤¾à¤®","à¤°à¤¾à¤®","à¤œà¤¾à¤®","à¤§à¤¾à¤®","à¤¤à¤¾à¤®","à¤ªà¤¾à¤®","à¤–à¤¾à¤®",
  "à¤¨à¥€à¤®","à¤¦à¥€à¤¨","à¤­à¥€à¤¡à¤¼","à¤šà¥€à¤²","à¤¤à¥€à¤°","à¤§à¥€à¤°","à¤—à¥€à¤¤","à¤œà¥€à¤¤","à¤°à¥€à¤¤","à¤–à¥€à¤°",
  "à¤•à¤®à¤²","à¤¨à¤®à¤•","à¤ªà¤¤à¤‚à¤—","à¤¬à¤—à¤²","à¤¸à¤«à¤²","à¤¦à¤®à¤¨","à¤°à¤®à¤¨","à¤œà¤—à¤¨","à¤²à¤–à¤¨","à¤®à¤—à¤¨",
  "à¤–à¤¾à¤¨à¤¾","à¤ªà¤¾à¤¨à¥€","à¤†à¤¨à¤¾","à¤œà¤¾à¤¨à¤¾","à¤—à¤¾à¤¨à¤¾","à¤¨à¤¾à¤¨à¤¾","à¤¦à¤¾à¤¦à¤¾","à¤¬à¤¾à¤¬à¤¾","à¤•à¤¾à¤•à¤¾","à¤šà¤¾à¤šà¤¾",
  "à¤•à¤¿à¤²à¤¾","à¤®à¤¿à¤²à¤¾","à¤–à¤¿à¤²","à¤œà¤¿à¤²","à¤—à¤¿à¤²","à¤šà¤¿à¤¡à¤¼","à¤¸à¤¿à¤°","à¤¤à¤¿à¤²","à¤®à¤¿à¤²","à¤ªà¤¿à¤²",
  "à¤¸à¥à¤¨à¤¾","à¤¬à¥à¤¨à¤¾","à¤§à¥à¤¨à¤¾","à¤—à¥à¤¨à¤¾","à¤®à¥à¤¨à¤¾","à¤œà¥à¤¨à¤¾","à¤•à¥à¤¨à¤¾","à¤šà¥à¤¨à¤¾","à¤°à¥à¤¨à¤¾","à¤ªà¥à¤¨à¤¾",
  "à¤¦à¥‡à¤¶","à¤®à¥‡à¤œ","à¤¬à¥‡à¤²","à¤–à¥‡à¤¤","à¤°à¥‡à¤¤","à¤œà¥‡à¤¬","à¤µà¥‡à¤¦","à¤•à¥‡à¤•","à¤¸à¥‡à¤¬","à¤¨à¥‡à¤¤",
  "à¤ªà¥ˆà¤¸à¤¾","à¤®à¥ˆà¤¨à¤¾","à¤•à¥ˆà¤¦","à¤­à¥ˆà¤¯à¤¾","à¤¨à¥ˆà¤¯à¤¾","à¤—à¥ˆà¤¸","à¤¤à¥ˆà¤°","à¤¬à¥ˆà¤²","à¤®à¥ˆà¤²","à¤µà¥ˆà¤¦",
  "à¤®à¥‹à¤°","à¤—à¥‹à¤²","à¤¬à¥‹à¤²","à¤¡à¥‹à¤²","à¤–à¥‹à¤²","à¤Ÿà¥‹à¤²","à¤°à¥‹à¤²","à¤œà¥‹à¤²","à¤ªà¥‹à¤²","à¤¨à¥‹à¤²",
  "à¤ªà¥Œà¤§à¤¾","à¤®à¥Œà¤¸à¤®","à¤¸à¥Œà¤¦à¤¾","à¤•à¥Œà¤†","à¤¨à¥Œà¤•à¤¾","à¤¦à¥Œà¤¡à¤¼","à¤²à¥Œà¤Ÿ","à¤¤à¥Œà¤²","à¤®à¥Œà¤¤","à¤—à¥Œà¤°",
];

// Level 4 â€” simple sentences (pool of 40 sentences, 6 picked per test)
const RT_LV4_POOL = [
  "à¤°à¤¾à¤® à¤–à¤¾à¤¨à¤¾ à¤–à¤¾à¤¤à¤¾ à¤¹à¥ˆà¥¤","à¤¸à¥€à¤¤à¤¾ à¤ªà¤¾à¤¨à¥€ à¤ªà¥€à¤¤à¥€ à¤¹à¥ˆà¥¤","à¤®à¥‹à¤¹à¤¨ à¤¸à¥à¤•à¥‚à¤² à¤œà¤¾à¤¤à¤¾ à¤¹à¥ˆà¥¤",
  "à¤—à¤¾à¤¯ à¤˜à¤¾à¤¸ à¤–à¤¾à¤¤à¥€ à¤¹à¥ˆà¥¤","à¤¬à¤šà¥à¤šà¥‡ à¤–à¥‡à¤²à¤¤à¥‡ à¤¹à¥ˆà¤‚à¥¤","à¤®à¤¾à¤ à¤–à¤¾à¤¨à¤¾ à¤¬à¤¨à¤¾à¤¤à¥€ à¤¹à¥ˆà¥¤",
  "à¤ªà¤•à¥à¤·à¥€ à¤†à¤•à¤¾à¤¶ à¤®à¥‡à¤‚ à¤‰à¤¡à¤¼à¤¤à¥‡ à¤¹à¥ˆà¤‚à¥¤","à¤¸à¥‚à¤°à¤œ à¤¸à¥à¤¬à¤¹ à¤‰à¤—à¤¤à¤¾ à¤¹à¥ˆà¥¤",
  "à¤¹à¤¾à¤¥à¥€ à¤¬à¤¡à¤¼à¤¾ à¤œà¤¾à¤¨à¤µà¤° à¤¹à¥ˆà¥¤","à¤¬à¤¿à¤²à¥à¤²à¥€ à¤¦à¥‚à¤§ à¤ªà¥€à¤¤à¥€ à¤¹à¥ˆà¥¤",
  "à¤•à¥à¤¤à¥à¤¤à¤¾ à¤­à¥Œà¤‚à¤•à¤¤à¤¾ à¤¹à¥ˆà¥¤","à¤®à¤›à¤²à¥€ à¤ªà¤¾à¤¨à¥€ à¤®à¥‡à¤‚ à¤°à¤¹à¤¤à¥€ à¤¹à¥ˆà¥¤",
  "à¤«à¥‚à¤² à¤¬à¤¹à¥à¤¤ à¤¸à¥à¤‚à¤¦à¤° à¤¹à¥ˆà¤‚à¥¤","à¤ªà¥‡à¤¡à¤¼ à¤¹à¤®à¥‡à¤‚ à¤›à¤¾à¤¯à¤¾ à¤¦à¥‡à¤¤à¥‡ à¤¹à¥ˆà¤‚à¥¤",
  "à¤¨à¤¦à¥€ à¤®à¥‡à¤‚ à¤ªà¤¾à¤¨à¥€ à¤¬à¤¹à¤¤à¤¾ à¤¹à¥ˆà¥¤","à¤†à¤¸à¤®à¤¾à¤¨ à¤¨à¥€à¤²à¤¾ à¤¹à¥ˆà¥¤",
  "à¤¬à¤¾à¤¦à¤² à¤¸à¥‡ à¤¬à¤¾à¤°à¤¿à¤¶ à¤¹à¥‹à¤¤à¥€ à¤¹à¥ˆà¥¤","à¤¬à¤šà¥à¤šà¤¾ à¤°à¥‹à¤¤à¤¾ à¤¹à¥ˆà¥¤",
  "à¤²à¤¡à¤¼à¤•à¥€ à¤¨à¤¾à¤šà¤¤à¥€ à¤¹à¥ˆà¥¤","à¤²à¤¡à¤¼à¤•à¤¾ à¤¦à¥Œà¤¡à¤¼à¤¤à¤¾ à¤¹à¥ˆà¥¤",
  "à¤•à¤¿à¤¸à¤¾à¤¨ à¤–à¥‡à¤¤ à¤œà¥‹à¤¤à¤¤à¤¾ à¤¹à¥ˆà¥¤","à¤®à¤¾à¤²à¥€ à¤«à¥‚à¤² à¤²à¤—à¤¾à¤¤à¤¾ à¤¹à¥ˆà¥¤",
  "à¤®à¥‡à¤œ à¤ªà¤° à¤•à¤¿à¤¤à¤¾à¤¬ à¤¹à¥ˆà¥¤","à¤•à¥à¤°à¥à¤¸à¥€ à¤ªà¤° à¤¬à¤šà¥à¤šà¤¾ à¤¬à¥ˆà¤ à¤¾ à¤¹à¥ˆà¥¤",
  "à¤˜à¤° à¤®à¥‡à¤‚ à¤¸à¤¬ à¤²à¥‹à¤— à¤¹à¥ˆà¤‚à¥¤","à¤°à¤¾à¤¤ à¤®à¥‡à¤‚ à¤šà¤¾à¤à¤¦ à¤¨à¤¿à¤•à¤²à¤¤à¤¾ à¤¹à¥ˆà¥¤",
  "à¤¦à¤¿à¤¨ à¤®à¥‡à¤‚ à¤¸à¥‚à¤°à¤œ à¤šà¤®à¤•à¤¤à¤¾ à¤¹à¥ˆà¥¤","à¤ à¤‚à¤¡à¥€ à¤¹à¤µà¤¾ à¤¬à¤¹à¤¤à¥€ à¤¹à¥ˆà¥¤",
  "à¤¬à¤‚à¤¦à¤° à¤ªà¥‡à¤¡à¤¼ à¤ªà¤° à¤šà¤¢à¤¼à¤¤à¤¾ à¤¹à¥ˆà¥¤","à¤¶à¥‡à¤° à¤œà¤‚à¤—à¤² à¤®à¥‡à¤‚ à¤°à¤¹à¤¤à¤¾ à¤¹à¥ˆà¥¤",
  "à¤¤à¥‹à¤¤à¤¾ à¤¹à¤°à¤¾ à¤¹à¥‹à¤¤à¤¾ à¤¹à¥ˆà¥¤","à¤•à¥‹à¤¯à¤² à¤®à¥€à¤ à¤¾ à¤—à¤¾à¤¤à¥€ à¤¹à¥ˆà¥¤",
  "à¤—à¥à¤²à¤¾à¤¬ à¤•à¤¾ à¤«à¥‚à¤² à¤²à¤¾à¤² à¤¹à¥ˆà¥¤","à¤•à¤®à¤² à¤ªà¤¾à¤¨à¥€ à¤®à¥‡à¤‚ à¤‰à¤—à¤¤à¤¾ à¤¹à¥ˆà¥¤",
  "à¤®à¥à¤°à¥à¤—à¤¾ à¤¸à¥à¤¬à¤¹ à¤¬à¥‹à¤²à¤¤à¤¾ à¤¹à¥ˆà¥¤","à¤—à¤¾à¤¯ à¤¹à¤®à¥‡à¤‚ à¤¦à¥‚à¤§ à¤¦à¥‡à¤¤à¥€ à¤¹à¥ˆà¥¤",
  "à¤¹à¤® à¤¸à¤¬ à¤­à¤¾à¤°à¤¤à¥€à¤¯ à¤¹à¥ˆà¤‚à¥¤","à¤¹à¤®à¤¾à¤°à¤¾ à¤¦à¥‡à¤¶ à¤­à¤¾à¤°à¤¤ à¤¹à¥ˆà¥¤",
  "à¤¦à¤¿à¤²à¥à¤²à¥€ à¤­à¤¾à¤°à¤¤ à¤•à¥€ à¤°à¤¾à¤œà¤§à¤¾à¤¨à¥€ à¤¹à¥ˆà¥¤","à¤—à¤‚à¤—à¤¾ à¤à¤• à¤ªà¤µà¤¿à¤¤à¥à¤° à¤¨à¤¦à¥€ à¤¹à¥ˆà¥¤",
];

// Level 5 â€” short paragraphs (pool of 14, 1 picked per test)
const RT_LV5_POOL = [
  {title:"à¤¶à¥‡à¤° à¤”à¤° à¤šà¥‚à¤¹à¤¾",text:"à¤à¤• à¤¬à¤¾à¤° à¤œà¤‚à¤—à¤² à¤®à¥‡à¤‚ à¤à¤• à¤¶à¥‡à¤° à¤¸à¥‹ à¤°à¤¹à¤¾ à¤¥à¤¾à¥¤ à¤à¤• à¤›à¥‹à¤Ÿà¤¾ à¤šà¥‚à¤¹à¤¾ à¤‰à¤¸à¤•à¥‡ à¤ªà¤¾à¤¸ à¤†à¤¯à¤¾ à¤”à¤° à¤‰à¤¸à¤•à¥‡ à¤Šà¤ªà¤° à¤•à¥‚à¤¦ à¤—à¤¯à¤¾à¥¤ à¤¶à¥‡à¤° à¤œà¤¾à¤— à¤—à¤¯à¤¾ à¤”à¤° à¤‰à¤¸à¥‡ à¤ªà¤•à¤¡à¤¼ à¤²à¤¿à¤¯à¤¾à¥¤ à¤šà¥‚à¤¹à¥‡ à¤¨à¥‡ à¤•à¤¹à¤¾, à¤®à¥à¤à¥‡ à¤›à¥‹à¤¡à¤¼ à¤¦à¥‹, à¤®à¥ˆà¤‚ à¤à¤• à¤¦à¤¿à¤¨ à¤¤à¥à¤®à¥à¤¹à¤¾à¤°à¥€ à¤®à¤¦à¤¦ à¤•à¤°à¥‚à¤à¤—à¤¾à¥¤ à¤¶à¥‡à¤° à¤¹à¤à¤¸à¤¾ à¤”à¤° à¤‰à¤¸à¥‡ à¤œà¤¾à¤¨à¥‡ à¤¦à¤¿à¤¯à¤¾à¥¤ à¤•à¥à¤› à¤¦à¤¿à¤¨ à¤¬à¤¾à¤¦ à¤¶à¥‡à¤° à¤à¤• à¤œà¤¾à¤² à¤®à¥‡à¤‚ à¤«à¤à¤¸ à¤—à¤¯à¤¾à¥¤ à¤šà¥‚à¤¹à¥‡ à¤¨à¥‡ à¤œà¤¾à¤² à¤•à¤¾à¤Ÿ à¤¦à¤¿à¤¯à¤¾ à¤”à¤° à¤¶à¥‡à¤° à¤•à¥‹ à¤†à¤œà¤¼à¤¾à¤¦ à¤•à¤¿à¤¯à¤¾à¥¤ à¤¦à¥‹à¤¨à¥‹à¤‚ à¤…à¤šà¥à¤›à¥‡ à¤¦à¥‹à¤¸à¥à¤¤ à¤¬à¤¨ à¤—à¤à¥¤"},
  {title:"à¤šà¥€à¤‚à¤Ÿà¥€ à¤”à¤° à¤Ÿà¤¿à¤¡à¥à¤¡à¤¾",text:"à¤—à¤°à¥à¤®à¤¿à¤¯à¥‹à¤‚ à¤®à¥‡à¤‚ à¤à¤• à¤Ÿà¤¿à¤¡à¥à¤¡à¤¾ à¤—à¤¾à¤¨à¤¾ à¤—à¤¾à¤¤à¤¾ à¤¥à¤¾à¥¤ à¤à¤• à¤šà¥€à¤‚à¤Ÿà¥€ à¤®à¥‡à¤¹à¤¨à¤¤ à¤•à¤°à¤•à¥‡ à¤…à¤¨à¤¾à¤œ à¤œà¤®à¤¾ à¤•à¤° à¤°à¤¹à¥€ à¤¥à¥€à¥¤ à¤Ÿà¤¿à¤¡à¥à¤¡à¥‡ à¤¨à¥‡ à¤ªà¥‚à¤›à¤¾, à¤‡à¤¤à¤¨à¥€ à¤—à¤°à¥à¤®à¥€ à¤®à¥‡à¤‚ à¤•à¥à¤¯à¥‹à¤‚ à¤•à¤¾à¤® à¤•à¤°à¤¤à¥€ à¤¹à¥‹? à¤šà¥€à¤‚à¤Ÿà¥€ à¤¨à¥‡ à¤•à¤¹à¤¾, à¤œà¤¾à¤¡à¤¼à¥‡ à¤•à¥‡ à¤²à¤¿à¤ à¤–à¤¾à¤¨à¤¾ à¤œà¤®à¤¾ à¤•à¤° à¤°à¤¹à¥€ à¤¹à¥‚à¤à¥¤ à¤¸à¤°à¥à¤¦à¥€ à¤†à¤ˆ à¤¤à¥‹ à¤Ÿà¤¿à¤¡à¥à¤¡à¥‡ à¤•à¥‡ à¤ªà¤¾à¤¸ à¤•à¥à¤› à¤¨à¤¹à¥€à¤‚ à¤¥à¤¾à¥¤ à¤šà¥€à¤‚à¤Ÿà¥€ à¤•à¥‡ à¤ªà¤¾à¤¸ à¤­à¤°à¤ªà¥‚à¤° à¤–à¤¾à¤¨à¤¾ à¤¥à¤¾à¥¤ à¤®à¥‡à¤¹à¤¨à¤¤ à¤•à¤¾ à¤«à¤² à¤¹à¤®à¥‡à¤¶à¤¾ à¤®à¥€à¤ à¤¾ à¤¹à¥‹à¤¤à¤¾ à¤¹à¥ˆà¥¤"},
  {title:"à¤ªà¥à¤¯à¤¾à¤¸à¤¾ à¤•à¥Œà¤†",text:"à¤à¤• à¤•à¥Œà¤† à¤¬à¤¹à¥à¤¤ à¤ªà¥à¤¯à¤¾à¤¸à¤¾ à¤¥à¤¾à¥¤ à¤‰à¤¸à¤¨à¥‡ à¤à¤• à¤˜à¤¡à¤¼à¤¾ à¤¦à¥‡à¤–à¤¾ à¤œà¤¿à¤¸à¤®à¥‡à¤‚ à¤¥à¥‹à¤¡à¤¼à¤¾ à¤ªà¤¾à¤¨à¥€ à¤¥à¤¾à¥¤ à¤‰à¤¸à¤•à¥€ à¤šà¥‹à¤‚à¤š à¤ªà¤¾à¤¨à¥€ à¤¤à¤• à¤¨à¤¹à¥€à¤‚ à¤ªà¤¹à¥à¤à¤š à¤°à¤¹à¥€ à¤¥à¥€à¥¤ à¤•à¥Œà¤ à¤¨à¥‡ à¤à¤• à¤‰à¤ªà¤¾à¤¯ à¤¸à¥‹à¤šà¤¾à¥¤ à¤‰à¤¸à¤¨à¥‡ à¤˜à¤¡à¤¼à¥‡ à¤®à¥‡à¤‚ à¤•à¤‚à¤•à¤¡à¤¼ à¤¡à¤¾à¤²à¥‡à¥¤ à¤ªà¤¾à¤¨à¥€ à¤Šà¤ªà¤° à¤†à¤¤à¤¾ à¤—à¤¯à¤¾à¥¤ à¤•à¥Œà¤ à¤¨à¥‡ à¤ªà¤¾à¤¨à¥€ à¤ªà¤¿à¤¯à¤¾ à¤”à¤° à¤‰à¤¡à¤¼ à¤—à¤¯à¤¾à¥¤ à¤šà¤¤à¥à¤°à¤¾à¤ˆ à¤¸à¥‡ à¤¹à¤° à¤•à¤¾à¤® à¤¹à¥‹ à¤¸à¤•à¤¤à¤¾ à¤¹à¥ˆà¥¤"},
  {title:"à¤–à¤°à¤—à¥‹à¤¶ à¤”à¤° à¤•à¤›à¥à¤†",text:"à¤à¤• à¤–à¤°à¤—à¥‹à¤¶ à¤”à¤° à¤•à¤›à¥à¤ à¤®à¥‡à¤‚ à¤¦à¥Œà¤¡à¤¼ à¤•à¥€ à¤ªà¥à¤°à¤¤à¤¿à¤¯à¥‹à¤—à¤¿à¤¤à¤¾ à¤¹à¥à¤ˆà¥¤ à¤–à¤°à¤—à¥‹à¤¶ à¤¬à¤¹à¥à¤¤ à¤¤à¥‡à¤œà¤¼ à¤¥à¤¾à¥¤ à¤¦à¥Œà¤¡à¤¼ à¤¶à¥à¤°à¥‚ à¤¹à¥‹à¤¤à¥‡ à¤¹à¥€ à¤–à¤°à¤—à¥‹à¤¶ à¤†à¤—à¥‡ à¤¨à¤¿à¤•à¤² à¤—à¤¯à¤¾à¥¤ à¤‰à¤¸à¤¨à¥‡ à¤¸à¥‹à¤šà¤¾, à¤•à¤›à¥à¤† à¤¬à¤¹à¥à¤¤ à¤§à¥€à¤®à¤¾ à¤¹à¥ˆ, à¤¥à¥‹à¤¡à¤¼à¥€ à¤¦à¥‡à¤° à¤†à¤°à¤¾à¤® à¤•à¤°à¤¤à¤¾ à¤¹à¥‚à¤à¥¤ à¤µà¤¹ à¤¸à¥‹ à¤—à¤¯à¤¾à¥¤ à¤•à¤›à¥à¤† à¤§à¥€à¤°à¥‡-à¤§à¥€à¤°à¥‡ à¤šà¤²à¤¤à¤¾ à¤°à¤¹à¤¾ à¤”à¤° à¤¦à¥Œà¤¡à¤¼ à¤œà¥€à¤¤ à¤—à¤¯à¤¾à¥¤ à¤˜à¤®à¤‚à¤¡ à¤¨à¤¹à¥€à¤‚ à¤•à¤°à¤¨à¤¾ à¤šà¤¾à¤¹à¤¿à¤à¥¤"},
  {title:"à¤¸à¤šà¥à¤šà¤¾ à¤¦à¥‹à¤¸à¥à¤¤",text:"à¤®à¥‹à¤¹à¤¨ à¤”à¤° à¤¸à¥‹à¤¹à¤¨ à¤¦à¥‹ à¤¦à¥‹à¤¸à¥à¤¤ à¤¥à¥‡à¥¤ à¤à¤• à¤¦à¤¿à¤¨ à¤œà¤‚à¤—à¤² à¤®à¥‡à¤‚ à¤œà¤¾à¤¤à¥‡ à¤¸à¤®à¤¯ à¤à¤• à¤­à¤¾à¤²à¥‚ à¤†à¤¯à¤¾à¥¤ à¤®à¥‹à¤¹à¤¨ à¤ªà¥‡à¤¡à¤¼ à¤ªà¤° à¤šà¤¢à¤¼ à¤—à¤¯à¤¾à¥¤ à¤¸à¥‹à¤¹à¤¨ à¤•à¥‹ à¤ªà¥‡à¤¡à¤¼ à¤šà¤¢à¤¼à¤¨à¤¾ à¤¨à¤¹à¥€à¤‚ à¤†à¤¤à¤¾ à¤¥à¤¾à¥¤ à¤‰à¤¸à¤¨à¥‡ à¤œà¤®à¥€à¤¨ à¤ªà¤° à¤²à¥‡à¤Ÿ à¤•à¤° à¤¸à¤¾à¤à¤¸ à¤°à¥‹à¤• à¤²à¥€à¥¤ à¤­à¤¾à¤²à¥‚ à¤¨à¥‡ à¤‰à¤¸à¥‡ à¤¸à¥‚à¤à¤˜à¤¾ à¤”à¤° à¤šà¤²à¤¾ à¤—à¤¯à¤¾à¥¤ à¤®à¥‹à¤¹à¤¨ à¤¨à¥‡ à¤ªà¥‚à¤›à¤¾, à¤­à¤¾à¤²à¥‚ à¤¨à¥‡ à¤•à¥à¤¯à¤¾ à¤•à¤¹à¤¾? à¤¸à¥‹à¤¹à¤¨ à¤¬à¥‹à¤²à¤¾, à¤­à¤¾à¤²à¥‚ à¤¨à¥‡ à¤•à¤¹à¤¾, à¤®à¥à¤¸à¥€à¤¬à¤¤ à¤®à¥‡à¤‚ à¤­à¤¾à¤—à¤¨à¥‡ à¤µà¤¾à¤²à¥‡ à¤¸à¤šà¥à¤šà¥‡ à¤¦à¥‹à¤¸à¥à¤¤ à¤¨à¤¹à¥€à¤‚ à¤¹à¥‹à¤¤à¥‡à¥¤"},
  {title:"à¤¬à¤—à¥à¤²à¤¾ à¤”à¤° à¤•à¥‡à¤•à¤¡à¤¼à¤¾",text:"à¤à¤• à¤¤à¤¾à¤²à¤¾à¤¬ à¤®à¥‡à¤‚ à¤¬à¤¹à¥à¤¤ à¤®à¤›à¤²à¤¿à¤¯à¤¾à¤ à¤¥à¥€à¤‚à¥¤ à¤à¤• à¤¬à¥‚à¤¢à¤¼à¤¾ à¤¬à¤—à¥à¤²à¤¾ à¤®à¤›à¤²à¤¿à¤¯à¤¾à¤ à¤¨à¤¹à¥€à¤‚ à¤ªà¤•à¤¡à¤¼ à¤ªà¤¾ à¤°à¤¹à¤¾ à¤¥à¤¾à¥¤ à¤‰à¤¸à¤¨à¥‡ à¤à¤• à¤šà¤¾à¤² à¤¸à¥‹à¤šà¥€à¥¤ à¤‰à¤¸à¤¨à¥‡ à¤®à¤›à¤²à¤¿à¤¯à¥‹à¤‚ à¤¸à¥‡ à¤•à¤¹à¤¾, à¤ªà¤¾à¤¸ à¤®à¥‡à¤‚ à¤à¤• à¤¬à¤¡à¤¼à¤¾ à¤¤à¤¾à¤²à¤¾à¤¬ à¤¹à¥ˆ, à¤®à¥ˆà¤‚ à¤¤à¥à¤®à¥à¤¹à¥‡à¤‚ à¤µà¤¹à¤¾à¤ à¤²à¥‡ à¤œà¤¾à¤Šà¤à¤—à¤¾à¥¤ à¤®à¤›à¤²à¤¿à¤¯à¤¾à¤ à¤®à¤¾à¤¨ à¤—à¤ˆà¤‚à¥¤ à¤¬à¤—à¥à¤²à¤¾ à¤‰à¤¨à¥à¤¹à¥‡à¤‚ à¤à¤•-à¤à¤• à¤•à¤° à¤–à¤¾à¤¤à¤¾ à¤°à¤¹à¤¾à¥¤ à¤à¤• à¤¦à¤¿à¤¨ à¤•à¥‡à¤•à¤¡à¤¼à¥‡ à¤•à¥‹ à¤¶à¤• à¤¹à¥à¤†à¥¤ à¤‰à¤¸à¤¨à¥‡ à¤¬à¤—à¥à¤²à¥‡ à¤•à¥€ à¤—à¤°à¥à¤¦à¤¨ à¤ªà¤•à¤¡à¤¼ à¤²à¥€à¥¤ à¤šà¤¾à¤²à¤¾à¤•à¥€ à¤¹à¤®à¥‡à¤¶à¤¾ à¤¨à¤¹à¥€à¤‚ à¤šà¤²à¤¤à¥€à¥¤"},
  {title:"à¤¹à¤®à¤¾à¤°à¤¾ à¤­à¤¾à¤°à¤¤",text:"à¤­à¤¾à¤°à¤¤ à¤à¤• à¤®à¤¹à¤¾à¤¨ à¤¦à¥‡à¤¶ à¤¹à¥ˆà¥¤ à¤¯à¤¹à¤¾à¤ à¤…à¤¨à¥‡à¤• à¤§à¤°à¥à¤®à¥‹à¤‚ à¤•à¥‡ à¤²à¥‹à¤— à¤®à¤¿à¤²à¤•à¤° à¤°à¤¹à¤¤à¥‡ à¤¹à¥ˆà¤‚à¥¤ à¤¹à¤¿à¤®à¤¾à¤²à¤¯ à¤‰à¤¤à¥à¤¤à¤° à¤®à¥‡à¤‚ à¤¹à¥ˆà¥¤ à¤¦à¤•à¥à¤·à¤¿à¤£ à¤®à¥‡à¤‚ à¤¸à¤®à¥à¤¦à¥à¤° à¤¹à¥ˆà¥¤ à¤—à¤‚à¤—à¤¾, à¤¯à¤®à¥à¤¨à¤¾ à¤”à¤° à¤¬à¥à¤°à¤¹à¥à¤®à¤ªà¥à¤¤à¥à¤° à¤¯à¤¹à¤¾à¤ à¤•à¥€ à¤ªà¥à¤°à¤®à¥à¤– à¤¨à¤¦à¤¿à¤¯à¤¾à¤ à¤¹à¥ˆà¤‚à¥¤ à¤­à¤¾à¤°à¤¤ à¤®à¥‡à¤‚ à¤…à¤¨à¥‡à¤• à¤­à¤¾à¤·à¤¾à¤à¤ à¤¬à¥‹à¤²à¥€ à¤œà¤¾à¤¤à¥€ à¤¹à¥ˆà¤‚à¥¤ à¤¹à¤¿à¤‚à¤¦à¥€ à¤°à¤¾à¤œà¤­à¤¾à¤·à¤¾ à¤¹à¥ˆà¥¤ à¤¹à¤®à¥‡à¤‚ à¤…à¤ªà¤¨à¥‡ à¤¦à¥‡à¤¶ à¤ªà¤° à¤—à¤°à¥à¤µ à¤¹à¥ˆà¥¤"},
  {title:"à¤®à¥‡à¤°à¤¾ à¤¸à¥à¤•à¥‚à¤²",text:"à¤®à¥‡à¤°à¤¾ à¤¸à¥à¤•à¥‚à¤² à¤¬à¤¹à¥à¤¤ à¤¸à¥à¤‚à¤¦à¤° à¤¹à¥ˆà¥¤ à¤µà¤¹à¤¾à¤ à¤¬à¤¡à¤¼à¤¾ à¤®à¥ˆà¤¦à¤¾à¤¨ à¤¹à¥ˆà¥¤ à¤¹à¤® à¤µà¤¹à¤¾à¤ à¤–à¥‡à¤²à¤¤à¥‡ à¤¹à¥ˆà¤‚à¥¤ à¤¸à¥à¤•à¥‚à¤² à¤®à¥‡à¤‚ à¤¬à¤¹à¥à¤¤ à¤…à¤šà¥à¤›à¥‡ à¤¶à¤¿à¤•à¥à¤·à¤• à¤¹à¥ˆà¤‚à¥¤ à¤µà¥‡ à¤¹à¤®à¥‡à¤‚ à¤ªà¤¢à¤¼à¤¾à¤¤à¥‡ à¤¹à¥ˆà¤‚à¥¤ à¤¹à¤® à¤¹à¤¿à¤‚à¤¦à¥€, à¤—à¤£à¤¿à¤¤ à¤”à¤° à¤…à¤‚à¤—à¥à¤°à¥‡à¤œà¤¼à¥€ à¤ªà¤¢à¤¼à¤¤à¥‡ à¤¹à¥ˆà¤‚à¥¤ à¤¸à¥à¤•à¥‚à¤² à¤®à¥‡à¤‚ à¤¬à¤—à¥€à¤šà¤¾ à¤­à¥€ à¤¹à¥ˆà¥¤ à¤‰à¤¸à¤®à¥‡à¤‚ à¤°à¤‚à¤—à¥€à¤¨ à¤«à¥‚à¤² à¤–à¤¿à¤²à¤¤à¥‡ à¤¹à¥ˆà¤‚à¥¤ à¤®à¥à¤à¥‡ à¤…à¤ªà¤¨à¤¾ à¤¸à¥à¤•à¥‚à¤² à¤¬à¤¹à¥à¤¤ à¤ªà¤¸à¤‚à¤¦ à¤¹à¥ˆà¥¤"},
  {title:"à¤µà¤°à¥à¤·à¤¾ à¤‹à¤¤à¥",text:"à¤µà¤°à¥à¤·à¤¾ à¤‹à¤¤à¥ à¤®à¥‡à¤‚ à¤•à¤¾à¤²à¥‡ à¤¬à¤¾à¤¦à¤² à¤†à¤•à¤¾à¤¶ à¤®à¥‡à¤‚ à¤›à¤¾ à¤œà¤¾à¤¤à¥‡ à¤¹à¥ˆà¤‚à¥¤ à¤¬à¤¿à¤œà¤²à¥€ à¤šà¤®à¤•à¤¤à¥€ à¤¹à¥ˆ à¤”à¤° à¤¬à¤¾à¤¦à¤² à¤—à¤°à¤œà¤¤à¥‡ à¤¹à¥ˆà¤‚à¥¤ à¤ à¤‚à¤¡à¥€ à¤¹à¤µà¤¾ à¤šà¤²à¤¤à¥€ à¤¹à¥ˆà¥¤ à¤«à¤¿à¤° à¤µà¤°à¥à¤·à¤¾ à¤¹à¥‹à¤¤à¥€ à¤¹à¥ˆà¥¤ à¤®à¥‡à¤‚à¤¢à¤• à¤Ÿà¤°à¥à¤°à¤¾à¤¨à¥‡ à¤²à¤—à¤¤à¥‡ à¤¹à¥ˆà¤‚à¥¤ à¤®à¥‹à¤° à¤¨à¤¾à¤šà¤¤à¥‡ à¤¹à¥ˆà¤‚à¥¤ à¤¨à¤¦à¥€-à¤¨à¤¾à¤²à¥‡ à¤­à¤° à¤œà¤¾à¤¤à¥‡ à¤¹à¥ˆà¤‚à¥¤ à¤§à¤°à¤¤à¥€ à¤¹à¤°à¥€-à¤­à¤°à¥€ à¤¹à¥‹ à¤œà¤¾à¤¤à¥€ à¤¹à¥ˆà¥¤ à¤•à¤¿à¤¸à¤¾à¤¨ à¤–à¥à¤¶ à¤¹à¥‹ à¤œà¤¾à¤¤à¥‡ à¤¹à¥ˆà¤‚ à¤•à¥à¤¯à¥‹à¤‚à¤•à¤¿ à¤‰à¤¨à¤•à¥€ à¤«à¤¸à¤² à¤…à¤šà¥à¤›à¥€ à¤¹à¥‹à¤¤à¥€ à¤¹à¥ˆà¥¤"},
  {title:"à¤ªà¥‡à¤¡à¤¼ à¤¹à¤®à¤¾à¤°à¥‡ à¤®à¤¿à¤¤à¥à¤°",text:"à¤ªà¥‡à¤¡à¤¼ à¤¹à¤®à¤¾à¤°à¥‡ à¤¸à¤šà¥à¤šà¥‡ à¤®à¤¿à¤¤à¥à¤° à¤¹à¥ˆà¤‚à¥¤ à¤µà¥‡ à¤¹à¤®à¥‡à¤‚ à¤«à¤², à¤«à¥‚à¤² à¤”à¤° à¤²à¤•à¤¡à¤¼à¥€ à¤¦à¥‡à¤¤à¥‡ à¤¹à¥ˆà¤‚à¥¤ à¤ªà¥‡à¤¡à¤¼ à¤¹à¤®à¥‡à¤‚ à¤›à¤¾à¤¯à¤¾ à¤¦à¥‡à¤¤à¥‡ à¤¹à¥ˆà¤‚à¥¤ à¤µà¥‡ à¤¹à¤µà¤¾ à¤•à¥‹ à¤¸à¤¾à¤«à¤¼ à¤•à¤°à¤¤à¥‡ à¤¹à¥ˆà¤‚à¥¤ à¤ªà¥‡à¤¡à¤¼à¥‹à¤‚ à¤•à¥€ à¤œà¤¡à¤¼à¥‡à¤‚ à¤®à¤¿à¤Ÿà¥à¤Ÿà¥€ à¤•à¥‹ à¤¬à¤¾à¤à¤§à¥‡ à¤°à¤–à¤¤à¥€ à¤¹à¥ˆà¤‚à¥¤ à¤ªà¥‡à¤¡à¤¼à¥‹à¤‚ à¤¸à¥‡ à¤¹à¤®à¥‡à¤‚ à¤”à¤·à¤§à¤¿à¤¯à¤¾à¤ à¤­à¥€ à¤®à¤¿à¤²à¤¤à¥€ à¤¹à¥ˆà¤‚à¥¤ à¤¹à¤®à¥‡à¤‚ à¤ªà¥‡à¤¡à¤¼ à¤•à¤¾à¤Ÿà¤¨à¥‡ à¤¨à¤¹à¥€à¤‚ à¤šà¤¾à¤¹à¤¿à¤à¥¤ à¤œà¤¿à¤¤à¤¨à¤¾ à¤¹à¥‹ à¤¸à¤•à¥‡, à¤‰à¤¤à¤¨à¥‡ à¤ªà¥‡à¤¡à¤¼ à¤²à¤—à¤¾à¤¨à¥‡ à¤šà¤¾à¤¹à¤¿à¤à¥¤"},
  {title:"à¤¬à¥à¤¦à¥à¤§à¤¿à¤®à¤¾à¤¨ à¤¬à¤‚à¤¦à¤°",text:"à¤à¤• à¤¬à¤¾à¤° à¤¦à¥‹ à¤¬à¤¿à¤²à¥à¤²à¤¿à¤¯à¤¾à¤ à¤à¤• à¤°à¥‹à¤Ÿà¥€ à¤•à¥‡ à¤²à¤¿à¤ à¤²à¤¡à¤¼ à¤°à¤¹à¥€ à¤¥à¥€à¤‚à¥¤ à¤à¤• à¤¬à¤‚à¤¦à¤° à¤µà¤¹à¤¾à¤ à¤†à¤¯à¤¾à¥¤ à¤‰à¤¸à¤¨à¥‡ à¤•à¤¹à¤¾, à¤®à¥ˆà¤‚ à¤¤à¥à¤®à¥à¤¹à¤¾à¤°à¥‡ à¤¬à¥€à¤š à¤°à¥‹à¤Ÿà¥€ à¤¬à¤¾à¤à¤Ÿ à¤¦à¥‡à¤¤à¤¾ à¤¹à¥‚à¤à¥¤ à¤‰à¤¸à¤¨à¥‡ à¤°à¥‹à¤Ÿà¥€ à¤•à¥‹ à¤¦à¥‹ à¤¹à¤¿à¤¸à¥à¤¸à¥‹à¤‚ à¤®à¥‡à¤‚ à¤¤à¥‹à¤¡à¤¼à¤¾à¥¤ à¤à¤• à¤¹à¤¿à¤¸à¥à¤¸à¤¾ à¤¬à¤¡à¤¼à¤¾ à¤¥à¤¾à¥¤ à¤‰à¤¸à¤¨à¥‡ à¤‰à¤¸à¤®à¥‡à¤‚ à¤¸à¥‡ à¤¥à¥‹à¤¡à¤¼à¤¾ à¤–à¤¾ à¤²à¤¿à¤¯à¤¾à¥¤ à¤…à¤¬ à¤¦à¥‚à¤¸à¤°à¤¾ à¤¹à¤¿à¤¸à¥à¤¸à¤¾ à¤¬à¤¡à¤¼à¤¾ à¤¹à¥‹ à¤—à¤¯à¤¾à¥¤ à¤‡à¤¸ à¤¤à¤°à¤¹ à¤¬à¤‚à¤¦à¤° à¤¨à¥‡ à¤ªà¥‚à¤°à¥€ à¤°à¥‹à¤Ÿà¥€ à¤–à¤¾ à¤²à¥€à¥¤ à¤¬à¤¿à¤²à¥à¤²à¤¿à¤¯à¤¾à¤ à¤ªà¤›à¤¤à¤¾à¤¤à¥€ à¤°à¤¹ à¤—à¤ˆà¤‚à¥¤"},
  {title:"à¤®à¥‡à¤¹à¤¨à¤¤à¥€ à¤•à¤¿à¤¸à¤¾à¤¨",text:"à¤à¤• à¤•à¤¿à¤¸à¤¾à¤¨ à¤•à¥‡ à¤¤à¥€à¤¨ à¤¬à¥‡à¤Ÿà¥‡ à¤¥à¥‡à¥¤ à¤µà¥‡ à¤†à¤ªà¤¸ à¤®à¥‡à¤‚ à¤¬à¤¹à¥à¤¤ à¤²à¤¡à¤¼à¤¤à¥‡ à¤¥à¥‡à¥¤ à¤•à¤¿à¤¸à¤¾à¤¨ à¤¬à¥€à¤®à¤¾à¤° à¤¹à¥‹ à¤—à¤¯à¤¾à¥¤ à¤‰à¤¸à¤¨à¥‡ à¤¬à¥‡à¤Ÿà¥‹à¤‚ à¤•à¥‹ à¤¬à¥à¤²à¤¾à¤¯à¤¾à¥¤ à¤²à¤•à¤¡à¤¼à¤¿à¤¯à¥‹à¤‚ à¤•à¤¾ à¤à¤• à¤—à¤Ÿà¥à¤ à¤° à¤²à¤¾à¤¯à¤¾à¥¤ à¤‰à¤¸à¤¨à¥‡ à¤•à¤¹à¤¾, à¤‡à¤¸à¥‡ à¤¤à¥‹à¤¡à¤¼à¥‹à¥¤ à¤•à¤¿à¤¸à¥€ à¤¸à¥‡ à¤¨ à¤Ÿà¥‚à¤Ÿà¤¾à¥¤ à¤‰à¤¸à¤¨à¥‡ à¤à¤•-à¤à¤• à¤²à¤•à¤¡à¤¼à¥€ à¤¦à¥€à¥¤ à¤¸à¤¬ à¤†à¤¸à¤¾à¤¨à¥€ à¤¸à¥‡ à¤Ÿà¥‚à¤Ÿ à¤—à¤ˆà¥¤ à¤•à¤¿à¤¸à¤¾à¤¨ à¤¨à¥‡ à¤•à¤¹à¤¾, à¤®à¤¿à¤²à¤•à¤° à¤°à¤¹à¥‹à¤—à¥‡ à¤¤à¥‹ à¤•à¥‹à¤ˆ à¤¤à¥à¤®à¥à¤¹à¥‡à¤‚ à¤¨à¤¹à¥€à¤‚ à¤¤à¥‹à¤¡à¤¼ à¤ªà¤¾à¤à¤—à¤¾à¥¤"},
  {title:"à¤šà¤¾à¤à¤¦ à¤”à¤° à¤¸à¤¿à¤¤à¤¾à¤°à¥‡",text:"à¤°à¤¾à¤¤ à¤•à¥‹ à¤†à¤¸à¤®à¤¾à¤¨ à¤®à¥‡à¤‚ à¤šà¤¾à¤à¤¦ à¤¨à¤¿à¤•à¤²à¤¤à¤¾ à¤¹à¥ˆà¥¤ à¤‰à¤¸à¤•à¥‡ à¤¸à¤¾à¤¥ à¤…à¤¨à¤—à¤¿à¤¨à¤¤ à¤¤à¤¾à¤°à¥‡ à¤šà¤®à¤•à¤¤à¥‡ à¤¹à¥ˆà¤‚à¥¤ à¤šà¤¾à¤à¤¦ à¤•à¥€ à¤°à¥‹à¤¶à¤¨à¥€ à¤®à¥‡à¤‚ à¤§à¤°à¤¤à¥€ à¤œà¤—à¤®à¤—à¤¾ à¤‰à¤ à¤¤à¥€ à¤¹à¥ˆà¥¤ à¤¬à¤šà¥à¤šà¥‡ à¤›à¤¤ à¤ªà¤° à¤¬à¥ˆà¤ à¤•à¤° à¤šà¤¾à¤à¤¦-à¤¤à¤¾à¤°à¥‡ à¤¦à¥‡à¤–à¤¤à¥‡ à¤¹à¥ˆà¤‚à¥¤ à¤•à¤µà¤¿à¤¯à¥‹à¤‚ à¤¨à¥‡ à¤šà¤¾à¤à¤¦ à¤ªà¤° à¤¬à¤¹à¥à¤¤ à¤•à¤µà¤¿à¤¤à¤¾à¤à¤ à¤²à¤¿à¤–à¥€ à¤¹à¥ˆà¤‚à¥¤ à¤†à¤œ à¤‡à¤‚à¤¸à¤¾à¤¨ à¤šà¤¾à¤à¤¦ à¤ªà¤° à¤ªà¤¹à¥à¤à¤š à¤šà¥à¤•à¤¾ à¤¹à¥ˆà¥¤ à¤šà¤¾à¤à¤¦ à¤•à¥€ à¤¯à¤¾à¤¤à¥à¤°à¤¾ à¤¬à¤¹à¥à¤¤ à¤°à¥‹à¤®à¤¾à¤‚à¤šà¤• à¤¥à¥€à¥¤"},
  {title:"à¤¸à¥à¤µà¤šà¥à¤› à¤­à¤¾à¤°à¤¤",text:"à¤—à¤‚à¤¦à¤—à¥€ à¤¸à¥‡ à¤¬à¥€à¤®à¤¾à¤°à¤¿à¤¯à¤¾à¤ à¤¹à¥‹à¤¤à¥€ à¤¹à¥ˆà¤‚à¥¤ à¤¹à¤®à¥‡à¤‚ à¤…à¤ªà¤¨à¥‡ à¤˜à¤°, à¤—à¤²à¥€ à¤”à¤° à¤®à¥‹à¤¹à¤²à¥à¤²à¥‡ à¤•à¥‹ à¤¸à¤¾à¤«à¤¼ à¤°à¤–à¤¨à¤¾ à¤šà¤¾à¤¹à¤¿à¤à¥¤ à¤•à¥‚à¤¡à¤¼à¥‡ à¤•à¥‹ à¤•à¥‚à¤¡à¤¼à¥‡à¤¦à¤¾à¤¨ à¤®à¥‡à¤‚ à¤¡à¤¾à¤²à¤¨à¤¾ à¤šà¤¾à¤¹à¤¿à¤à¥¤ à¤¨à¤¦à¤¿à¤¯à¥‹à¤‚ à¤•à¥‹ à¤ªà¥à¤°à¤¦à¥‚à¤·à¤¿à¤¤ à¤¨à¤¹à¥€à¤‚ à¤•à¤°à¤¨à¤¾ à¤šà¤¾à¤¹à¤¿à¤à¥¤ à¤ªà¥‡à¤¡à¤¼-à¤ªà¥Œà¤§à¥‡ à¤²à¤—à¤¾à¤¨à¥‡ à¤šà¤¾à¤¹à¤¿à¤à¥¤ à¤ªà¥à¤²à¤¾à¤¸à¥à¤Ÿà¤¿à¤• à¤•à¤¾ à¤‰à¤ªà¤¯à¥‹à¤— à¤•à¤® à¤•à¤°à¤¨à¤¾ à¤šà¤¾à¤¹à¤¿à¤à¥¤ à¤¸à¥à¤µà¤šà¥à¤› à¤­à¤¾à¤°à¤¤ à¤…à¤­à¤¿à¤¯à¤¾à¤¨ à¤®à¥‡à¤‚ à¤¹à¤® à¤¸à¤¬à¤•à¥‹ à¤®à¤¿à¤²à¤•à¤° à¤­à¤¾à¤— à¤²à¥‡à¤¨à¤¾ à¤šà¤¾à¤¹à¤¿à¤à¥¤ à¤¸à¥à¤µà¤šà¥à¤›à¤¤à¤¾ à¤¹à¥€ à¤¸à¥‡à¤µà¤¾ à¤¹à¥ˆà¥¤"},
];

// Grading per level
const RT_GRADE = (wpm, target) => {
  if (target === 0) return null; // Level 1 uses LPM
  const pct = (wpm / target) * 100;
  if (pct >= 110) return { g:"A+", label:"Outstanding! ğŸ†", color:"#43A047" };
  if (pct >= 90)  return { g:"A",  label:"Excellent! ğŸ‰",   color:"#43A047" };
  if (pct >= 75)  return { g:"B+", label:"Very Good! â­",   color:"#1E88E5" };
  if (pct >= 60)  return { g:"B",  label:"Good! ğŸ‘",        color:"#1E88E5" };
  if (pct >= 40)  return { g:"C",  label:"Keep Practising! ğŸ“š", color:"#FB8C00" };
  return           { g:"D",  label:"Need more practice ğŸ’ª", color:"#E53935" };
};

const RT_LEVELS_META = [
  { id:"lv1", label:"à¤¬à¤¾à¤²à¤µà¤¾à¤Ÿà¤¿à¤•à¤¾ à¥§", en:"Level 1 â€” Letter Grid",   color:"#FF7043", bg:"#FBE9E7", icon:"ğŸŒ±", stars:1, wpmTarget:0,  lpmTarget:25, desc:"Read individual letters & syllables" },
  { id:"lv2", label:"à¤¬à¤¾à¤²à¤µà¤¾à¤Ÿà¤¿à¤•à¤¾ à¥¨", en:"Level 2 â€” Simple Words",  color:"#43A047", bg:"#E8F5E9", icon:"ğŸŒ¿", stars:2, wpmTarget:10, lpmTarget:0,  desc:"Read 2-letter words without matras" },
  { id:"lv3", label:"à¤¬à¤¾à¤²à¤µà¤¾à¤Ÿà¤¿à¤•à¤¾ à¥©", en:"Level 3 â€” Matra Words",   color:"#1E88E5", bg:"#E3F2FD", icon:"ğŸŒ»", stars:3, wpmTarget:15, lpmTarget:0,  desc:"Read words with all matras" },
  { id:"c1",  label:"à¤•à¤•à¥à¤·à¤¾ à¥§",     en:"Level 4 â€” Sentences",     color:"#8E24AA", bg:"#F3E5F5", icon:"â­", stars:4, wpmTarget:25, lpmTarget:0,  desc:"Read simple Hindi sentences" },
  { id:"c2",  label:"à¤•à¤•à¥à¤·à¤¾ à¥¨",     en:"Level 5 â€” Paragraphs",    color:"#E53935", bg:"#FFEBEE", icon:"ğŸ†", stars:5, wpmTarget:45, lpmTarget:0,  desc:"Read full paragraphs fluently" },
];

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HELPERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
/* â”€â”€â”€ Pick the best available Hindi voice â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Priority order (highest quality first):
   1. Google à¤¹à¤¿à¤¨à¥à¤¦à¥€  â€” best natural voice, available on Chrome/Android
   2. Any Google hi-IN voice
   3. Any hi-IN voice that isn't "espeak" / "eSpeak" (those are robotic)
   4. Any hi voice
   5. Fallback to whatever the browser gives
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
let _bestVoice = null;
let _voiceReady = false;

const _pickBestVoice = () => {
  const voices = window.speechSynthesis.getVoices();
  if (!voices.length) return null;

  // Candidates in order of preference
  const find = (test) => voices.find(test) || null;

  return (
    find(v => v.lang === "hi-IN" && v.name.includes("Google à¤¹à¤¿à¤¨à¥à¤¦à¥€")) ||
    find(v => v.lang === "hi-IN" && v.name.toLowerCase().includes("google")) ||
    find(v => v.lang === "hi-IN" && !v.name.toLowerCase().includes("espeak")) ||
    find(v => v.lang.startsWith("hi")) ||
    null
  );
};

// Voices load async â€” grab them as soon as they're ready
if (window.speechSynthesis) {
  // Many browsers fire this event; Chrome on Android needs getVoices() first
  window.speechSynthesis.onvoiceschanged = () => {
    _bestVoice = _pickBestVoice();
    _voiceReady = true;
  };
  // Also try immediately (Firefox / some desktop Chrome already have voices)
  const v = _pickBestVoice();
  if (v) { _bestVoice = v; _voiceReady = true; }
}

const speak = (text, rate = 0.82) => {
  if (!window.speechSynthesis) return;
  window.speechSynthesis.cancel();

  const u = new SpeechSynthesisUtterance(text);
  u.lang  = "hi-IN";
  u.rate  = rate;
  u.pitch = 1.0;      // 1.0 = natural, not squeaky
  u.volume = 1.0;

  // Use the best voice we found; if not ready yet, try one more time
  if (!_voiceReady) _bestVoice = _pickBestVoice();
  if (_bestVoice) u.voice = _bestVoice;

  window.speechSynthesis.speak(u);
};

// Generate an endless random question from all data pools
const generateQ = (index) => {
  const pool = [];

  // Swar match
  SWAR.forEach(s => {
    pool.push({
      type:"swar", q:`'${s.eg}' à¤•à¤¿à¤¸ à¤¸à¥à¤µà¤° à¤¸à¥‡ à¤¶à¥à¤°à¥‚ à¤¹à¥‹à¤¤à¤¾ à¤¹à¥ˆ?`,
      img:s.em, answer:s.a,
      choices: shuffle([s.a, ...SWAR.filter(x=>x.a!==s.a).slice(0,3).map(x=>x.a)]),
      speak: s.eg,
    });
  });

  // Word meaning
  WORDS.forEach(w => {
    const others = WORDS.filter(x=>x.w!==w.w).slice(0,3);
    pool.push({
      type:"word", q:`'${w.em}' à¤•à¤¾ à¤¹à¤¿à¤‚à¤¦à¥€ à¤¶à¤¬à¥à¤¦ à¤•à¥à¤¯à¤¾ à¤¹à¥ˆ?`,
      img:w.em, answer:w.w,
      choices: shuffle([w.w, ...others.map(x=>x.w)]),
      speak: w.w,
    });
  });

  // Meaning in English
  WORDS.forEach(w => {
    const others = WORDS.filter(x=>x.w!==w.w).slice(0,3);
    pool.push({
      type:"meaning", q:`'${w.w}' à¤•à¤¾ à¤…à¤°à¥à¤¥ à¤•à¥à¤¯à¤¾ à¤¹à¥ˆ?`,
      img:w.em, answer:w.m,
      choices: shuffle([w.m, ...others.map(x=>x.m)]),
      speak: w.w,
    });
  });

  // Matra identification
  MATRAS.forEach(m => {
    pool.push({
      type:"matra", q:`'${m.eg}' à¤®à¥‡à¤‚ à¤•à¥Œà¤¨ à¤¸à¥€ à¤®à¤¾à¤¤à¥à¤°à¤¾ à¤¹à¥ˆ?`,
      img:m.eg, answer:m.sym,
      choices: shuffle([m.sym, ...MATRAS.filter(x=>x.sym!==m.sym).slice(0,3).map(x=>x.sym)]),
      speak: m.eg,
    });
  });

  // Vyanjan match
  VYANJAN.forEach(v => {
    pool.push({
      type:"vyanjan", q:`'${v.eg}' à¤•à¤¿à¤¸ à¤µà¥à¤¯à¤‚à¤œà¤¨ à¤¸à¥‡ à¤¶à¥à¤°à¥‚ à¤¹à¥‹à¤¤à¤¾ à¤¹à¥ˆ?`,
      img:v.em, answer:v.a,
      choices: shuffle([v.a, ...VYANJAN.filter(x=>x.a!==v.a).slice(0,3).map(x=>x.a)]),
      speak: v.eg,
    });
  });

  const i = index % pool.length;
  return pool[i];
};

const shuffle = (arr) => {
  const a = [...arr];
  for (let i = a.length-1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i+1));
    [a[i],a[j]] = [a[j],a[i]];
  }
  return a;
};

const seededQ = (seed) => {
  // deterministic-ish by seed
  const all = [];
  SWAR.forEach(s => all.push({type:"swar",q:`'${s.eg}' à¤•à¤¿à¤¸ à¤¸à¥à¤µà¤° à¤¸à¥‡ à¤¶à¥à¤°à¥‚ à¤¹à¥‹à¤¤à¤¾ à¤¹à¥ˆ?`,img:s.em,answer:s.a,choices:shuffle([s.a,...SWAR.filter(x=>x.a!==s.a).slice(0,3).map(x=>x.a)]),speak:s.eg}));
  WORDS.forEach(w => all.push({type:"word",q:`'${w.em}' à¤•à¤¾ à¤¹à¤¿à¤‚à¤¦à¥€ à¤¶à¤¬à¥à¤¦?`,img:w.em,answer:w.w,choices:shuffle([w.w,...WORDS.filter(x=>x.w!==w.w).slice(0,3).map(x=>x.w)]),speak:w.w}));
  WORDS.forEach(w => all.push({type:"meaning",q:`'${w.w}' à¤•à¤¾ à¤…à¤°à¥à¤¥?`,img:w.em,answer:w.m,choices:shuffle([w.m,...WORDS.filter(x=>x.m!==w.m).slice(0,3).map(x=>x.m)]),speak:w.w}));
  MATRAS.forEach(m => all.push({type:"matra",q:`'${m.eg}' à¤®à¥‡à¤‚ à¤•à¥Œà¤¨ à¤¸à¥€ à¤®à¤¾à¤¤à¥à¤°à¤¾?`,img:m.eg,answer:m.sym,choices:shuffle([m.sym,...MATRAS.filter(x=>x.sym!==m.sym).slice(0,3).map(x=>x.sym)]),speak:m.eg}));
  VYANJAN.forEach(v => all.push({type:"vyanjan",q:`'${v.eg}' à¤•à¤¿à¤¸ à¤µà¥à¤¯à¤‚à¤œà¤¨ à¤¸à¥‡?`,img:v.em,answer:v.a,choices:shuffle([v.a,...VYANJAN.filter(x=>x.a!==v.a).slice(0,3).map(x=>x.a)]),speak:v.eg}));
  return all[seed % all.length];
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   UI PRIMITIVES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const Btn = ({ children, onClick, color="#FF7043", style={}, disabled=false }) => (
  <button className="press" onClick={disabled ? undefined : onClick} disabled={disabled}
    style={{ background: disabled?"#ccc":color, color:"#fff", border:"none",
      borderRadius:14, padding:"13px 20px", fontWeight:800, fontSize:14,
      cursor:disabled?"not-allowed":"pointer", transition:"background .2s",
      userSelect:"none", ...style }}>
    {children}
  </button>
);

const Card = ({ children, style={} }) => (
  <div style={{ background:"#fff", borderRadius:18, padding:16,
    boxShadow:"0 2px 12px rgba(0,0,0,.07)", ...style }}>
    {children}
  </div>
);

const Bar = ({ pct, color }) => (
  <div style={{ background:"#eee", borderRadius:8, height:9, overflow:"hidden" }}>
    <div style={{ width:`${Math.min(pct,100)}%`, height:"100%", background:color,
      borderRadius:8, transition:"width 1s ease" }} />
  </div>
);

const H = ({ children }) => (
  <div style={{ fontWeight:800, fontSize:17, color:"#333", marginBottom:14 }}>{children}</div>
);

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NAV
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const NAV_ITEMS = [
  {id:"home",        icon:"ğŸ ", label:"Home"},
  {id:"learn",       icon:"âœï¸", label:"Learn"},
  {id:"reading",     icon:"ğŸ“–", label:"Reading"},
  {id:"endless",     icon:"â™¾ï¸", label:"Endless"},
  {id:"practice",    icon:"ğŸ®", label:"Quiz"},
  {id:"dashboard",   icon:"ğŸ“Š", label:"Me"},
];

const TopBar = ({ user, screen, setScreen }) => (
  <div style={{ background:"linear-gradient(135deg,#FF7043,#FF9800)", padding:"11px 16px",
    display:"flex", alignItems:"center", justifyContent:"space-between",
    position:"sticky", top:0, zIndex:300, boxShadow:"0 3px 14px rgba(255,112,67,.35)" }}>
    <div style={{ display:"flex", alignItems:"center", gap:9, cursor:"pointer" }}
      onClick={() => setScreen("home")}>
      <span style={{ fontSize:26 }}>ğŸ“š</span>
      <div>
        <div className="hin" style={{ color:"#fff", fontWeight:900, fontSize:16, lineHeight:1 }}>à¤¹à¤¿à¤‚à¤¦à¥€ à¤ªà¤¾à¤ à¤¶à¤¾à¤²à¤¾</div>
        <div style={{ color:"rgba(255,255,255,.8)", fontSize:9 }}>NEP 2020 Â· Hindi Literacy</div>
      </div>
    </div>
    <div style={{ display:"flex", gap:7, alignItems:"center" }}>
      {user && <div style={{ background:"rgba(255,255,255,.25)", color:"#fff", padding:"4px 11px",
        borderRadius:20, fontSize:11, fontWeight:700 }}>ğŸ‘¤ {user.name}</div>}
      <div style={{ background:"rgba(255,255,255,.25)", color:"#fff", padding:"4px 11px",
        borderRadius:20, fontSize:11, fontWeight:700, cursor:"pointer" }}
        onClick={() => setScreen("teacher")}>ğŸ§‘â€ğŸ«</div>
    </div>
  </div>
);

const BottomNav = ({ screen, setScreen }) => (
  <div style={{ position:"fixed", bottom:0, left:"50%", transform:"translateX(-50%)",
    width:"100%", maxWidth:480, background:"#fff", display:"flex",
    borderTop:"2px solid #f0e8e0", zIndex:300, boxShadow:"0 -4px 20px rgba(0,0,0,.1)" }}>
    {NAV_ITEMS.map(n => {
      const active = screen === n.id;
      return (
        <div key={n.id} onClick={() => setScreen(n.id)}
          style={{ flex:1, padding:"7px 2px 9px", display:"flex", flexDirection:"column",
            alignItems:"center", gap:2, cursor:"pointer",
            borderTop:active?"3px solid #FF7043":"3px solid transparent",
            background:active?"#FBE9E7":"#fff", transition:"all .15s" }}>
          <span style={{ fontSize:17 }}>{n.icon}</span>
          <span style={{ fontSize:8, fontWeight:800, color:active?"#FF7043":"#aaa" }}>{n.label}</span>
        </div>
      );
    })}
  </div>
);

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   AUTH STORAGE  (localStorage as simulated database)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const DB_KEY     = "hp_users_db";
const SESSION_KEY= "hp_session";

const dbGetUsers = () => {
  try { return JSON.parse(localStorage.getItem(DB_KEY) || "[]"); }
  catch { return []; }
};
const dbSaveUsers = (arr) => localStorage.setItem(DB_KEY, JSON.stringify(arr));
const dbFindByEmail = (email) =>
  dbGetUsers().find(u => u.email.toLowerCase() === email.toLowerCase().trim());
const dbAddUser = (user) => {
  const arr = dbGetUsers();
  arr.push(user);
  dbSaveUsers(arr);
};
const dbUpdateUser = (email, patch) => {
  const arr = dbGetUsers().map(u =>
    u.email.toLowerCase() === email.toLowerCase() ? { ...u, ...patch } : u
  );
  dbSaveUsers(arr);
};

const sessionSave  = (token) => localStorage.setItem(SESSION_KEY, token);
const sessionClear = ()      => localStorage.removeItem(SESSION_KEY);
const sessionGet   = ()      => localStorage.getItem(SESSION_KEY);

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   EMAIL SERVICE  (EmailJS REST â€” no backend needed)
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   SETUP (free):
   1. Sign up at https://www.emailjs.com
   2. Add an Email Service (Gmail, Outlook, etc.)
   3. Create a template with these variables:
        {{to_name}}  {{to_email}}  {{otp_code}}  {{message}}  {{subject}}
   4. Replace the three IDs below with your own.
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const EJS_SERVICE  = "YOUR_SERVICE_ID";   // e.g. "service_abc123"
const EJS_TEMPLATE = "YOUR_TEMPLATE_ID";  // e.g. "template_xyz789"
const EJS_KEY      = "YOUR_PUBLIC_KEY";   // e.g. "user_AbCdEfGhIjK"

const EMAIL_CONFIGURED = (
  EJS_SERVICE  !== "YOUR_SERVICE_ID" &&
  EJS_TEMPLATE !== "YOUR_TEMPLATE_ID" &&
  EJS_KEY      !== "YOUR_PUBLIC_KEY"
);

const sendEmail = async ({ to, toName, subject, otp = "", message }) => {
  if (!EMAIL_CONFIGURED) {
    // Demo mode â€” log to console and simulate success
    console.info(`ğŸ“§ [DEMO] Email to ${to}\nSubject: ${subject}\nOTP: ${otp}\n${message}`);
    return { ok: true, demo: true };
  }
  try {
    const res = await fetch("https://api.emailjs.com/api/v1.0/email/send", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        service_id:  EJS_SERVICE,
        template_id: EJS_TEMPLATE,
        user_id:     EJS_KEY,
        template_params: {
          to_name:  toName,
          to_email: to,
          subject,
          otp_code: otp,
          message,
        }
      })
    });
    return { ok: res.status === 200 };
  } catch(e) {
    return { ok: false, error: e.message };
  }
};

const sendWelcomeEmail = (name, email, levelLabel) =>
  sendEmail({
    to: email, toName: name,
    subject: "ğŸ‰ Welcome to à¤¹à¤¿à¤‚à¤¦à¥€ à¤ªà¤¾à¤ à¤¶à¤¾à¤²à¤¾!",
    message: `à¤¨à¤®à¤¸à¥à¤¤à¥‡ ${name}! à¤†à¤ªà¤•à¤¾ à¤¹à¤¿à¤‚à¤¦à¥€ à¤ªà¤¾à¤ à¤¶à¤¾à¤²à¤¾ à¤®à¥‡à¤‚ à¤¸à¥à¤µà¤¾à¤—à¤¤ à¤¹à¥ˆà¥¤\n\nYour account has been created successfully!\nClass: ${levelLabel}\n\nStart learning Hindi today â€” Swar, Vyanjan, Stories, Voice Practice and more await you!\n\nà¤¶à¥à¤­à¤•à¤¾à¤®à¤¨à¤¾à¤à¤,\nà¤¹à¤¿à¤‚à¤¦à¥€ à¤ªà¤¾à¤ à¤¶à¤¾à¤²à¤¾ Team`
  });

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   AI STORY GENERATOR  (Anthropic API â€” Claude)
   Generates endless Hindi stories at increasing difficulty.
   Tracks story history per user in localStorage.
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const STORY_HIST_KEY = "hp_story_history";
const storyHistGet   = (email) => {
  try {
    const all = JSON.parse(localStorage.getItem(STORY_HIST_KEY) || "{}");
    return all[email] || { count: 0, difficulty: 1, usedTitles: [] };
  } catch { return { count: 0, difficulty: 1, usedTitles: [] }; }
};
const storyHistSave  = (email, hist) => {
  try {
    const all = JSON.parse(localStorage.getItem(STORY_HIST_KEY) || "{}");
    all[email] = hist;
    localStorage.setItem(STORY_HIST_KEY, JSON.stringify(all));
  } catch {}
};

// Difficulty labels for the AI prompt
const AI_DIFF_DESC = (d) => {
  if (d <= 2) return "very simple, 5-6 short sentences, only basic 2-3 letter words (à¤¨à¤², à¤˜à¤°, à¤«à¤²), suitable for Balvatika 1 children aged 3-4";
  if (d <= 3) return "simple, 6-7 sentences, words without matras, Balvatika 2 level aged 4-5";
  if (d <= 4) return "easy, 7-8 sentences, words with simple matras (à¤†, à¤‡, à¤ˆ), Balvatika 3 level aged 5-6";
  if (d <= 5) return "moderate easy, 8-9 sentences, varied matras, simple compound words, Class 1 level aged 6-7";
  if (d <= 6) return "moderate, 9-10 sentences, compound words and simple phrases, Class 1-2 level";
  if (d <= 7) return "moderate hard, 10-11 sentences, complex sentences with karak vibhakti, Class 2 level";
  if (d <= 8) return "hard, 11-12 sentences, rich vocabulary, idioms, multi-clause sentences, Class 2 advanced";
  if (d <= 9) return "very hard, 12-14 sentences, complex narrative, vivid descriptions, dialogues";
  return "expert, 14-16 rich sentences, multiple plot twists, complex vocabulary, suitable for highly proficient Class 2";
};

const generateAIStory = async (difficulty = 1, usedTitles = []) => {
  const avoidStr = usedTitles.length > 0
    ? `\nDo NOT use these already-used story titles: ${usedTitles.slice(-20).join(", ")}.`
    : "";

  const prompt = `You are a Hindi children's story writer for NEP 2020 Indian curriculum.
Write an original short Hindi story for children.
Difficulty level: ${difficulty}/10 â€” ${AI_DIFF_DESC(difficulty)}.${avoidStr}

Rules:
- Write the ENTIRE story in Hindi script (Devanagari) ONLY
- Story must be culturally appropriate for Indian children
- Include animals, nature, festivals, or everyday Indian life
- End with a simple moral lesson (à¤¨à¥ˆà¤¤à¤¿à¤• à¤¶à¤¿à¤•à¥à¤·à¤¾)
- Vocabulary must EXACTLY match the difficulty level
- Story must be fresh and original â€” never use Sher-Chuha or Pyasa Kauwa

Return ONLY a valid JSON object, no markdown, no explanation:
{"title":"à¤¹à¤¿à¤‚à¤¦à¥€ à¤¶à¥€à¤°à¥à¤·à¤•","text":"à¤ªà¥‚à¤°à¥€ à¤•à¤¹à¤¾à¤¨à¥€ à¤¹à¤¿à¤‚à¤¦à¥€ à¤®à¥‡à¤‚ à¤µà¤¾à¤•à¥à¤¯à¥‹à¤‚ à¤•à¥‡ à¤¸à¤¾à¤¥à¥¤","moral":"à¤¨à¥ˆà¤¤à¤¿à¤• à¤¶à¤¿à¤•à¥à¤·à¤¾ à¤à¤• à¤µà¤¾à¤•à¥à¤¯ à¤®à¥‡à¤‚à¥¤","difficulty":${difficulty},"emoji":"one relevant emoji character","wordCount":estimated_word_count}`;

  try {
    const res = await fetch("https://api.anthropic.com/v1/messages", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        model: "claude-sonnet-4-20250514",
        max_tokens: 1000,
        messages: [{ role: "user", content: prompt }]
      })
    });
    const data = await res.json();
    const raw = (data.content || []).map(b => b.text || "").join("");
    const clean = raw.replace(/```json|```/gi, "").trim();
    const parsed = JSON.parse(clean);
    return { ...parsed, aiGenerated: true };
  } catch(e) {
    // Fallback to a static story if API fails
    return {
      title: "à¤ªà¤°à¤¿à¤¶à¥à¤°à¤® à¤•à¤¾ à¤«à¤²",
      text: `à¤à¤• à¤—à¤¾à¤à¤µ à¤®à¥‡à¤‚ à¤°à¤¾à¤® à¤¨à¤¾à¤® à¤•à¤¾ à¤²à¤¡à¤¼à¤•à¤¾ à¤°à¤¹à¤¤à¤¾ à¤¥à¤¾à¥¤ à¤µà¤¹ à¤¬à¤¹à¥à¤¤ à¤®à¥‡à¤¹à¤¨à¤¤à¥€ à¤¥à¤¾à¥¤ à¤¹à¤° à¤°à¥‹à¤œà¤¼ à¤µà¤¹ à¤ªà¤¢à¤¼à¤¾à¤ˆ à¤•à¤°à¤¤à¤¾ à¤¥à¤¾à¥¤ à¤‰à¤¸à¤•à¥‡ à¤®à¤¾à¤¤à¤¾-à¤ªà¤¿à¤¤à¤¾ à¤–à¥‡à¤¤ à¤®à¥‡à¤‚ à¤•à¤¾à¤® à¤•à¤°à¤¤à¥‡ à¤¥à¥‡à¥¤ à¤°à¤¾à¤® à¤‰à¤¨à¤•à¥€ à¤®à¤¦à¤¦ à¤­à¥€ à¤•à¤°à¤¤à¤¾ à¤¥à¤¾à¥¤ à¤à¤• à¤¦à¤¿à¤¨ à¤‰à¤¸à¤•à¥‡ à¤¸à¥à¤•à¥‚à¤² à¤®à¥‡à¤‚ à¤ªà¤°à¥€à¤•à¥à¤·à¤¾ à¤¹à¥à¤ˆà¥¤ à¤°à¤¾à¤® à¤¨à¥‡ à¤–à¥‚à¤¬ à¤ªà¤¢à¤¼à¤•à¤° à¤ªà¤°à¥€à¤•à¥à¤·à¤¾ à¤¦à¥€à¥¤ à¤µà¤¹ à¤ªà¥‚à¤°à¥‡ à¤¸à¥à¤•à¥‚à¤² à¤®à¥‡à¤‚ à¤ªà¥à¤°à¤¥à¤® à¤†à¤¯à¤¾à¥¤ à¤¸à¤­à¥€ à¤¨à¥‡ à¤‰à¤¸à¥‡ à¤¶à¤¾à¤¬à¤¾à¤¶à¥€ à¤¦à¥€à¥¤ à¤®à¥‡à¤¹à¤¨à¤¤ à¤•à¤¾ à¤«à¤² à¤®à¥€à¤ à¤¾ à¤¹à¥‹à¤¤à¤¾ à¤¹à¥ˆà¥¤`,
      moral: "à¤®à¥‡à¤¹à¤¨à¤¤ à¤•à¤°à¤¨à¥‡ à¤µà¤¾à¤²à¥‡ à¤•à¥‹ à¤¸à¤«à¤²à¤¤à¤¾ à¤®à¤¿à¤²à¤¤à¥€ à¤¹à¥ˆà¥¤",
      difficulty, emoji: "ğŸ“š", wordCount: 75, aiGenerated: false
    };
  }
};

// Simple token = base64(email:timestamp)
const makeToken = (email) => btoa(email + ":" + Date.now());
const tokenEmail= (tok)   => { try { return atob(tok).split(":")[0]; } catch { return null; } };

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   VALIDATION HELPERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const validateEmail = (e) =>
  /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.trim());

const passwordStrength = (p) => {
  if (p.length < 6)  return { score:0, label:"Too short",  color:"#e53935" };
  if (p.length < 8)  return { score:1, label:"Weak",       color:"#e53935" };
  const has = (re) => re.test(p);
  let score = 1;
  if (has(/[A-Z]/)) score++;
  if (has(/[0-9]/)) score++;
  if (has(/[^A-Za-z0-9]/)) score++;
  if (p.length >= 10) score++;
  if (score <= 1) return { score:1, label:"Weak",      color:"#e53935" };
  if (score === 2) return { score:2, label:"Fair",      color:"#FB8C00" };
  if (score === 3) return { score:3, label:"Good",      color:"#FDD835" };
  if (score === 4) return { score:4, label:"Strong",    color:"#43A047" };
  return              { score:5, label:"Very Strong", color:"#1B5E20" };
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   AUTH INPUT COMPONENT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const AuthInput = ({ label, type="text", value, onChange, placeholder, error, icon, right }) => (
  <div style={{ marginBottom:14 }}>
    <div style={{ fontSize:12, fontWeight:700, color:"#555", marginBottom:5 }}>{label}</div>
    <div style={{ position:"relative" }}>
      {icon && (
        <div style={{ position:"absolute", left:13, top:"50%", transform:"translateY(-50%)",
          fontSize:16, pointerEvents:"none", zIndex:1 }}>{icon}</div>
      )}
      <input type={type} value={value} onChange={onChange} placeholder={placeholder}
        style={{ width:"100%", padding:`13px ${right?44:16}px 13px ${icon?40:16}px`,
          borderRadius:12, fontSize:14, color:"#333", background:"#fff",
          border:`2px solid ${error?"#e53935":"#E8E0D8"}`, transition:"border-color .2s",
          boxSizing:"border-box" }}
        onFocus={e => { if (!error) e.target.style.borderColor="#FF7043"; }}
        onBlur={e  => { if (!error) e.target.style.borderColor="#E8E0D8"; }}
      />
      {right}
    </div>
    {error && (
      <div style={{ color:"#e53935", fontSize:11, marginTop:4, display:"flex",
        alignItems:"center", gap:4 }}>
        <span>âš ï¸</span> {error}
      </div>
    )}
  </div>
);

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PASSWORD STRENGTH BAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const StrengthBar = ({ password }) => {
  if (!password) return null;
  const s = passwordStrength(password);
  return (
    <div style={{ marginTop:-8, marginBottom:14 }}>
      <div style={{ display:"flex", gap:4, marginBottom:4 }}>
        {[1,2,3,4,5].map(i => (
          <div key={i} style={{ flex:1, height:4, borderRadius:4,
            background: i <= s.score ? s.color : "#eee",
            transition:"background .3s" }} />
        ))}
      </div>
      <div style={{ fontSize:11, color:s.color, fontWeight:700 }}>
        Password strength: {s.label}
      </div>
    </div>
  );
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   AUTH SCREEN  (Login Â· SignUp Â· ForgotPassword)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const AuthScreen = ({ onAuthSuccess }) => {
  const [view, setView] = useState("login"); // login | signup | signupVerify | forgot | verifyOtp

  /* â”€â”€ shared state â”€â”€ */
  const [email,    setEmail]    = useState("");
  const [password, setPassword] = useState("");
  const [showPw,   setShowPw]   = useState(false);
  const [loading,  setLoading]  = useState(false);
  const [errors,   setErrors]   = useState({});
  const [toast,    setToast]    = useState(null);

  /* â”€â”€ signup-only â”€â”€ */
  const [fullName,  setFullName]  = useState("");
  const [grade,     setGrade]     = useState("bv1");
  const [confirmPw, setConfirmPw] = useState("");
  const [showCPw,   setShowCPw]   = useState(false);

  /* â”€â”€ OTP state (shared for signup verify + forgot) â”€â”€ */
  const [otp,      setOtp]      = useState(["","","","","",""]);
  const [newPw,    setNewPw]    = useState("");
  const [otpToken, setOtpToken] = useState(""); // the actual code
  const [otpFor,   setOtpFor]   = useState(""); // "signup" | "forgot"

  const otpRefs = useRef([]);

  const showToast = (msg, type="success") => {
    setToast({ msg, type });
    setTimeout(() => setToast(null), 4000);
  };

  const clearErrors = () => setErrors({});

  /* â•â• STEP 1: VALIDATE SIGNUP FORM + SEND EMAIL OTP â•â• */
  const doRequestSignupOtp = async () => {
    const errs = {};
    if (!fullName.trim())           errs.name    = "Full name is required";
    else if (fullName.trim().length < 2) errs.name = "Name must be at least 2 characters";
    if (!validateEmail(email))      errs.email   = "Enter a valid email address";
    else if (dbFindByEmail(email))  errs.email   = "This email is already registered";
    const ps = passwordStrength(password);
    if (password.length < 6)        errs.password= "Password must be at least 6 characters";
    else if (ps.score < 2)          errs.password= "Password is too weak â€” add uppercase/numbers";
    if (confirmPw !== password)     errs.confirm = "Passwords do not match";
    if (Object.keys(errs).length)   { setErrors(errs); return; }

    setLoading(true);
    const code = Math.floor(100000 + Math.random() * 900000).toString();
    setOtpToken(code);
    setOtpFor("signup");
    setOtp(["","","","","",""]);

    const result = await sendEmail({
      to: email.toLowerCase().trim(),
      toName: fullName.trim(),
      subject: "âœ… Verify your à¤¹à¤¿à¤‚à¤¦à¥€ à¤ªà¤¾à¤ à¤¶à¤¾à¤²à¤¾ account",
      otp: code,
      message: `à¤¨à¤®à¤¸à¥à¤¤à¥‡ ${fullName.trim()}!\n\nYour verification code for à¤¹à¤¿à¤‚à¤¦à¥€ à¤ªà¤¾à¤ à¤¶à¤¾à¤²à¤¾ is:\n\nğŸ” ${code}\n\nThis code is valid for 10 minutes. Do not share it with anyone.\n\nIf you did not request this, please ignore this email.`
    });

    setLoading(false);

    if (result.demo) {
      showToast(`ğŸ“§ Demo mode: OTP is ${code} (check browser console). Configure EmailJS to send real emails.`, "info");
    } else if (result.ok) {
      showToast(`âœ… Verification code sent to ${email}!`, "success");
    } else {
      showToast("âš ï¸ Could not send email. Check EmailJS config. Demo OTP: " + code, "info");
    }

    setView("signupVerify");
    clearErrors();
  };

  /* â•â• STEP 2: VERIFY OTP + CREATE ACCOUNT + SEND WELCOME â•â• */
  const doCompleteSignup = async () => {
    const entered = otp.join("");
    if (entered.length < 6) { setErrors({ otp: "Enter the 6-digit code we sent" }); return; }
    if (entered !== otpToken) { setErrors({ otp: "Incorrect code. Please check your email." }); return; }

    setLoading(true);
    clearErrors();
    const lv = LEVELS.find(l => l.id === grade);
    const newUser = {
      id: Date.now().toString(),
      name: fullName.trim(),
      email: email.toLowerCase().trim(),
      password,
      grade, levelLabel: lv.label, levelColor: lv.color,
      points: 0, badges: 0, wpm: 0, streak: 1,
      voiceMatches: 0, endlessCount: 0,
      createdAt: new Date().toISOString(),
      lastLogin:  new Date().toISOString(),
      emailVerified: true,
    };
    dbAddUser(newUser);
    const token = makeToken(newUser.email);
    sessionSave(token);

    // Send welcome email (non-blocking)
    sendWelcomeEmail(newUser.name, newUser.email, lv.label).then(r => {
      if (r.demo) console.info("ğŸ“§ Welcome email (demo):", newUser.email);
    });

    setLoading(false);
    showToast(`ğŸ‰ Account verified! Welcome, ${newUser.name}!`);
    setTimeout(() => onAuthSuccess({ ...newUser }), 900);
  };

  /* â•â• LOGIN â•â• */
  const doLogin = () => {
    const errs = {};
    if (!validateEmail(email))  errs.email    = "Enter a valid email address";
    if (!password)              errs.password = "Password is required";
    if (Object.keys(errs).length) { setErrors(errs); return; }

    setLoading(true);
    setTimeout(() => {
      const found = dbFindByEmail(email);
      if (!found) {
        setErrors({ email:"No account found with this email" });
        setLoading(false); return;
      }
      if (found.password !== password) {
        setErrors({ password:"Incorrect password" });
        setLoading(false); return;
      }
      dbUpdateUser(found.email, { lastLogin: new Date().toISOString() });
      const token = makeToken(found.email);
      sessionSave(token);
      setLoading(false);
      showToast(`Welcome back, ${found.name}! ğŸ‘‹`);
      setTimeout(() => onAuthSuccess({ ...found }), 700);
    }, 900);
  };

  /* â•â• FORGOT PASSWORD â•â• */
  const doForgot = async () => {
    const errs = {};
    if (!validateEmail(email)) { errs.email = "Enter a valid email address"; setErrors(errs); return; }
    const found = dbFindByEmail(email);
    if (!found) { errs.email = "No account found with this email"; setErrors(errs); return; }

    setLoading(true);
    const code = Math.floor(100000 + Math.random() * 900000).toString();
    setOtpToken(code);
    setOtpFor("forgot");
    setOtp(["","","","","",""]);

    const result = await sendEmail({
      to: email.toLowerCase().trim(),
      toName: found.name,
      subject: "ğŸ”‘ Reset your à¤¹à¤¿à¤‚à¤¦à¥€ à¤ªà¤¾à¤ à¤¶à¤¾à¤²à¤¾ password",
      otp: code,
      message: `à¤¨à¤®à¤¸à¥à¤¤à¥‡ ${found.name}!\n\nYour password reset code is:\n\nğŸ” ${code}\n\nThis code expires in 10 minutes.\nIf you did not request this, ignore this email.`
    });

    setLoading(false);
    if (result.demo) {
      showToast(`ğŸ“§ Demo mode: Reset OTP is ${code} (console). Configure EmailJS for real email.`, "info");
    } else if (result.ok) {
      showToast(`âœ… Reset code sent to ${email}!`);
    } else {
      showToast("âš ï¸ Email failed. Demo OTP: " + code, "info");
    }
    setView("verifyOtp");
    clearErrors();
  };

  /* â•â• VERIFY OTP (forgot password flow) â•â• */
  const doVerifyOtp = () => {
    const entered = otp.join("");
    if (entered.length < 6) { setErrors({ otp:"Enter the 6-digit OTP" }); return; }
    if (entered !== otpToken) { setErrors({ otp:"Incorrect OTP. Please check your email." }); return; }
    clearErrors();
  };

  /* â•â• RESET PASSWORD â•â• */
  const doResetPw = () => {
    const errs = {};
    const ps = passwordStrength(newPw);
    if (newPw.length < 6)    errs.newPw = "Password must be at least 6 characters";
    else if (ps.score < 2)   errs.newPw = "Password is too weak";
    if (Object.keys(errs).length) { setErrors(errs); return; }
    dbUpdateUser(email, { password: newPw });
    showToast("Password reset successfully! Please login.");
    setTimeout(() => { setView("login"); setPassword(""); setOtp(["","","","","",""]); }, 1200);
  };

  const handleOtpChange = (val, idx) => {
    const digits = val.replace(/\D/g,"");
    if (!digits && !val) {
      const next = [...otp]; next[idx]=""; setOtp(next);
      if (idx > 0) otpRefs.current[idx-1]?.focus();
      return;
    }
    if (digits.length > 1) {
      const arr = digits.slice(0,6).split("");
      const next = ["","","","","",""];
      arr.forEach((d,i) => { if(i<6) next[i]=d; });
      setOtp(next);
      otpRefs.current[Math.min(arr.length,5)]?.focus();
      return;
    }
    const next = [...otp]; next[idx] = digits;
    setOtp(next);
    if (digits && idx < 5) otpRefs.current[idx+1]?.focus();
  };

  /* â”€â”€ EYE TOGGLE â”€â”€ */
  const EyeBtn = ({ show, toggle }) => (
    <button type="button" onClick={toggle}
      style={{ position:"absolute", right:13, top:"50%", transform:"translateY(-50%)",
        background:"none", border:"none", cursor:"pointer", fontSize:17, color:"#aaa",
        padding:0, lineHeight:1 }}>
      {show ? "ğŸ™ˆ" : "ğŸ‘ï¸"}
    </button>
  );

  /* â”€â”€ BACKGROUND BLOBS â”€â”€ */
  const Blobs = () => (
    <>
      <div style={{ position:"fixed",top:-60,right:-60,width:240,height:240,
        borderRadius:"50%",background:"rgba(255,112,67,.09)",zIndex:0,pointerEvents:"none" }} />
      <div style={{ position:"fixed",bottom:-40,left:-60,width:200,height:200,
        borderRadius:"50%",background:"rgba(255,152,0,.07)",zIndex:0,pointerEvents:"none" }} />
      <div style={{ position:"fixed",top:"40%",left:-30,width:120,height:120,
        borderRadius:"50%",background:"rgba(142,36,170,.06)",zIndex:0,pointerEvents:"none" }} />
    </>
  );

  /* â”€â”€ LOGO HEADER â”€â”€ */
  const LogoHeader = ({ subtitle }) => (
    <div style={{ textAlign:"center", marginBottom:28 }}>
      <div style={{ width:72, height:72, borderRadius:22, margin:"0 auto 12px",
        background:"linear-gradient(135deg,#FF7043,#FF9800)",
        display:"flex", alignItems:"center", justifyContent:"center", fontSize:36,
        boxShadow:"0 8px 28px rgba(255,112,67,.4)" }}>ğŸ“š</div>
      <div className="hin" style={{ fontSize:26, fontWeight:900, color:"#FF7043",
        textShadow:"0 2px 8px rgba(255,112,67,.2)" }}>à¤¹à¤¿à¤‚à¤¦à¥€ à¤ªà¤¾à¤ à¤¶à¤¾à¤²à¤¾</div>
      <div style={{ fontSize:12, color:"#999", marginTop:3 }}>{subtitle}</div>
    </div>
  );

  /* â”€â”€ TOAST â”€â”€ */
  const Toast = () => toast && (
    <div className="pop-in" style={{ position:"fixed", top:16, left:"50%",
      transform:"translateX(-50%)", zIndex:9999, maxWidth:360, width:"90%",
      background: toast.type==="info" ? "#1A237E" : toast.type==="error" ? "#c62828" : "#2e7d32",
      color:"#fff", borderRadius:16, padding:"12px 20px", fontSize:13, fontWeight:700,
      boxShadow:"0 8px 32px rgba(0,0,0,.25)", textAlign:"center" }}>
      {toast.msg}
    </div>
  );

  const cardStyle = {
    background:"#fff", borderRadius:24, padding:"28px 24px",
    boxShadow:"0 8px 40px rgba(0,0,0,.10)", position:"relative", zIndex:1,
  };

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     VIEW: LOGIN
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  if (view === "login") return (
    <div style={{ minHeight:"100vh", background:"linear-gradient(160deg,#FFF9F0,#FFF0E8)",
      display:"flex", flexDirection:"column", justifyContent:"center",
      padding:"20px 20px 40px", position:"relative", overflow:"hidden" }}>
      <Blobs />
      <Toast />
      <LogoHeader subtitle="Sign in to your account" />

      <div style={cardStyle}>
        <div style={{ fontWeight:900, fontSize:22, color:"#222", marginBottom:6 }}>Welcome back! ğŸ‘‹</div>
        <div style={{ fontSize:13, color:"#888", marginBottom:22 }}>Sign in to continue your Hindi journey</div>

        <AuthInput label="Email Address" type="email" value={email} icon="ğŸ“§"
          onChange={e=>{setEmail(e.target.value); setErrors({}); }}
          placeholder="you@example.com" error={errors.email} />

        <AuthInput label="Password" type={showPw?"text":"password"} value={password} icon="ğŸ”’"
          onChange={e=>{setPassword(e.target.value); setErrors({}); }}
          placeholder="Enter your password" error={errors.password}
          right={<EyeBtn show={showPw} toggle={()=>setShowPw(!showPw)} />} />

        <div style={{ textAlign:"right", marginTop:-8, marginBottom:18 }}>
          <span onClick={()=>{ setView("forgot"); clearErrors(); setEmail(""); }}
            style={{ fontSize:12, color:"#FF7043", fontWeight:700, cursor:"pointer",
              textDecoration:"underline" }}>
            Forgot password?
          </span>
        </div>

        <Btn onClick={doLogin} disabled={loading}
          style={{ width:"100%", padding:15, fontSize:15, boxShadow:"0 6px 20px rgba(255,112,67,.4)" }}>
          {loading ? "â³ Signing in..." : "ğŸ” Sign In"}
        </Btn>

        <div style={{ textAlign:"center", marginTop:18, fontSize:13, color:"#888" }}>
          Don't have an account?{" "}
          <span onClick={()=>{ setView("signup"); clearErrors(); }}
            style={{ color:"#FF7043", fontWeight:800, cursor:"pointer" }}>
            Sign Up
          </span>
        </div>
      </div>

      {/* Feature pills */}
      <div style={{ display:"flex", gap:8, marginTop:20, overflowX:"auto", scrollbarWidth:"none",
        position:"relative", zIndex:1 }}>
        {["ğŸµ Audio","ğŸ¤ Voice","â™¾ï¸ Endless","ğŸ† Gamified","ğŸ“– 5-Level Tests"].map(f => (
          <div key={f} style={{ flexShrink:0, background:"rgba(255,255,255,.8)", backdropFilter:"blur(8px)",
            borderRadius:20, padding:"5px 12px", fontSize:10, fontWeight:700,
            color:"#666", border:"1px solid rgba(255,112,67,.2)" }}>{f}</div>
        ))}
      </div>
    </div>
  );

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     VIEW: SIGN UP
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  if (view === "signup") return (
    <div style={{ minHeight:"100vh", background:"linear-gradient(160deg,#FFF9F0,#FFF0E8)",
      display:"flex", flexDirection:"column", justifyContent:"center",
      padding:"20px 20px 40px", position:"relative", overflow:"hidden" }}>
      <Blobs />
      <Toast />
      <LogoHeader subtitle="Create your free account" />

      <div style={cardStyle}>
        <div style={{ fontWeight:900, fontSize:22, color:"#222", marginBottom:6 }}>Create Account ğŸŒŸ</div>
        <div style={{ fontSize:13, color:"#888", marginBottom:22 }}>Join à¤¹à¤¿à¤‚à¤¦à¥€ à¤ªà¤¾à¤ à¤¶à¤¾à¤²à¤¾ for free!</div>

        <AuthInput label="Full Name / à¤ªà¥‚à¤°à¤¾ à¤¨à¤¾à¤®" value={fullName} icon="ğŸ‘¤"
          onChange={e=>{setFullName(e.target.value); setErrors({}); }}
          placeholder="e.g., Priya Sharma" error={errors.name} />

        <AuthInput label="Email Address" type="email" value={email} icon="ğŸ“§"
          onChange={e=>{setEmail(e.target.value); setErrors({}); }}
          placeholder="you@example.com" error={errors.email} />

        {/* Grade selector */}
        <div style={{ marginBottom:14 }}>
          <div style={{ fontSize:12, fontWeight:700, color:"#555", marginBottom:5 }}>Grade / à¤•à¤•à¥à¤·à¤¾</div>
          <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr", gap:8 }}>
            {LEVELS.map(lv => (
              <div key={lv.id} onClick={()=>setGrade(lv.id)}
                style={{ padding:"10px 12px", borderRadius:12, cursor:"pointer",
                  background: grade===lv.id ? lv.bg : "#f8f8f8",
                  border:`2px solid ${grade===lv.id ? lv.color : "#eee"}`,
                  transition:"all .15s" }}>
                <div style={{ display:"flex", alignItems:"center", gap:7 }}>
                  <span style={{ fontSize:18 }}>{lv.icon}</span>
                  <div>
                    <div className="hin" style={{ fontSize:11, fontWeight:800, color:grade===lv.id?lv.color:"#555" }}>
                      {lv.label}
                    </div>
                    <div style={{ fontSize:9, color:"#999" }}>{lv.age}</div>
                  </div>
                </div>
              </div>
            ))}
          </div>
        </div>

        <AuthInput label="Password" type={showPw?"text":"password"} value={password} icon="ğŸ”’"
          onChange={e=>{setPassword(e.target.value); setErrors({}); }}
          placeholder="Minimum 6 characters" error={errors.password}
          right={<EyeBtn show={showPw} toggle={()=>setShowPw(!showPw)} />} />
        <StrengthBar password={password} />

        <AuthInput label="Confirm Password" type={showCPw?"text":"password"} value={confirmPw} icon="ğŸ”‘"
          onChange={e=>{setConfirmPw(e.target.value); setErrors({}); }}
          placeholder="Re-enter your password" error={errors.confirm}
          right={<EyeBtn show={showCPw} toggle={()=>setShowCPw(!showCPw)} />} />

        {/* Requirements checklist */}
        <div style={{ background:"#FFF9F0", borderRadius:12, padding:"10px 14px",
          marginBottom:18, border:"1px solid #FFD0B0" }}>
          <div style={{ fontSize:11, fontWeight:700, color:"#555", marginBottom:6 }}>
            Password must have:
          </div>
          {[
            [password.length >= 6,    "At least 6 characters"],
            [/[A-Z]/.test(password),  "One uppercase letter (A-Z)"],
            [/[0-9]/.test(password),  "One number (0-9)"],
            [confirmPw===password && confirmPw.length>0, "Passwords match"],
          ].map(([ok, label]) => (
            <div key={label} style={{ display:"flex", alignItems:"center", gap:6,
              marginBottom:3, fontSize:11,
              color: ok ? "#2e7d32" : "#999" }}>
              <span>{ok ? "âœ…" : "â­•"}</span> {label}
            </div>
          ))}
        </div>

        <Btn onClick={doRequestSignupOtp} disabled={loading}
          style={{ width:"100%", padding:15, fontSize:15, boxShadow:"0 6px 20px rgba(255,112,67,.4)" }}>
          {loading ? "â³ Sending verification code..." : "ğŸ“§ Send Verification Code"}
        </Btn>

        <div style={{ textAlign:"center", marginTop:18, fontSize:13, color:"#888" }}>
          Already have an account?{" "}
          <span onClick={()=>{ setView("login"); clearErrors(); }}
            style={{ color:"#FF7043", fontWeight:800, cursor:"pointer" }}>
            Sign In
          </span>
        </div>
      </div>
    </div>
  );

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     VIEW: SIGNUP â€” VERIFY EMAIL OTP
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  if (view === "signupVerify") return (
    <div style={{ minHeight:"100vh", background:"linear-gradient(160deg,#FFF9F0,#FFF0E8)",
      display:"flex", flexDirection:"column", justifyContent:"center",
      padding:"20px 20px 40px", position:"relative", overflow:"hidden" }}>
      <Blobs />
      <Toast />
      <LogoHeader subtitle="Verify your email" />

      <div style={cardStyle}>
        <div style={{ textAlign:"center", marginBottom:22 }}>
          <div style={{ fontSize:54 }}>ğŸ“¬</div>
          <div style={{ fontWeight:900, fontSize:20, color:"#222", marginTop:10 }}>
            Check your Email!
          </div>
          <div style={{ fontSize:12, color:"#888", marginTop:6, lineHeight:1.6 }}>
            We sent a 6-digit verification code to:<br/>
            <strong style={{ color:"#FF7043", fontSize:13 }}>{email}</strong>
          </div>
          {!EMAIL_CONFIGURED && (
            <div style={{ marginTop:10, background:"#FFF3E0", borderRadius:10,
              padding:"8px 12px", fontSize:11, color:"#E65100", border:"1px solid #FFCC80" }}>
              âš™ï¸ <strong>Demo mode</strong> â€” EmailJS not configured.<br/>
              OTP is shown in browser console (F12 â†’ Console).
            </div>
          )}
        </div>

        {/* 6-box OTP */}
        <div style={{ display:"flex", gap:8, justifyContent:"center", marginBottom:8 }}>
          {otp.map((digit, i) => (
            <input key={i} ref={el=>otpRefs.current[i]=el}
              value={digit} maxLength={6}
              onChange={e => { handleOtpChange(e.target.value, i); setErrors({}); }}
              onKeyDown={e => { if (e.key==="Backspace" && !digit && i>0) otpRefs.current[i-1]?.focus(); }}
              style={{ width:44, height:52, textAlign:"center", fontSize:22, fontWeight:900,
                borderRadius:12, border:`2px solid ${errors.otp?"#e53935":digit?"#FF7043":"#E8E0D8"}`,
                outline:"none", color:"#333", background:"#fff",
                boxShadow: digit ? "0 2px 10px rgba(255,112,67,.2)" : "none" }} />
          ))}
        </div>
        {errors.otp && (
          <div style={{ textAlign:"center", color:"#e53935", fontSize:12, marginBottom:12 }}>
            âš ï¸ {errors.otp}
          </div>
        )}

        <div style={{ textAlign:"center", marginBottom:18 }}>
          <div style={{ fontSize:11, color:"#aaa" }}>
            Didn't receive it? Check spam folder.
          </div>
          <span onClick={() => doRequestSignupOtp()}
            style={{ fontSize:12, color:"#FF7043", fontWeight:700,
              cursor:"pointer", textDecoration:"underline" }}>
            Resend code
          </span>
        </div>

        {/* Summary of what they're creating */}
        <div style={{ background:"#F3E5F5", borderRadius:12, padding:"10px 14px",
          marginBottom:18, border:"1px solid #CE93D8" }}>
          <div style={{ fontSize:11, fontWeight:700, color:"#7B1FA2", marginBottom:6 }}>
            ğŸ“‹ Account Summary
          </div>
          <div style={{ fontSize:12, color:"#555" }}>
            <div>ğŸ‘¤ {fullName}</div>
            <div>ğŸ“§ {email}</div>
            <div>ğŸ“ {LEVELS.find(l=>l.id===grade)?.label} ({LEVELS.find(l=>l.id===grade)?.age})</div>
          </div>
        </div>

        <Btn onClick={doCompleteSignup} disabled={loading}
          style={{ width:"100%", padding:15, fontSize:15, boxShadow:"0 6px 20px rgba(255,112,67,.4)" }}>
          {loading ? "â³ Creating your account..." : "âœ… Verify & Create Account"}
        </Btn>

        <div style={{ textAlign:"center", marginTop:14 }}>
          <span onClick={() => { setView("signup"); clearErrors(); }}
            style={{ fontSize:12, color:"#888", cursor:"pointer", textDecoration:"underline" }}>
            â† Back to sign up form
          </span>
        </div>
      </div>
    </div>
  );

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     VIEW: FORGOT PASSWORD
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  if (view === "forgot") return (
    <div style={{ minHeight:"100vh", background:"linear-gradient(160deg,#FFF9F0,#FFF0E8)",
      display:"flex", flexDirection:"column", justifyContent:"center",
      padding:"20px 20px 40px", position:"relative", overflow:"hidden" }}>
      <Blobs />
      <Toast />
      <LogoHeader subtitle="Reset your password" />

      <div style={cardStyle}>
        <div onClick={()=>{ setView("login"); clearErrors(); }}
          style={{ display:"flex", alignItems:"center", gap:6, color:"#FF7043",
            fontSize:12, fontWeight:700, cursor:"pointer", marginBottom:20 }}>
          â† Back to Sign In
        </div>

        <div style={{ textAlign:"center", marginBottom:24 }}>
          <div style={{ fontSize:48 }}>ğŸ”‘</div>
          <div style={{ fontWeight:900, fontSize:20, color:"#222", marginTop:8 }}>Forgot Password?</div>
          <div style={{ fontSize:12, color:"#888", marginTop:4 }}>
            Enter your registered email. We'll send you a reset OTP.
          </div>
        </div>

        <AuthInput label="Registered Email" type="email" value={email} icon="ğŸ“§"
          onChange={e=>{setEmail(e.target.value); setErrors({}); }}
          placeholder="you@example.com" error={errors.email} />

        <Btn onClick={doForgot} disabled={loading}
          style={{ width:"100%", padding:15, fontSize:15, boxShadow:"0 6px 20px rgba(255,112,67,.4)" }}>
          {loading ? "â³ Sending OTP..." : "ğŸ“¨ Send Reset OTP"}
        </Btn>
      </div>
    </div>
  );

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     VIEW: VERIFY OTP
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  if (view === "verifyOtp") return (
    <div style={{ minHeight:"100vh", background:"linear-gradient(160deg,#FFF9F0,#FFF0E8)",
      display:"flex", flexDirection:"column", justifyContent:"center",
      padding:"20px 20px 40px", position:"relative", overflow:"hidden" }}>
      <Blobs />
      <Toast />
      <LogoHeader subtitle="Enter verification code" />

      <div style={cardStyle}>
        <div style={{ textAlign:"center", marginBottom:24 }}>
          <div style={{ fontSize:48 }}>ğŸ“²</div>
          <div style={{ fontWeight:900, fontSize:20, color:"#222", marginTop:8 }}>Enter OTP</div>
          <div style={{ fontSize:12, color:"#888", marginTop:4 }}>
            A 6-digit code was sent to<br />
            <strong style={{ color:"#FF7043" }}>{email}</strong>
          </div>
        </div>

        {/* OTP boxes */}
        <div style={{ display:"flex", gap:8, justifyContent:"center", marginBottom:16 }}>
          {otp.map((digit, i) => (
            <input key={i} ref={el=>otpRefs.current[i]=el}
              value={digit} maxLength={6}
              onChange={e => { handleOtpChange(e.target.value, i); setErrors({}); }}
              onKeyDown={e => { if (e.key==="Backspace" && !digit && i>0) otpRefs.current[i-1]?.focus(); }}
              style={{ width:44, height:52, textAlign:"center", fontSize:22, fontWeight:900,
                borderRadius:12, border:`2px solid ${errors.otp?"#e53935":digit?"#FF7043":"#E8E0D8"}`,
                outline:"none", color:"#333", background:"#fff",
                boxShadow: digit ? "0 2px 10px rgba(255,112,67,.2)" : "none" }} />
          ))}
        </div>
        {errors.otp && <div style={{ textAlign:"center", color:"#e53935",
          fontSize:12, marginBottom:12 }}>âš ï¸ {errors.otp}</div>}

        {/* New password */}
        <AuthInput label="New Password" type={showPw?"text":"password"} value={newPw} icon="ğŸ”’"
          onChange={e=>{setNewPw(e.target.value); setErrors({}); }}
          placeholder="Enter new password" error={errors.newPw}
          right={<EyeBtn show={showPw} toggle={()=>setShowPw(!showPw)} />} />
        <StrengthBar password={newPw} />

        <Btn onClick={() => { doVerifyOtp(); if (!errors.otp) doResetPw(); }}
          style={{ width:"100%", padding:15, fontSize:15, boxShadow:"0 6px 20px rgba(255,112,67,.4)" }}>
          âœ… Verify & Reset Password
        </Btn>

        <div style={{ textAlign:"center", marginTop:14 }}>
          <span onClick={()=>doForgot()} style={{ fontSize:12, color:"#FF7043",
            fontWeight:700, cursor:"pointer", textDecoration:"underline" }}>
            Didn't receive code? Resend
          </span>
        </div>
      </div>
    </div>
  );

  return null;
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WELCOME HOME (shown when already logged in, at /home)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const HomeScreen = ({ user, setUser, setScreen }) => {
  const lv = LEVELS.find(l => l.id === user.grade) || LEVELS[0];
  return (
    <div className="fade-up" style={{ minHeight:"calc(100vh - 56px)",
      background:"linear-gradient(160deg,#FFF9F0,#FFF0E8)", paddingBottom:90 }}>
      {/* Hero banner */}
      <div style={{ background:`linear-gradient(135deg,${lv.color},${lv.color}cc)`,
        padding:"28px 22px 34px", position:"relative", overflow:"hidden" }}>
        <div style={{ position:"absolute",top:-40,right:-40,width:180,height:180,
          borderRadius:"50%",background:"rgba(255,255,255,.1)" }} />
        <div style={{ position:"absolute",bottom:-30,left:-20,width:120,height:120,
          borderRadius:"50%",background:"rgba(255,255,255,.07)" }} />
        <div style={{ color:"rgba(255,255,255,.85)", fontSize:13, marginBottom:4 }}>à¤¨à¤®à¤¸à¥à¤¤à¥‡! ğŸ™</div>
        <div style={{ color:"#fff", fontWeight:900, fontSize:26, lineHeight:1.2 }}>
          {user.name}
        </div>
        <div style={{ display:"flex", alignItems:"center", gap:8, marginTop:6 }}>
          <div style={{ background:"rgba(255,255,255,.25)", borderRadius:10,
            padding:"4px 12px", fontSize:12, color:"#fff", fontWeight:700 }}>
            <span className="hin">{lv.label}</span> Â· {lv.age}
          </div>
          <div style={{ background:"rgba(255,255,255,.25)", borderRadius:10,
            padding:"4px 12px", fontSize:12, color:"#fff", fontWeight:700 }}>
            â­ {user.points} pts
          </div>
        </div>

        {/* Quick stats */}
        <div style={{ display:"flex", gap:10, marginTop:20 }}>
          {[["ğŸ”¥", user.streak||1, "Streak"],["ğŸ“–",user.wpm||0,"WPM"],["â™¾ï¸",user.endlessCount||0,"Practice"]].map(([ic,v,l]) => (
            <div key={l} style={{ background:"rgba(255,255,255,.18)", borderRadius:12,
              padding:"10px 8px", flex:1, textAlign:"center" }}>
              <div style={{ fontSize:18 }}>{ic}</div>
              <div style={{ color:"#fff", fontWeight:900, fontSize:18, lineHeight:1 }}>{v}</div>
              <div style={{ color:"rgba(255,255,255,.75)", fontSize:9, marginTop:2 }}>{l}</div>
            </div>
          ))}
        </div>
      </div>

      {/* Quick actions */}
      <div style={{ padding:"18px 20px 0" }}>
        <div style={{ fontWeight:800, fontSize:15, color:"#333", marginBottom:12 }}>
          ğŸš€ Continue Learning
        </div>
        <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr", gap:12, marginBottom:16 }}>
          {[
            {id:"learn",       icon:"âœï¸", label:"Learn Letters",  sub:"Swar Â· Vyanjan Â· Matras", color:"#FF7043", bg:"#FBE9E7"},
            {id:"reading",     icon:"ğŸ“–", label:"Reading Test",   sub:"5 levels Â· WPM grade",   color:"#1E88E5", bg:"#E3F2FD"},
            {id:"endless",     icon:"â™¾ï¸", label:"Endless Quiz",   sub:"Never-ending practice",  color:"#8E24AA", bg:"#F3E5F5"},
            {id:"practice",    icon:"ğŸ®", label:"Quiz",           sub:"3 quiz categories",       color:"#43A047", bg:"#E8F5E9"},
          ].map(item => (
            <div key={item.id} onClick={() => setScreen(item.id)}
              style={{ background:item.bg, borderRadius:18, padding:"16px 14px",
                cursor:"pointer", boxShadow:"0 3px 14px rgba(0,0,0,.07)",
                border:`2px solid ${item.color}20`, transition:"transform .15s" }}
              onMouseEnter={e=>e.currentTarget.style.transform="translateY(-3px)"}
              onMouseLeave={e=>e.currentTarget.style.transform="none"}>
              <div style={{ fontSize:30, marginBottom:8 }}>{item.icon}</div>
              <div style={{ fontWeight:800, fontSize:14, color:item.color }}>{item.label}</div>
              <div style={{ fontSize:10, color:"#888", marginTop:3 }}>{item.sub}</div>
            </div>
          ))}
        </div>

        {/* App features banner */}
        <div style={{ background:"linear-gradient(135deg,#1A237E,#283593)",
          borderRadius:18, padding:"16px 18px", marginBottom:16 }}>
          <div style={{ color:"rgba(255,255,255,.8)", fontSize:11, marginBottom:8 }}>
            ğŸŒŸ Everything in à¤¹à¤¿à¤‚à¤¦à¥€ à¤ªà¤¾à¤ à¤¶à¤¾à¤²à¤¾
          </div>
          <div style={{ display:"flex", flexWrap:"wrap", gap:8 }}>
            {["ğŸµ Audio TTS","ğŸ¤ Voice Record","ğŸ“– 5-Level Reading","â™¾ï¸ Endless Practice",
              "ğŸ† Leaderboard","ğŸ“Š WPM Tracker","ğŸ“œ Certificates","ğŸ§‘â€ğŸ« Teacher Panel"].map(f => (
              <div key={f} style={{ background:"rgba(255,255,255,.15)", borderRadius:10,
                padding:"4px 10px", fontSize:10, color:"rgba(255,255,255,.9)", fontWeight:600 }}>
                {f}
              </div>
            ))}
          </div>
        </div>

        {/* My progress shortcut */}
        <div onClick={() => setScreen("dashboard")}
          style={{ background:"#fff", borderRadius:18, padding:"14px 18px",
            display:"flex", alignItems:"center", gap:14, cursor:"pointer",
            boxShadow:"0 3px 14px rgba(0,0,0,.07)", marginBottom:16 }}>
          <div style={{ background:"#FBE9E7", borderRadius:12, width:46, height:46,
            display:"flex", alignItems:"center", justifyContent:"center", fontSize:22 }}>ğŸ“Š</div>
          <div style={{ flex:1 }}>
            <div style={{ fontWeight:800, fontSize:14, color:"#333" }}>My Full Progress</div>
            <div style={{ fontSize:11, color:"#888", marginTop:2 }}>
              Level progress Â· Badges Â· Weekly chart
            </div>
          </div>
          <div style={{ color:"#FF7043", fontSize:20 }}>â€º</div>
        </div>
      </div>
    </div>
  );
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   VOICE RECORD HOOK
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MIC PERMISSION HOOK
   Explicitly requests microphone access and tracks state
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const useMicPermission = () => {
  const [micState, setMicState] = useState("unknown"); // unknown | granted | denied | prompt | unsupported
  const streamRef = useRef(null);

  const checkPermission = useCallback(async () => {
    if (!navigator.mediaDevices || !window.MediaRecorder) {
      setMicState("unsupported"); return "unsupported";
    }
    try {
      const result = await navigator.permissions.query({ name: "microphone" });
      setMicState(result.state); // "granted" | "denied" | "prompt"
      result.onchange = () => setMicState(result.state);
      return result.state;
    } catch {
      // Firefox doesn't support permissions.query for mic â€” assume prompt
      setMicState("prompt"); return "prompt";
    }
  }, []);

  const requestPermission = useCallback(async () => {
    try {
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      streamRef.current = stream;
      setMicState("granted");
      return { ok: true, stream };
    } catch(e) {
      setMicState(e.name === "NotAllowedError" ? "denied" : "error");
      return { ok: false, error: e.message };
    }
  }, []);

  const releaseStream = useCallback(() => {
    if (streamRef.current) {
      streamRef.current.getTracks().forEach(t => t.stop());
      streamRef.current = null;
    }
  }, []);

  useEffect(() => { checkPermission(); }, []);
  useEffect(() => () => releaseStream(), []);

  return { micState, checkPermission, requestPermission, releaseStream, streamRef };
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   VOICE CAPTURE HOOK
   Records real audio + runs speech recognition in parallel
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const useVoiceCapture = () => {
  const [recState,   setRecState]   = useState("idle");   // idle|recording|done|error
  const [audioURL,   setAudioURL]   = useState(null);     // blob URL for playback
  const [transcript, setTranscript] = useState("");
  const [duration,   setDuration]   = useState(0);        // recording seconds

  const mediaRecRef  = useRef(null);
  const chunksRef    = useRef([]);
  const recognRef    = useRef(null);
  const timerRef     = useRef(null);
  const prevURLRef   = useRef(null);

  // Clean up old blob URL to avoid memory leaks
  const revokePrev = () => {
    if (prevURLRef.current) {
      URL.revokeObjectURL(prevURLRef.current);
      prevURLRef.current = null;
    }
  };

  const startRecording = useCallback(async (stream) => {
    if (!stream) return;
    setRecState("recording");
    setTranscript("");
    setAudioURL(null);
    setDuration(0);
    chunksRef.current = [];
    revokePrev();

    // â”€â”€ MediaRecorder for real audio â”€â”€
    let mimeType = "audio/webm";
    if (!MediaRecorder.isTypeSupported(mimeType)) mimeType = "audio/ogg";
    if (!MediaRecorder.isTypeSupported(mimeType)) mimeType = "";
    const mr = new MediaRecorder(stream, mimeType ? { mimeType } : {});
    mediaRecRef.current = mr;
    mr.ondataavailable = e => { if (e.data.size > 0) chunksRef.current.push(e.data); };
    mr.onstop = () => {
      const blob = new Blob(chunksRef.current, { type: mimeType || "audio/webm" });
      const url  = URL.createObjectURL(blob);
      prevURLRef.current = url;
      setAudioURL(url);
      setRecState("done");
    };
    mr.start(100); // collect data every 100ms

    // â”€â”€ SpeechRecognition for transcript matching â”€â”€
    const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (SR) {
      const rec = new SR();
      rec.lang = "hi-IN"; rec.continuous = false; rec.interimResults = false;
      rec.maxAlternatives = 5;
      recognRef.current = rec;
      rec.onresult = e => {
        const best = Array.from(e.results[0]).map(r => r.transcript).join(" ").trim();
        setTranscript(best);
      };
      rec.onerror = () => {}; // silent â€” audio playback still works
      try { rec.start(); } catch {}
    }

    // Duration timer
    timerRef.current = setInterval(() => setDuration(d => d + 1), 1000);
  }, []);

  const stopRecording = useCallback(() => {
    clearInterval(timerRef.current);
    if (recognRef.current)  try { recognRef.current.stop(); }  catch {}
    if (mediaRecRef.current && mediaRecRef.current.state !== "inactive") {
      mediaRecRef.current.stop();
    }
  }, []);

  const reset = useCallback(() => {
    clearInterval(timerRef.current);
    if (recognRef.current)  try { recognRef.current.abort(); } catch {}
    if (mediaRecRef.current && mediaRecRef.current.state !== "inactive") {
      try { mediaRecRef.current.stop(); } catch {}
    }
    revokePrev();
    setRecState("idle");
    setAudioURL(null);
    setTranscript("");
    setDuration(0);
  }, []);

  useEffect(() => () => { reset(); }, []);

  return { recState, audioURL, transcript, duration, startRecording, stopRecording, reset };
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   AUDIO PLAYER COMPONENT
   Plays back recorded audio with waveform-style progress bar
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const AudioPlayer = ({ url, color = "#FF7043" }) => {
  const [playing,  setPlaying]  = useState(false);
  const [progress, setProgress] = useState(0);
  const [totalSec, setTotalSec] = useState(0);
  const audioRef = useRef(null);

  useEffect(() => {
    // Reset when URL changes
    setPlaying(false); setProgress(0); setTotalSec(0);
  }, [url]);

  const toggle = () => {
    const a = audioRef.current;
    if (!a) return;
    if (playing) { a.pause(); setPlaying(false); }
    else         { a.play().catch(() => {}); setPlaying(true); }
  };

  const fmtTime = s => `${Math.floor(s/60)}:${String(Math.floor(s%60)).padStart(2,"0")}`;

  if (!url) return null;

  return (
    <div style={{ background:"#fff", borderRadius:16, padding:"14px 16px",
      border:`2px solid ${color}30`, boxShadow:"0 2px 12px rgba(0,0,0,.08)" }}>
      {/* Hidden audio element */}
      <audio ref={audioRef} src={url}
        onTimeUpdate={e => setProgress(e.target.currentTime / (e.target.duration || 1))}
        onLoadedMetadata={e => setTotalSec(e.target.duration)}
        onEnded={() => { setPlaying(false); setProgress(0); if (audioRef.current) audioRef.current.currentTime = 0; }}
      />

      <div style={{ display:"flex", alignItems:"center", gap:12 }}>
        {/* Play/Pause button */}
        <div onClick={toggle}
          style={{ width:48, height:48, borderRadius:"50%", flexShrink:0,
            background:`linear-gradient(135deg,${color},${color}bb)`,
            display:"flex", alignItems:"center", justifyContent:"center",
            cursor:"pointer", boxShadow:`0 4px 14px ${color}44`,
            fontSize:20, userSelect:"none" }}>
          {playing ? "â¸" : "â–¶ï¸"}
        </div>

        <div style={{ flex:1 }}>
          <div style={{ fontSize:11, fontWeight:700, color:"#555", marginBottom:5 }}>
            ğŸ§ Your Recording
          </div>
          {/* Progress track */}
          <div style={{ background:"#f0f0f0", borderRadius:8, height:8,
            cursor:"pointer", position:"relative", overflow:"hidden" }}
            onClick={e => {
              const rect = e.currentTarget.getBoundingClientRect();
              const pct  = (e.clientX - rect.left) / rect.width;
              if (audioRef.current) {
                audioRef.current.currentTime = pct * audioRef.current.duration;
                setProgress(pct);
              }
            }}>
            <div style={{ width:`${progress * 100}%`, height:"100%",
              background:`linear-gradient(90deg,${color},${color}bb)`,
              borderRadius:8, transition:"width .1s linear" }} />
            {/* Animated bars when playing */}
            {playing && (
              <div style={{ position:"absolute", right:6, top:"50%", transform:"translateY(-50%)",
                display:"flex", gap:2, alignItems:"center" }}>
                {[1,2,3,4,5].map((_, i) => (
                  <div key={i} style={{
                    width:3, borderRadius:2, background:color,
                    height: `${4 + Math.random() * 10}px`,
                    animation:`bounce ${0.4 + i*0.1}s ease-in-out infinite alternate`
                  }} />
                ))}
              </div>
            )}
          </div>
          <div style={{ display:"flex", justifyContent:"space-between",
            fontSize:10, color:"#aaa", marginTop:3 }}>
            <span>{fmtTime((audioRef.current?.currentTime) || 0)}</span>
            <span>{fmtTime(totalSec)}</span>
          </div>
        </div>
      </div>
    </div>
  );
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MIC PERMISSION GATE SCREEN
   Shows before any voice feature â€” asks user to allow mic
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const MicPermissionGate = ({ onGranted, onDenied }) => {
  const [requesting, setRequesting] = useState(false);
  const { requestPermission } = useMicPermission();

  const handleAllow = async () => {
    setRequesting(true);
    const result = await requestPermission();
    setRequesting(false);
    if (result.ok) onGranted(result.stream);
    else           onDenied();
  };

  return (
    <div className="fade-up" style={{ background:"#fff", borderRadius:20,
      padding:"28px 22px", textAlign:"center",
      boxShadow:"0 8px 32px rgba(0,0,0,.10)", border:"2px solid #FFD0B0" }}>
      {/* Animated mic icon */}
      <div style={{ width:80, height:80, borderRadius:"50%",
        background:"linear-gradient(135deg,#FF7043,#FF9800)",
        display:"flex", alignItems:"center", justifyContent:"center",
        fontSize:38, margin:"0 auto 16px",
        boxShadow:"0 6px 24px rgba(255,112,67,.4)" }}>
        ğŸ¤
      </div>
      <div style={{ fontWeight:900, fontSize:19, color:"#222", marginBottom:8 }}>
        Microphone Permission Needed
      </div>
      <div style={{ fontSize:13, color:"#666", lineHeight:1.6, marginBottom:20 }}>
        To record and play back your voice, the app needs access to your microphone.
        <br/><br/>
        <span style={{ background:"#FFF3E0", borderRadius:8, padding:"4px 10px",
          fontSize:11, fontWeight:700, color:"#E65100" }}>
          â„¹ï¸ Your audio stays on your device â€” nothing is uploaded
        </span>
      </div>

      {/* Browser tip */}
      <div style={{ background:"#E3F2FD", borderRadius:12, padding:"10px 14px",
        marginBottom:20, fontSize:11, color:"#1565C0", textAlign:"left" }}>
        <strong>ğŸ“Œ When Chrome asks:</strong><br/>
        Tap <strong>"Allow"</strong> in the popup that appears at the top of your browser.
        If you accidentally blocked it, click the ğŸ”’ lock icon in the address bar â†’ Microphone â†’ Allow.
      </div>

      <div style={{ display:"flex", gap:10 }}>
        <Btn onClick={handleAllow} disabled={requesting}
          style={{ flex:2, padding:14, fontSize:14,
            boxShadow:"0 4px 16px rgba(255,112,67,.4)" }}>
          {requesting ? "â³ Requesting..." : "ğŸ¤ Allow Microphone"}
        </Btn>
        <Btn onClick={onDenied} color="#888" style={{ flex:1, padding:14, fontSize:13 }}>
          Skip
        </Btn>
      </div>
    </div>
  );
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   VOICE PRACTICE COMPONENT  (upgraded: real audio + playback)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const VoicePractice = ({ user, setUser }) => {
  const [itemIdx,  setItemIdx]  = useState(0);
  const [result,   setResult]   = useState(null);     // null|correct|close|wrong
  const [micReady, setMicReady] = useState(false);    // has mic permission been granted?
  const [stream,   setStream]   = useState(null);     // active MediaStream
  const [showPermGate, setShowPermGate] = useState(false);

  const { micState, checkPermission, requestPermission } = useMicPermission();
  const { recState, audioURL, transcript, duration,
          startRecording, stopRecording, reset } = useVoiceCapture();

  const pool = [
    ...SWAR.map(s => ({ word:s.eg, display:s.a, label:s.eg, hint:s.em })),
    ...WORDS.map(w => ({ word:w.w,  display:w.w, label:w.m,  hint:w.em })),
  ];
  const item = pool[itemIdx % pool.length];

  // Check permission on mount
  useEffect(() => {
    checkPermission().then(state => {
      if (state === "granted") setMicReady(true);
    });
  }, []);

  // When transcript arrives after recording, auto-check result
  useEffect(() => {
    if (recState === "done" && transcript) checkMatch(transcript);
  }, [recState, transcript]);

  const checkMatch = (said) => {
    if (!said) return; // no transcript â€” user can still listen to playback, just no match score
    const saidClean = said.replace(/\s/g,"").toLowerCase();
    const target    = item.word.replace(/\s/g,"").toLowerCase();
    if (saidClean.includes(target) || target.includes(saidClean)) {
      setResult("correct");
      if (user) setUser(u => ({ ...u, points:u.points+15, voiceMatches:(u.voiceMatches||0)+1 }));
    } else if (levenshtein(saidClean, target) <= 2) {
      setResult("close");
      if (user) setUser(u => ({ ...u, points:u.points+5 }));
    } else {
      setResult("wrong");
    }
  };

  const handleGranted = (s) => {
    setStream(s);
    setMicReady(true);
    setShowPermGate(false);
  };

  const handleMicBtn = async () => {
    // Already have a live stream?
    if (micReady && stream) { startRecording(stream); return; }
    // Try to get stream
    const res = await requestPermission();
    if (res.ok) { setStream(res.stream); setMicReady(true); startRecording(res.stream); }
    else        { setShowPermGate(true); }
  };

  const next = () => {
    setItemIdx(i => i+1);
    setResult(null);
    reset();
  };

  const isRecording  = recState === "recording";
  const isDone       = recState === "done";
  const supportsRec  = !!window.MediaRecorder && !!navigator.mediaDevices;

  if (!supportsRec) return (
    <div style={{ background:"#FFEBEE", borderRadius:16, padding:24, textAlign:"center" }}>
      <div style={{ fontSize:40, marginBottom:10 }}>ğŸ˜”</div>
      <div style={{ fontWeight:700, color:"#c62828", marginBottom:8 }}>
        Voice Recording Not Supported
      </div>
      <div style={{ fontSize:12, color:"#888" }}>
        Please use <strong>Google Chrome</strong> on Android or Desktop.
        Make sure you're on a secure <strong>https://</strong> connection.
      </div>
    </div>
  );

  return (
    <div>
      {/* Permission Gate overlay */}
      {showPermGate && (
        <div style={{ marginBottom:16 }}>
          <MicPermissionGate
            onGranted={handleGranted}
            onDenied={() => setShowPermGate(false)}
          />
        </div>
      )}

      {!showPermGate && (
        <>
          {/* â”€â”€ Target word card â”€â”€ */}
          <div style={{ background:"linear-gradient(135deg,#FFF3E0,#FBE9E7)",
            borderRadius:18, padding:"24px 20px", marginBottom:14, textAlign:"center",
            border:`2px solid ${result==="correct"?"#43A047":result==="close"?"#FB8C00":result==="wrong"?"#e53935":isRecording?"#e53935":"#FFD0B0"}`,
            transition:"border-color .3s" }}>
            <div style={{ fontSize:52, marginBottom:6 }}>{item.hint}</div>
            <div className="hin" style={{ fontSize:44, fontWeight:900, color:"#333", lineHeight:1 }}>
              {item.display}
            </div>
            <div style={{ fontSize:12, color:"#888", marginTop:4 }}>{item.label}</div>
            <button onClick={() => speak(item.word)}
              style={{ marginTop:12, background:"#FF7043", color:"#fff", border:"none",
                borderRadius:12, padding:"8px 22px", fontWeight:700, cursor:"pointer", fontSize:13 }}>
              ğŸ”Š Hear it
            </button>
          </div>

          {/* â”€â”€ Mic status bar â”€â”€ */}
          <div style={{ display:"flex", alignItems:"center", gap:8, marginBottom:12,
            background: micReady?"#E8F5E9":"#FFF3E0", borderRadius:10, padding:"8px 14px",
            border:`1px solid ${micReady?"#A5D6A7":"#FFE0B2"}` }}>
            <div style={{ fontSize:16 }}>{micReady?"âœ…":"âš ï¸"}</div>
            <div style={{ fontSize:11, color:micReady?"#2e7d32":"#E65100", fontWeight:700 }}>
              {micReady
                ? "Microphone: Ready"
                : "Microphone permission needed â€” tap the mic button below"}
            </div>
          </div>

          {/* â”€â”€ Instruction â”€â”€ */}
          <div style={{ textAlign:"center", color:"#888", fontSize:12, marginBottom:16,
            fontWeight:600 }}>
            {!micReady       ? "ğŸ‘‡ Tap the mic button to allow microphone access" :
             recState==="idle"    ? "ğŸ‘‡ Tap & hold the mic, say the word aloud in Hindi" :
             isRecording          ? `ğŸ”´ Recording... ${duration}s â€” tap STOP when done` :
             isDone               ? "âœ… Recorded! Listen below or try again" :
             "âŒ Error. Try again."}
          </div>

          {/* â”€â”€ Record / Stop buttons â”€â”€ */}
          <div style={{ display:"flex", justifyContent:"center", gap:16, marginBottom:16 }}>
            {/* MIC button â€” shows when idle or needs permission */}
            {!isRecording && (
              <div onClick={handleMicBtn}
                style={{ width:96, height:96, borderRadius:"50%",
                  background: micReady
                    ? "linear-gradient(135deg,#FF7043,#FF9800)"
                    : "linear-gradient(135deg,#78909C,#546E7A)",
                  display:"flex", flexDirection:"column", alignItems:"center",
                  justifyContent:"center", cursor:"pointer",
                  boxShadow: micReady
                    ? "0 6px 24px rgba(255,112,67,.5)"
                    : "0 4px 16px rgba(0,0,0,.2)",
                  userSelect:"none" }}>
                <div style={{ fontSize:36 }}>ğŸ¤</div>
                <div style={{ color:"#fff", fontSize:9, fontWeight:800, letterSpacing:.5 }}>
                  {micReady ? "TAP TO RECORD" : "ALLOW MIC"}
                </div>
              </div>
            )}

            {/* STOP button â€” pulsing red while recording */}
            {isRecording && (
              <div onClick={stopRecording} className="pulse"
                style={{ width:96, height:96, borderRadius:"50%",
                  background:"linear-gradient(135deg,#e53935,#b71c1c)",
                  display:"flex", flexDirection:"column", alignItems:"center",
                  justifyContent:"center", cursor:"pointer",
                  boxShadow:"0 6px 28px rgba(229,57,53,.6)", userSelect:"none" }}>
                <div style={{ fontSize:36 }}>â¹</div>
                <div style={{ color:"#fff", fontSize:9, fontWeight:800 }}>STOP {duration}s</div>
              </div>
            )}
          </div>

          {/* â”€â”€ AUDIO PLAYBACK â”€â”€ */}
          {isDone && audioURL && (
            <div className="pop-in" style={{ marginBottom:14 }}>
              <AudioPlayer url={audioURL} color="#FF7043" />
              <div style={{ textAlign:"center", fontSize:11, color:"#888", marginTop:6 }}>
                ğŸ‘† Tap â–¶ to listen to your recording
              </div>
            </div>
          )}

          {/* â”€â”€ Transcript result card â”€â”€ */}
          {isDone && (
            <div className="pop-in" style={{ marginBottom:14 }}>
              <div style={{ background:
                  result==="correct"?"#E8F5E9":result==="close"?"#FFF3E0":
                  result===null?"#F3E5F5":"#FFEBEE",
                borderRadius:14, padding:"13px 16px", textAlign:"center",
                border:`2px solid ${result==="correct"?"#43A047":result==="close"?"#FB8C00":result===null?"#CE93D8":"#e53935"}` }}>
                {transcript ? (
                  <>
                    <div style={{ fontSize:11, color:"#888", marginBottom:4 }}>You said:</div>
                    <div className="hin" style={{ fontSize:22, fontWeight:800,
                      color:result==="correct"?"#2e7d32":result==="close"?"#e65100":result===null?"#6A1B9A":"#c62828" }}>
                      {transcript}
                    </div>
                    <div style={{ fontSize:20, marginTop:8 }}>
                      {result==="correct"?"ğŸ‰ à¤¶à¤¾à¤¬à¤¾à¤¶! Perfect match!":
                       result==="close"  ?"ğŸ”¶ Almost there!":
                       result===null     ?"ğŸ§ Listen to your recording above":
                                          "âŒ Try again â€” speak more clearly"}
                    </div>
                    {result==="correct" && (
                      <div style={{ fontSize:11, color:"#2e7d32", fontWeight:700, marginTop:4 }}>
                        +15 points! ğŸ…
                      </div>
                    )}
                  </>
                ) : (
                  <>
                    <div style={{ fontSize:24 }}>ğŸ§</div>
                    <div style={{ fontWeight:700, color:"#6A1B9A", fontSize:13, marginTop:6 }}>
                      Recording saved! Listen to your voice above.
                    </div>
                    <div style={{ fontSize:11, color:"#888", marginTop:4 }}>
                      (Speech-to-text didn't catch it â€” try Chrome or speak clearly)
                    </div>
                  </>
                )}
              </div>
            </div>
          )}

          {/* â”€â”€ Action buttons â”€â”€ */}
          <div style={{ display:"flex", gap:10 }}>
            {isDone && (
              <Btn onClick={() => { setResult(null); reset(); }} color="#1E88E5"
                style={{ flex:1, padding:13 }}>
                ğŸ”„ Try Again
              </Btn>
            )}
            <Btn onClick={next} color="#43A047" style={{ flex:1, padding:13 }}>
              Next Word â†’
            </Btn>
          </div>

          {user && (
            <div style={{ marginTop:14, textAlign:"center", fontSize:12, color:"#888" }}>
              ğŸ¤ Voice matches: {user.voiceMatches||0} / 10 for ğŸ¤ Voice Star badge
            </div>
          )}
        </>
      )}
    </div>
  );
};

// Simple Levenshtein distance for fuzzy matching
const levenshtein = (a, b) => {
  const m = a.length, n = b.length;
  const dp = Array.from({length:m+1}, (_,i) => Array.from({length:n+1}, (_,j) => i===0?j:j===0?i:0));
  for (let i=1;i<=m;i++) for (let j=1;j<=n;j++)
    dp[i][j] = a[i-1]===b[j-1] ? dp[i-1][j-1] : 1+Math.min(dp[i-1][j],dp[i][j-1],dp[i-1][j-1]);
  return dp[m][n];
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCREEN: LEARN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const LearnScreen = ({ user, setUser }) => {
  const [tab, setTab]       = useState("swar");
  const [active, setActive] = useState(null);
  const [timerOn, setTimerOn] = useState(false);
  const [secs, setSecs]     = useState(0);
  const [wpmWords, setWpmWords] = useState(0);
  const timerRef = useRef(null);

  const TABS = [
    {id:"swar",    label:"à¤¸à¥à¤µà¤°",     icon:"ğŸ”¤"},
    {id:"vyanjan", label:"à¤µà¥à¤¯à¤‚à¤œà¤¨",   icon:"ğŸ“"},
    {id:"matras",  label:"à¤®à¤¾à¤¤à¥à¤°à¤¾à¤à¤", icon:"ğŸ” "},
    {id:"words",   label:"à¤¶à¤¬à¥à¤¦",     icon:"ğŸ“–"},
    {id:"sentences",label:"à¤µà¤¾à¤•à¥à¤¯",   icon:"âœï¸"},
    {id:"story",   label:"à¤•à¤¹à¤¾à¤¨à¥€",    icon:"ğŸ“•"},
    {id:"speed",   label:"Speed",    icon:"â±ï¸"},
    {id:"voice",   label:"ğŸ¤ Record", icon:"ğŸ¤"},
  ];

  const tap = (text) => { setActive(text); speak(text); if(user) setUser(u=>({...u,points:u.points+1})); };
  const startTimer = () => { if(timerOn) return; setTimerOn(true); setSecs(0); setWpmWords(0); timerRef.current=setInterval(()=>setSecs(s=>s+1),1000); };
  const stopTimer  = () => {
    clearInterval(timerRef.current); setTimerOn(false);
    const w=secs>0?Math.round((wpmWords/secs)*60):0;
    if(user&&w>0) setUser(u=>({...u,wpm:Math.max(u.wpm,w),points:u.points+20}));
  };
  const wpm = secs>0 ? Math.round((wpmWords/secs)*60) : 0;
  const timeStr = `${String(Math.floor(secs/60)).padStart(2,"0")}:${String(secs%60).padStart(2,"0")}`;
  const PASSAGE = SENTENCES.join(" ");

  return (
    <div className="fade-up" style={{ minHeight:"calc(100vh-56px)", background:"#FFF9F0", paddingBottom:90, paddingTop:8 }}>
      <div style={{ padding:"0 20px 10px" }}>
        <H>âœï¸ Learn Hindi / à¤¹à¤¿à¤‚à¤¦à¥€ à¤¸à¥€à¤–à¥‡à¤‚</H>
        <div style={{ fontSize:11, color:"#888", marginBottom:10 }}>ğŸ”Š Tap any card to hear pronunciation!</div>
      </div>

      <div style={{ display:"flex", gap:7, padding:"0 20px 14px", overflowX:"auto", scrollbarWidth:"none" }}>
        {TABS.map(t => (
          <div key={t.id} onClick={() => { setTab(t.id); setActive(null); }}
            style={{ flexShrink:0, background:tab===t.id?"#FF7043":"#fff",
              color:tab===t.id?"#fff":"#666", padding:"6px 13px", borderRadius:20,
              fontSize:11, fontWeight:700, cursor:"pointer",
              boxShadow:"0 2px 8px rgba(0,0,0,.08)",
              border:tab===t.id?"none":"2px solid #f0e8e0" }}>
            {t.icon} <span className="hin">{t.label}</span>
          </div>
        ))}
      </div>

      <div style={{ padding:"0 20px" }}>
        {/* SWAR */}
        {tab==="swar" && (
          <div className="fade-up">
            <div style={{ display:"grid", gridTemplateColumns:"repeat(3,1fr)", gap:10 }}>
              {SWAR.map(s => (
                <div key={s.a} onClick={() => tap(s.eg)}
                  style={{ background:active===s.eg?"#FF7043":"#fff",
                    color:active===s.eg?"#fff":"#333",
                    borderRadius:16, padding:"13px 8px", textAlign:"center", cursor:"pointer",
                    boxShadow:"0 3px 12px rgba(0,0,0,.08)",
                    border:`2px solid ${active===s.eg?"#FF7043":"#FFD0B0"}`, transition:"all .15s" }}>
                  <div style={{ fontSize:24 }}>{s.em}</div>
                  <div className="hin" style={{ fontSize:30, fontWeight:900, lineHeight:1.1 }}>{s.a}</div>
                  <div className="hin" style={{ fontSize:10, marginTop:2, opacity:.75 }}>{s.eg}</div>
                </div>
              ))}
            </div>
          </div>
        )}

        {/* VYANJAN */}
        {tab==="vyanjan" && (
          <div className="fade-up">
            <div style={{ display:"grid", gridTemplateColumns:"repeat(3,1fr)", gap:10 }}>
              {VYANJAN.map(v => (
                <div key={v.a} onClick={() => tap(v.eg)}
                  style={{ background:active===v.eg?"#1E88E5":"#fff",
                    color:active===v.eg?"#fff":"#333",
                    borderRadius:14, padding:"12px 8px", textAlign:"center", cursor:"pointer",
                    boxShadow:"0 2px 10px rgba(0,0,0,.07)",
                    border:`2px solid ${active===v.eg?"#1E88E5":"#D6EAF8"}`, transition:"all .15s" }}>
                  <div style={{ fontSize:20 }}>{v.em}</div>
                  <div className="hin" style={{ fontSize:28, fontWeight:900, lineHeight:1.1 }}>{v.a}</div>
                  <div className="hin" style={{ fontSize:10, marginTop:2, opacity:.75 }}>{v.eg}</div>
                </div>
              ))}
            </div>
          </div>
        )}

        {/* MATRAS */}
        {tab==="matras" && (
          <div className="fade-up">
            {MATRAS.map(m => (
              <div key={m.sym} onClick={() => tap(m.eg)}
                style={{ background:"#fff", borderRadius:14, padding:"13px 16px",
                  marginBottom:9, display:"flex", alignItems:"center", gap:14,
                  cursor:"pointer", boxShadow:"0 2px 10px rgba(0,0,0,.07)",
                  border:active===m.eg?`2px solid ${m.color}`:"2px solid #f0f0f0", transition:"border-color .2s" }}>
                <div style={{ background:m.color+"22", width:54, height:54, borderRadius:14,
                  display:"flex", alignItems:"center", justifyContent:"center" }}>
                  <span className="hin" style={{ fontSize:28, fontWeight:900, color:m.color }}>{m.sym}</span>
                </div>
                <div style={{ flex:1 }}>
                  <div className="hin" style={{ fontSize:13, fontWeight:700, color:"#444" }}>{m.name}</div>
                  <div className="hin" style={{ fontSize:22, fontWeight:900, color:"#222", marginTop:2 }}>{m.eg}</div>
                </div>
                <div style={{ background:m.color, color:"#fff", borderRadius:10,
                  padding:"5px 12px", fontSize:13, fontWeight:700 }}>ğŸ”Š</div>
              </div>
            ))}
          </div>
        )}

        {/* WORDS */}
        {tab==="words" && (
          <div className="fade-up">
            <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr", gap:12 }}>
              {WORDS.map(w => (
                <div key={w.w} onClick={() => tap(w.w)}
                  style={{ background:active===w.w?"#43A047":"#fff",
                    color:active===w.w?"#fff":"#333",
                    borderRadius:16, padding:"14px 12px", textAlign:"center", cursor:"pointer",
                    boxShadow:"0 3px 14px rgba(0,0,0,.08)",
                    border:`2px solid ${active===w.w?"#43A047":"#E8F5E9"}`, transition:"all .15s" }}>
                  <div style={{ fontSize:28, marginBottom:4 }}>{w.em}</div>
                  <div className="hin" style={{ fontSize:22, fontWeight:900 }}>{w.w}</div>
                  <div style={{ fontSize:10, opacity:.7, marginTop:3 }}>{w.m}</div>
                </div>
              ))}
            </div>
          </div>
        )}

        {/* SENTENCES */}
        {tab==="sentences" && (
          <div className="fade-up">
            {SENTENCES.map((s, i) => (
              <div key={i} onClick={() => tap(s)}
                style={{ background:active===s?"#FB8C00":"#fff",
                  borderRadius:14, padding:"14px 18px", marginBottom:9,
                  display:"flex", alignItems:"center", gap:12, cursor:"pointer",
                  boxShadow:"0 2px 10px rgba(0,0,0,.07)",
                  border:`2px solid ${active===s?"#FB8C00":"#FFF3E0"}`, transition:"all .15s" }}>
                <div style={{ background:active===s?"rgba(255,255,255,.3)":"#FFF3E0",
                  borderRadius:10, width:34, height:34, display:"flex", alignItems:"center",
                  justifyContent:"center", fontWeight:800, fontSize:15, flexShrink:0,
                  color:active===s?"#fff":"#FB8C00" }}>{i+1}</div>
                <div className="hin" style={{ fontSize:17, fontWeight:700, flex:1, lineHeight:1.4,
                  color:active===s?"#fff":"#333" }}>{s}</div>
                <div style={{ fontSize:18 }}>ğŸ”Š</div>
              </div>
            ))}
          </div>
        )}

        {/* STORY */}
        {tab==="story" && (
          <div className="fade-up">
            <Card style={{ background:"linear-gradient(135deg,#FFF3E0,#FBE9E7)", marginBottom:14 }}>
              <div style={{ fontWeight:800, fontSize:15, color:"#FF7043", marginBottom:10 }}>
                ğŸ“• à¤¶à¥‡à¤° à¤”à¤° à¤šà¥‚à¤¹à¤¾ â€” The Lion & the Mouse
              </div>
              <div style={{ display:"flex", gap:8, marginBottom:12 }}>
                <Btn onClick={()=>speak(STORY,0.7)} color="#FF7043" style={{ flex:1, padding:10, fontSize:12 }}>ğŸ”Š Read Full Story</Btn>
                <Btn onClick={()=>window.speechSynthesis.cancel()} color="#888" style={{ flex:1, padding:10, fontSize:12 }}>â¹ Stop</Btn>
              </div>
              {STORY.split("\n").map((line, i) => (
                <div key={i} onClick={() => tap(line)}
                  style={{ cursor:"pointer", padding:"7px 10px", borderRadius:10, marginBottom:3,
                    background:active===line?"#FF7043":"transparent", transition:"background .15s" }}>
                  <span className="hin" style={{ fontSize:15, fontWeight:600, lineHeight:2,
                    color:active===line?"#fff":"#333" }}>{line}</span>
                </div>
              ))}
            </Card>
          </div>
        )}

        {/* SPEED TEST */}
        {tab==="speed" && (
          <div className="fade-up">
            <div style={{ fontSize:11, color:"#888", marginBottom:12 }}>
              Press Start â†’ read aloud â†’ tap each word as you say it â†’ Stop to see your WPM
            </div>
            <div style={{ display:"flex", gap:8, marginBottom:14 }}>
              {[["â±ï¸",timeStr,"Time","#FF7043"],["ğŸ“–",wpmWords,"Words","#43A047"],["âš¡",wpm,"WPM","#1E88E5"]].map(([icon,val,label,color]) => (
                <div key={label} style={{ flex:1, background:"#fff", borderRadius:14, padding:"10px 6px",
                  textAlign:"center", boxShadow:"0 2px 10px rgba(0,0,0,.08)" }}>
                  <div style={{ fontSize:16 }}>{icon}</div>
                  <div style={{ fontSize:22, fontWeight:900, color }}>{val}</div>
                  <div style={{ fontSize:9, color:"#888" }}>{label}</div>
                </div>
              ))}
            </div>
            <Card style={{ marginBottom:12, border:timerOn?"2px solid #FF7043":"2px solid #f0f0f0", padding:"12px 14px" }}>
              <div style={{ fontSize:10, color:timerOn?"#FF7043":"#bbb", fontWeight:700, marginBottom:8 }}>
                {timerOn?"ğŸ”´ Recording â€” tap words as you read!":"Press START, then tap each word as you read it aloud"}
              </div>
              <div className="hin" style={{ fontSize:16, lineHeight:2.5, color:"#333", fontWeight:500 }}>
                {PASSAGE.split(" ").map((word, i) => (
                  <span key={i} onClick={() => { if(!timerOn) return; speak(word); setWpmWords(w=>w+1); }}
                    style={{ display:"inline-block", cursor:timerOn?"pointer":"default",
                      padding:"1px 4px", margin:"0 1px", borderRadius:6, transition:"background .1s",
                      userSelect:"none" }}
                    onMouseEnter={e => { if(timerOn) e.currentTarget.style.background="#FFF3E0"; }}
                    onMouseLeave={e => { e.currentTarget.style.background="transparent"; }}>
                    {word}
                  </span>
                ))}
              </div>
            </Card>
            <div style={{ display:"flex", gap:10 }}>
              <Btn onClick={startTimer} disabled={timerOn} color="#43A047" style={{ flex:1, fontSize:14 }}>â–¶ Start</Btn>
              <Btn onClick={stopTimer}  disabled={!timerOn} color="#E53935" style={{ flex:1, fontSize:14 }}>â¹ Stop</Btn>
            </div>
            {!timerOn && wpm > 0 && (
              <div className="pop-in" style={{ marginTop:14, background:"linear-gradient(135deg,#FF7043,#FF9800)",
                borderRadius:16, padding:"18px 20px", textAlign:"center", color:"#fff" }}>
                <div style={{ fontSize:10, opacity:.9 }}>Your Reading Speed</div>
                <div style={{ fontSize:52, fontWeight:900, lineHeight:1 }}>{wpm}</div>
                <div style={{ fontSize:14, fontWeight:700 }}>Words Per Minute</div>
                <div style={{ fontSize:11, marginTop:6, opacity:.85 }}>
                  {wpm<15?"ğŸŒ± Keep practicing!":wpm<30?"â­ Good progress!":wpm<45?"ğŸš€ Excellent!":"ğŸ† Grade 2 target achieved!"}
                </div>
              </div>
            )}
          </div>
        )}

        {/* VOICE RECORD */}
        {tab==="voice" && (
          <div className="fade-up">
            <div style={{ background:"linear-gradient(135deg,#FBE9E7,#FFF3E0)", borderRadius:16,
              padding:"14px 16px", marginBottom:16, border:"2px solid #FFD0B0" }}>
              <div style={{ fontWeight:800, fontSize:14, color:"#FF7043", marginBottom:4 }}>ğŸ¤ Listen & Repeat</div>
              <div style={{ fontSize:11, color:"#666" }}>
                1. Tap ğŸ”Š to hear the word  2. Tap the mic and say it  3. See if you matched!
              </div>
            </div>
            <VoicePractice user={user} setUser={setUser} />
          </div>
        )}
      </div>
    </div>
  );
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCREEN: QUIZ (Regular â€” 3 sets)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const QuizScreen = ({ user, setUser }) => {
  const [mode,    setMode]    = useState("menu");
  const [qIdx,    setQIdx]    = useState(0);
  const [score,   setScore]   = useState(0);
  const [chosen,  setChosen]  = useState(null);
  const [correct, setCorrect] = useState(null);

  const buildSwarQs = () => SWAR.slice(0,5).map(s => ({
    q:`'${s.eg}' à¤•à¤¿à¤¸ à¤¸à¥à¤µà¤° à¤¸à¥‡ à¤¶à¥à¤°à¥‚ à¤¹à¥‹à¤¤à¤¾ à¤¹à¥ˆ?`, img:s.em, answer:s.a,
    choices:shuffle([s.a,...SWAR.filter(x=>x.a!==s.a).slice(0,3).map(x=>x.a)]),
    speak:s.eg,
  }));
  const buildWordQs = () => WORDS.slice(0,5).map(w => ({
    q:`'${w.em}' à¤•à¤¾ à¤¹à¤¿à¤‚à¤¦à¥€ à¤¶à¤¬à¥à¤¦ à¤•à¥à¤¯à¤¾ à¤¹à¥ˆ?`, img:w.em, answer:w.w,
    choices:shuffle([w.w,...WORDS.filter(x=>x.w!==w.w).slice(0,3).map(x=>x.w)]),
    speak:w.w,
  }));
  const buildMatraQs = () => MATRAS.slice(0,5).map(m => ({
    q:`'${m.eg}' à¤®à¥‡à¤‚ à¤•à¥Œà¤¨ à¤¸à¥€ à¤®à¤¾à¤¤à¥à¤°à¤¾ à¤¹à¥ˆ?`, img:m.eg, answer:m.sym,
    choices:shuffle([m.sym,...MATRAS.filter(x=>x.sym!==m.sym).slice(0,3).map(x=>x.sym)]),
    speak:m.eg,
  }));

  const QUIZZES = {
    swar:  {title:"ğŸ”¤ à¤¸à¥à¤µà¤° Quiz",   color:"#FF7043", bg:"#FBE9E7", build:buildSwarQs},
    words: {title:"ğŸ“– à¤¶à¤¬à¥à¤¦ Quiz",   color:"#43A047", bg:"#E8F5E9", build:buildWordQs},
    matra: {title:"ğŸ”  à¤®à¤¾à¤¤à¥à¤°à¤¾ Quiz", color:"#8E24AA", bg:"#F3E5F5", build:buildMatraQs},
  };

  const [questions, setQuestions] = useState([]);

  const startQuiz = (type) => {
    setMode(type); setQIdx(0); setScore(0); setChosen(null); setCorrect(null);
    setQuestions(QUIZZES[type].build());
  };

  const choose = (i) => {
    if (chosen !== null) return;
    const q = questions[qIdx];
    const ok = i === q.choices.indexOf(q.answer);
    setChosen(i); setCorrect(ok);
    speak(ok ? "à¤¶à¤¾à¤¬à¤¾à¤¶" : "à¤«à¤¿à¤° à¤•à¥‹à¤¶à¤¿à¤¶ à¤•à¤°à¥‹");
    if (ok) setScore(s=>s+1);
  };

  const next = () => {
    if (qIdx+1 >= questions.length) {
      if (user) setUser(u=>({...u, points:u.points+score*25}));
      setMode("result");
    } else { setQIdx(q=>q+1); setChosen(null); setCorrect(null); }
  };

  if (mode==="menu") return (
    <div className="fade-up" style={{ minHeight:"calc(100vh-56px)",
      background:"#FFF9F0", paddingBottom:90, paddingTop:8 }}>
      <div style={{ padding:"0 20px" }}>
        <H>ğŸ® Quiz / à¤ªà¤°à¥€à¤•à¥à¤·à¤¾</H>
        <div style={{ fontSize:11, color:"#888", marginBottom:18 }}>5 questions Â· 25 points each Â· 125 pts max</div>
        {Object.entries(QUIZZES).map(([id,q]) => (
          <div key={id} onClick={() => startQuiz(id)}
            style={{ background:q.bg, border:`2px solid ${q.color}25`,
              borderRadius:18, padding:"18px 20px", marginBottom:14,
              cursor:"pointer", boxShadow:"0 3px 14px rgba(0,0,0,.07)" }}>
            <div className="hin" style={{ fontWeight:800, fontSize:20, color:q.color }}>{q.title}</div>
            <div style={{ fontSize:12, color:"#777", marginTop:4 }}>
              {id==="swar"?"Identify vowels from pictures":id==="words"?"Match Hindi words to images":"Identify matras in words"}
            </div>
            <div style={{ display:"flex", justifyContent:"flex-end", marginTop:12 }}>
              <div style={{ background:q.color, color:"#fff", borderRadius:10,
                padding:"6px 18px", fontWeight:800, fontSize:13 }}>Start â†’</div>
            </div>
          </div>
        ))}
        <div style={{ marginTop:8, textAlign:"center" }}>
          <div style={{ fontSize:12, color:"#888" }}>Want unlimited questions?</div>
          <div style={{ fontSize:12, color:"#FF7043", fontWeight:700 }}>Tap â™¾ï¸ Endless in the nav below!</div>
        </div>
      </div>
    </div>
  );

  if (mode==="result") {
    const pct = Math.round((score/questions.length)*100);
    return (
      <div className="fade-up" style={{ minHeight:"calc(100vh-56px)",
        background:"#FFF9F0", paddingBottom:90, paddingTop:8 }}>
        <div style={{ padding:"0 20px", textAlign:"center" }}>
          <div className="bounce" style={{ fontSize:80, marginTop:30 }}>
            {pct>=80?"ğŸ†":pct>=60?"â­":"ğŸ“š"}
          </div>
          <div style={{ fontWeight:800, fontSize:24, color:"#333", marginTop:16 }}>
            {pct>=80?"à¤¶à¤¾à¤¬à¤¾à¤¶! Excellent!":pct>=60?"à¤…à¤šà¥à¤›à¤¾! Good job!":"Keep practicing!"}
          </div>
          <div className="pop-in" style={{ background:"linear-gradient(135deg,#FF7043,#FF9800)",
            borderRadius:20, padding:24, margin:"20px 0", color:"#fff" }}>
            <div style={{ fontSize:56, fontWeight:900, lineHeight:1 }}>{score}/{questions.length}</div>
            <div style={{ fontSize:16, fontWeight:700, marginTop:6 }}>{pct}% Correct</div>
            <div style={{ fontSize:13, marginTop:6, opacity:.85 }}>+{score*25} points earned!</div>
          </div>
          <Btn onClick={() => setMode("menu")} style={{ width:"100%", padding:15 }}>ğŸ® Try Another Quiz</Btn>
        </div>
      </div>
    );
  }

  if (!questions.length) return null;
  const qSet  = QUIZZES[mode];
  const q     = questions[qIdx];
  const ansIdx = q.choices.indexOf(q.answer);

  return (
    <div className="fade-up" style={{ minHeight:"calc(100vh-56px)",
      background:"#FFF9F0", paddingBottom:90, paddingTop:8 }}>
      <div style={{ padding:"0 20px" }}>
        <div style={{ display:"flex", alignItems:"center", justifyContent:"space-between", marginBottom:10 }}>
          <div className="hin" style={{ fontWeight:800, fontSize:15, color:qSet.color }}>{qSet.title}</div>
          <div style={{ background:qSet.color+"20", color:qSet.color,
            padding:"4px 12px", borderRadius:20, fontSize:12, fontWeight:700 }}>
            {qIdx+1}/{questions.length}
          </div>
        </div>
        <Bar pct={(qIdx/questions.length)*100} color={qSet.color} />
        <div style={{ fontSize:11, color:"#888", marginTop:4, marginBottom:16 }}>Score: {score} Â· +{score*25} pts</div>

        <Card style={{ textAlign:"center", marginBottom:18, padding:"22px 20px" }}>
          <div className="hin" style={{ fontSize:52, lineHeight:1, marginBottom:8 }}>{q.img}</div>
          <div className="hin" style={{ fontSize:17, fontWeight:700, color:"#333" }}>{q.q}</div>
          <button onClick={() => speak(q.speak)}
            style={{ marginTop:10, background:"none", border:"2px solid #FFD0B0",
              borderRadius:10, padding:"5px 14px", cursor:"pointer", fontSize:12,
              color:"#FF7043", fontWeight:700 }}>ğŸ”Š à¤¸à¥à¤¨à¥‹</button>
        </Card>

        <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr", gap:11, marginBottom:18 }}>
          {q.choices.map((choice, i) => {
            let bg="#fff", border="#f0f0f0", textColor="#333";
            if (chosen!==null) {
              if (i===ansIdx) { bg="#E8F5E9"; border="#43A047"; textColor="#2e7d32"; }
              else if (i===chosen&&!correct) { bg="#FFEBEE"; border="#e53935"; textColor="#c62828"; }
            }
            return (
              <div key={i} onClick={() => choose(i)}
                style={{ background:bg, border:`2px solid ${border}`, borderRadius:14,
                  padding:"15px 12px", textAlign:"center",
                  cursor:chosen===null?"pointer":"default", transition:"all .2s",
                  boxShadow:"0 2px 10px rgba(0,0,0,.07)" }}>
                <div className="hin" style={{ fontSize:21, fontWeight:900, color:textColor }}>
                  {chosen!==null&&i===ansIdx?"âœ… ":chosen===i&&!correct?"âŒ ":""}{choice}
                </div>
              </div>
            );
          })}
        </div>

        {chosen!==null && (
          <div className="pop-in">
            <div style={{ background:correct?"#E8F5E9":"#FFEBEE", borderRadius:14,
              padding:"11px 16px", textAlign:"center", marginBottom:12,
              border:`2px solid ${correct?"#43A047":"#e53935"}` }}>
              <div style={{ fontSize:22 }}>{correct?"ğŸ‰":"ğŸ˜…"}</div>
              <div className="hin" style={{ fontWeight:800, fontSize:15,
                color:correct?"#2e7d32":"#c62828" }}>
                {correct?"à¤¶à¤¾à¤¬à¤¾à¤¶! Correct!":` à¤¸à¤¹à¥€ à¤‰à¤¤à¥à¤¤à¤°: ${q.answer}`}
              </div>
            </div>
            <Btn onClick={next} style={{ width:"100%", padding:14 }}>
              {qIdx+1<questions.length?"Next Question â†’":"ğŸ See Results"}
            </Btn>
          </div>
        )}
      </div>
    </div>
  );
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCREEN: ENDLESS PRACTICE â™¾ï¸
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const EndlessScreen = ({ user, setUser }) => {
  const [qNum,    setQNum]    = useState(0);
  const [score,   setScore]   = useState(0);
  const [streak,  setStreak]  = useState(0);
  const [chosen,  setChosen]  = useState(null);
  const [correct, setCorrect] = useState(null);
  const [filter,  setFilter]  = useState("all"); // all | swar | word | meaning | matra | vyanjan
  const [bestStreak, setBestStreak] = useState(0);
  const [showStats, setShowStats]   = useState(false);

  const getQ = useCallback((num) => {
    // Build full pool based on filter
    let pool = [];
    if (filter==="all"||filter==="swar")
      SWAR.forEach(s => pool.push({type:"à¤¸à¥à¤µà¤°",q:`'${s.eg}' à¤•à¤¿à¤¸ à¤¸à¥à¤µà¤° à¤¸à¥‡ à¤¶à¥à¤°à¥‚ à¤¹à¥‹à¤¤à¤¾ à¤¹à¥ˆ?`,img:s.em,answer:s.a,choices:shuffle([s.a,...SWAR.filter(x=>x.a!==s.a).slice(0,3).map(x=>x.a)]),speak:s.eg,color:"#FF7043"}));
    if (filter==="all"||filter==="word")
      WORDS.forEach(w => pool.push({type:"à¤¶à¤¬à¥à¤¦",q:`'${w.em}' à¤•à¤¾ à¤¹à¤¿à¤‚à¤¦à¥€ à¤¶à¤¬à¥à¤¦?`,img:w.em,answer:w.w,choices:shuffle([w.w,...WORDS.filter(x=>x.w!==w.w).slice(0,3).map(x=>x.w)]),speak:w.w,color:"#43A047"}));
    if (filter==="all"||filter==="meaning")
      WORDS.forEach(w => pool.push({type:"à¤…à¤°à¥à¤¥",q:`'${w.w}' à¤•à¤¾ à¤…à¤°à¥à¤¥?`,img:w.em,answer:w.m,choices:shuffle([w.m,...WORDS.filter(x=>x.m!==w.m).slice(0,3).map(x=>x.m)]),speak:w.w,color:"#1E88E5"}));
    if (filter==="all"||filter==="matra")
      MATRAS.forEach(m => pool.push({type:"à¤®à¤¾à¤¤à¥à¤°à¤¾",q:`'${m.eg}' à¤®à¥‡à¤‚ à¤•à¥Œà¤¨ à¤¸à¥€ à¤®à¤¾à¤¤à¥à¤°à¤¾?`,img:m.eg,answer:m.sym,choices:shuffle([m.sym,...MATRAS.filter(x=>x.sym!==m.sym).slice(0,3).map(x=>x.sym)]),speak:m.eg,color:"#8E24AA"}));
    if (filter==="all"||filter==="vyanjan")
      VYANJAN.forEach(v => pool.push({type:"à¤µà¥à¤¯à¤‚à¤œà¤¨",q:`'${v.eg}' à¤•à¤¿à¤¸ à¤µà¥à¤¯à¤‚à¤œà¤¨ à¤¸à¥‡?`,img:v.em,answer:v.a,choices:shuffle([v.a,...VYANJAN.filter(x=>x.a!==v.a).slice(0,3).map(x=>x.a)]),speak:v.eg,color:"#E53935"}));
    if (!pool.length) pool = [...WORDS.map(w => ({type:"à¤¶à¤¬à¥à¤¦",q:`'${w.em}' à¤•à¤¾ à¤¹à¤¿à¤‚à¤¦à¥€ à¤¶à¤¬à¥à¤¦?`,img:w.em,answer:w.w,choices:shuffle([w.w,...WORDS.filter(x=>x.w!==w.w).slice(0,3).map(x=>x.w)]),speak:w.w,color:"#43A047"}))];
    return pool[num % pool.length];
  }, [filter]);

  const q = getQ(qNum);
  const ansIdx = q.choices.indexOf(q.answer);

  const choose = (i) => {
    if (chosen!==null) return;
    const ok = i===ansIdx;
    setChosen(i); setCorrect(ok);
    speak(ok ? "à¤¶à¤¾à¤¬à¤¾à¤¶" : "à¤«à¤¿à¤° à¤•à¥‹à¤¶à¤¿à¤¶ à¤•à¤°à¥‹");
    if (ok) {
      const newStreak = streak+1;
      setScore(s=>s+1);
      setStreak(newStreak);
      setBestStreak(b=>Math.max(b,newStreak));
      if (user) {
        const bonus = newStreak>=5?30:newStreak>=3?20:10;
        setUser(u=>({...u, points:u.points+bonus, endlessCount:(u.endlessCount||0)+1}));
      }
    } else {
      setStreak(0);
    }
  };

  const next = () => { setQNum(n=>n+1); setChosen(null); setCorrect(null); };

  const FILTERS = [
    {id:"all",    label:"à¤¸à¤¬",     color:"#FF7043"},
    {id:"swar",   label:"à¤¸à¥à¤µà¤°",   color:"#FF7043"},
    {id:"word",   label:"à¤¶à¤¬à¥à¤¦",   color:"#43A047"},
    {id:"meaning",label:"à¤…à¤°à¥à¤¥",   color:"#1E88E5"},
    {id:"matra",  label:"à¤®à¤¾à¤¤à¥à¤°à¤¾", color:"#8E24AA"},
    {id:"vyanjan",label:"à¤µà¥à¤¯à¤‚à¤œà¤¨", color:"#E53935"},
  ];

  return (
    <div className="fade-up" style={{ minHeight:"calc(100vh-56px)",
      background:"#FFF9F0", paddingBottom:90, paddingTop:8 }}>
      <div style={{ padding:"0 20px 0" }}>
        {/* Header */}
        <div style={{ display:"flex", alignItems:"center", justifyContent:"space-between", marginBottom:12 }}>
          <div>
            <div style={{ fontWeight:800, fontSize:18, color:"#333" }}>â™¾ï¸ Endless Practice</div>
            <div style={{ fontSize:11, color:"#888" }}>Question #{qNum+1} Â· Never ends!</div>
          </div>
          <div style={{ textAlign:"right" }}>
            <div style={{ fontWeight:900, fontSize:20, color:"#FF7043" }}>{score} âœ“</div>
            <div style={{ fontSize:11, color:"#888" }}>ğŸ”¥ Streak: {streak}</div>
          </div>
        </div>

        {/* Streak banner */}
        {streak >= 3 && (
          <div className="pop-in" style={{ background:"linear-gradient(90deg,#FF7043,#FF9800)",
            borderRadius:12, padding:"8px 14px", marginBottom:12,
            display:"flex", alignItems:"center", gap:10 }}>
            <div style={{ fontSize:24 }}>{streak>=10?"ğŸ”¥ğŸ”¥ğŸ”¥":streak>=5?"ğŸ”¥ğŸ”¥":"ğŸ”¥"}</div>
            <div>
              <div style={{ color:"#fff", fontWeight:800, fontSize:13 }}>{streak} in a row! ğŸ‰</div>
              <div style={{ color:"rgba(255,255,255,.85)", fontSize:10 }}>
                {streak>=5?"+30 pts bonus!":"+20 pts bonus!"}
              </div>
            </div>
          </div>
        )}

        {/* Filter chips */}
        <div style={{ display:"flex", gap:7, marginBottom:14, overflowX:"auto", scrollbarWidth:"none" }}>
          {FILTERS.map(f => (
            <div key={f.id} onClick={() => { setFilter(f.id); setQNum(n=>n+1); setChosen(null); setCorrect(null); }}
              style={{ flexShrink:0, background:filter===f.id?f.color:"#fff",
                color:filter===f.id?"#fff":"#555",
                padding:"5px 12px", borderRadius:20, fontSize:11, fontWeight:700,
                cursor:"pointer", border:`2px solid ${filter===f.id?f.color:"#f0e8e0"}` }}>
              <span className="hin">{f.label}</span>
            </div>
          ))}
        </div>

        {/* Type badge */}
        <div style={{ display:"flex", alignItems:"center", gap:8, marginBottom:10 }}>
          <div style={{ background:q.color+"20", color:q.color, padding:"3px 12px",
            borderRadius:20, fontSize:11, fontWeight:700 }}>
            <span className="hin">{q.type}</span>
          </div>
          {user && <div style={{ fontSize:11, color:"#888" }}>
            Total answered: {user.endlessCount||0}
          </div>}
        </div>

        {/* Question card */}
        <Card style={{ textAlign:"center", marginBottom:16, padding:"22px 20px",
          border:`2px solid ${q.color}20` }}>
          <div className="hin" style={{ fontSize:50, lineHeight:1, marginBottom:6 }}>{q.img}</div>
          <div className="hin" style={{ fontSize:17, fontWeight:700, color:"#333" }}>{q.q}</div>
          <button onClick={() => speak(q.speak)}
            style={{ marginTop:10, background:"none", border:`2px solid ${q.color}60`,
              borderRadius:10, padding:"5px 14px", cursor:"pointer", fontSize:12,
              color:q.color, fontWeight:700 }}>ğŸ”Š à¤¸à¥à¤¨à¥‹</button>
        </Card>

        {/* Choices */}
        <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr", gap:10, marginBottom:16 }}>
          {q.choices.map((choice, i) => {
            let bg="#fff", border="#f0f0f0", textColor="#333";
            if (chosen!==null) {
              if (i===ansIdx) { bg="#E8F5E9"; border="#43A047"; textColor="#2e7d32"; }
              else if (i===chosen&&!correct) { bg="#FFEBEE"; border="#e53935"; textColor="#c62828"; }
            }
            return (
              <div key={i} onClick={() => choose(i)}
                style={{ background:bg, border:`2px solid ${border}`, borderRadius:14,
                  padding:"15px 10px", textAlign:"center",
                  cursor:chosen===null?"pointer":"default", transition:"all .2s",
                  boxShadow:"0 2px 10px rgba(0,0,0,.07)" }}>
                <div className="hin" style={{ fontSize:20, fontWeight:900, color:textColor }}>
                  {chosen!==null&&i===ansIdx?"âœ… ":chosen===i&&!correct?"âŒ ":""}{choice}
                </div>
              </div>
            );
          })}
        </div>

        {/* Feedback + Next */}
        {chosen!==null && (
          <div className="pop-in">
            <div style={{ background:correct?"#E8F5E9":"#FFEBEE", borderRadius:14,
              padding:"11px 16px", textAlign:"center", marginBottom:12,
              border:`2px solid ${correct?"#43A047":"#e53935"}` }}>
              <div style={{ fontSize:20 }}>{correct?"ğŸ‰":"ğŸ˜…"}</div>
              <div className="hin" style={{ fontWeight:800, fontSize:15,
                color:correct?"#2e7d32":"#c62828" }}>
                {correct?`à¤¶à¤¾à¤¬à¤¾à¤¶! +${streak>=5?30:streak>=3?20:10} pts!`:`à¤¸à¤¹à¥€: ${q.answer}`}
              </div>
              {correct&&streak>=3&&<div style={{ fontSize:11, color:"#2e7d32" }}>ğŸ”¥ Streak bonus!</div>}
            </div>
            <Btn onClick={next} color={q.color} style={{ width:"100%", padding:14, fontSize:15 }}>
              Next Question â†’  â™¾ï¸
            </Btn>
          </div>
        )}

        {/* Stats card */}
        <div style={{ marginTop:16 }}>
          <div onClick={() => setShowStats(s=>!s)}
            style={{ cursor:"pointer", textAlign:"center", color:"#888", fontSize:12, fontWeight:600 }}>
            {showStats?"â–² Hide Stats":"â–¼ Show Session Stats"}
          </div>
          {showStats && (
            <div className="fade-up" style={{ marginTop:10, display:"grid",
              gridTemplateColumns:"1fr 1fr 1fr", gap:10 }}>
              {[["âœ…",score,"Correct"],["ğŸ”¥",bestStreak,"Best Streak"],["ğŸ“‹",qNum+1,"Attempted"]].map(([icon,val,label]) => (
                <Card key={label} style={{ padding:"10px 8px", textAlign:"center" }}>
                  <div style={{ fontSize:22 }}>{icon}</div>
                  <div style={{ fontWeight:900, fontSize:20, color:"#333" }}>{val}</div>
                  <div style={{ fontSize:9, color:"#888" }}>{label}</div>
                </Card>
              ))}
            </div>
          )}
        </div>
      </div>
    </div>
  );
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCREEN: LEADERBOARD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const LeaderboardScreen = ({ user }) => {
  const myEntry = user ? [{ name:user.name, av:"ğŸ§‘", pts:user.points, wpm:user.wpm||0,
    lvl:user.levelLabel, streak:user.streak }] : [];
  const list = [...myEntry, ...LEADERBOARD_DATA].sort((a,b)=>b.pts-a.pts);
  const top3 = [list[1], list[0], list[2]];

  return (
    <div className="fade-up" style={{ minHeight:"calc(100vh-56px)", background:"#FFF9F0", paddingBottom:90 }}>
      <div style={{ background:"linear-gradient(135deg,#1A237E,#283593)", padding:"20px 20px 42px" }}>
        <div style={{ fontWeight:800, fontSize:22, color:"#fff" }}>ğŸ† Leaderboard</div>
        <div style={{ fontSize:12, color:"rgba(255,255,255,.7)", marginTop:2 }}>Top readers this week</div>
      </div>

      {/* Podium */}
      <div style={{ display:"flex", alignItems:"flex-end", justifyContent:"center",
        gap:10, padding:"0 20px", marginTop:-26, marginBottom:16 }}>
        {top3.map((s, i) => s && (
          <div key={s.name+i} style={{ flex:1, textAlign:"center" }}>
            <div style={{ fontSize:22 }}>{s.av}</div>
            <div style={{ fontSize:9, fontWeight:700, color:"#333", margin:"3px 0",
              overflow:"hidden", textOverflow:"ellipsis", whiteSpace:"nowrap" }}>
              {s.name.split(" ")[0]}
            </div>
            <div style={{ background:["#C0C0C0","#FFD700","#CD7F32"][i],
              borderRadius:"10px 10px 0 0", height:[100,130,80][i],
              display:"flex", flexDirection:"column", alignItems:"center",
              justifyContent:"flex-start", paddingTop:10, boxShadow:"0 4px 16px rgba(0,0,0,.15)" }}>
              <div style={{ fontSize:22 }}>{[2,1,3][i]===1?"ğŸ¥‡":[2,1,3][i]===2?"ğŸ¥ˆ":"ğŸ¥‰"}</div>
              <div style={{ fontWeight:900, fontSize:16, color:"#fff" }}>#{[2,1,3][i]}</div>
              <div style={{ fontSize:11, color:"rgba(255,255,255,.9)", fontWeight:700 }}>{s.pts}</div>
            </div>
          </div>
        ))}
      </div>

      <div style={{ padding:"0 20px" }}>
        {list.map((s, i) => {
          const isMe = user && s.name === user.name;
          return (
            <div key={s.name+i} style={{ background:isMe?"#FBE9E7":"#fff",
              borderRadius:14, padding:"11px 14px", marginBottom:8,
              display:"flex", alignItems:"center", gap:12,
              boxShadow:"0 2px 8px rgba(0,0,0,.07)",
              border:isMe?"2px solid #FF7043":"2px solid transparent" }}>
              <div style={{ width:26, fontWeight:800, fontSize:15, textAlign:"center",
                color:i===0?"#FFD700":i===1?"#C0C0C0":i===2?"#CD7F32":"#aaa" }}>#{i+1}</div>
              <div style={{ fontSize:26 }}>{s.av}</div>
              <div style={{ flex:1 }}>
                <div style={{ fontWeight:700, fontSize:13, color:"#333" }}>
                  {s.name} {isMe&&<span style={{ color:"#FF7043" }}>â† You</span>}
                </div>
                <div style={{ fontSize:10, color:"#888" }}>
                  {s.lvl} Â· {s.wpm} WPM Â· ğŸ”¥{s.streak}
                </div>
              </div>
              <div style={{ textAlign:"right" }}>
                <div style={{ fontWeight:900, fontSize:15, color:"#FF7043" }}>{s.pts}</div>
                <div style={{ fontSize:9, color:"#aaa" }}>pts</div>
              </div>
            </div>
          );
        })}

        <div style={{ marginTop:16 }}>
          <H>ğŸ–ï¸ All Badges</H>
          <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr", gap:10 }}>
            {BADGES.map(b => (
              <Card key={b.name} style={{ padding:12 }}>
                <div style={{ fontSize:26 }}>{b.icon}</div>
                <div style={{ fontWeight:700, fontSize:12, color:"#333", marginTop:4 }}>{b.name}</div>
                <div style={{ fontSize:10, color:"#888" }}>{b.desc}</div>
                <div style={{ marginTop:5, display:"inline-block", background:"#FFF3E0",
                  color:"#FF7043", borderRadius:8, padding:"2px 8px", fontSize:10, fontWeight:800 }}>
                  +{b.pts} pts
                </div>
              </Card>
            ))}
          </div>
        </div>
      </div>
    </div>
  );
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCREEN: DASHBOARD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const DashboardScreen = ({ user, setUser, setScreen, onLogout }) => {
  if (!user) return (
    <div style={{ minHeight:"calc(100vh-56px)", display:"flex", flexDirection:"column",
      alignItems:"center", justifyContent:"center", gap:16, padding:"40px 24px",
      background:"#FFF9F0", paddingBottom:90 }}>
      <div style={{ fontSize:60 }}>ğŸ”</div>
      <div style={{ fontWeight:800, fontSize:20, color:"#333", textAlign:"center" }}>Not logged in!</div>
      <div style={{ fontSize:13, color:"#888", textAlign:"center" }}>Go to Home and enter your name to start tracking progress</div>
      <Btn onClick={() => setScreen("home")} style={{ padding:"14px 40px" }}>ğŸ  Go to Home & Login</Btn>
    </div>
  );

  const lvIndex = LEVELS.findIndex(l => l.id === user.grade);
  const lv = LEVELS[lvIndex];
  const earnedCount = Math.min(Math.floor(user.points / 100), BADGES.length);
  const prog = {};
  LEVELS.forEach((l, i) => {
    if (i < lvIndex) prog[l.id] = 100;
    else if (i === lvIndex) prog[l.id] = Math.min(98, Math.round(user.points / 10));
    else prog[l.id] = 0;
  });

  return (
    <div className="fade-up" style={{ minHeight:"calc(100vh-56px)", background:"#FFF9F0", paddingBottom:90 }}>
      {/* Hero banner */}
      <div style={{ background:"linear-gradient(135deg,#FF7043,#FF9800)", padding:"20px 20px 28px" }}>
        <div style={{ color:"rgba(255,255,255,.8)", fontSize:12 }}>à¤¨à¤®à¤¸à¥à¤¤à¥‡!</div>
        <div style={{ color:"#fff", fontWeight:900, fontSize:24, marginTop:2 }}>{user.name} ğŸ‘‹</div>
        <div style={{ color:"rgba(255,255,255,.85)", fontSize:12, marginTop:2 }}>
          ğŸ”¥ {user.streak} day streak Â· <span className="hin">{lv.label}</span>
        </div>
        <div style={{ display:"flex", gap:9, marginTop:14 }}>
          {[["â­",user.points,"Points"],["ğŸ“–",user.wpm||0,"Best WPM"],["ğŸ…",earnedCount,"Badges"],["â™¾ï¸",user.endlessCount||0,"Endless"]].map(([icon,val,label]) => (
            <div key={label} style={{ background:"rgba(255,255,255,.2)", borderRadius:12,
              padding:"8px 6px", flex:1, textAlign:"center" }}>
              <div style={{ fontSize:16 }}>{icon}</div>
              <div style={{ color:"#fff", fontWeight:900, fontSize:18 }}>{val}</div>
              <div style={{ color:"rgba(255,255,255,.75)", fontSize:9 }}>{label}</div>
            </div>
          ))}
        </div>
      </div>

      <div style={{ padding:"16px 20px" }}>
        <H>ğŸ“ˆ Level Progress</H>
        {LEVELS.map(lv2 => (
          <div key={lv2.id} style={{ background:"#fff", borderRadius:14, padding:"11px 14px",
            marginBottom:8, boxShadow:"0 2px 8px rgba(0,0,0,.06)" }}>
            <div style={{ display:"flex", justifyContent:"space-between", alignItems:"center", marginBottom:7 }}>
              <div style={{ display:"flex", alignItems:"center", gap:8 }}>
                <span>{lv2.icon}</span>
                <div>
                  <div className="hin" style={{ fontWeight:700, fontSize:13, color:"#333" }}>{lv2.label}</div>
                  <div style={{ fontSize:10, color:"#888" }}>{lv2.age}</div>
                </div>
              </div>
              <div style={{ fontWeight:700, fontSize:12, color:lv2.color }}>{prog[lv2.id]}%</div>
            </div>
            <Bar pct={prog[lv2.id]} color={lv2.color} />
            <div style={{ fontSize:9, color:"#bbb", marginTop:3 }}>
              {prog[lv2.id]===100?"âœ… Complete!":prog[lv2.id]===0?"ğŸ”’ Locked":"In progress..."}
            </div>
          </div>
        ))}

        <H>ğŸ–ï¸ My Badges</H>
        {earnedCount===0 ? (
          <Card style={{ textAlign:"center", padding:20, color:"#bbb" }}>
            <div style={{ fontSize:36 }}>ğŸ”’</div>
            <div style={{ fontWeight:700, marginTop:8 }}>No badges yet</div>
            <div style={{ fontSize:11, marginTop:4 }}>Earn 100 pts to unlock your first badge!</div>
          </Card>
        ) : (
          <div style={{ display:"flex", gap:10, overflowX:"auto", paddingBottom:8, scrollbarWidth:"none" }}>
            {BADGES.map((b, i) => (
              <div key={b.name} style={{ flexShrink:0, background:i<earnedCount?"#fff":"#f5f5f5",
                borderRadius:14, padding:10, textAlign:"center", width:78,
                boxShadow:"0 2px 8px rgba(0,0,0,.06)", opacity:i<earnedCount?1:0.3 }}>
                <div style={{ fontSize:24 }}>{i<earnedCount?b.icon:"ğŸ”’"}</div>
                <div style={{ fontSize:8, fontWeight:700, color:"#555", marginTop:4, lineHeight:1.2 }}>{b.name}</div>
              </div>
            ))}
          </div>
        )}

        <H>ğŸ“… This Week</H>
        <Card>
          <div style={{ display:"flex", gap:5, justifyContent:"space-between",
            alignItems:"flex-end", height:70, padding:"6px 0" }}>
            {["Mon","Tue","Wed","Thu","Fri","Sat","Sun"].map((day, i) => {
              const h = [55,70,45,75,60,30,20][i];
              const act = i < 5;
              return (
                <div key={day} style={{ flex:1, textAlign:"center" }}>
                  <div style={{ background:act?"#FF7043":"#eee", borderRadius:"5px 5px 0 0",
                    height:act?h:12, marginBottom:3, transition:"height .6s ease" }} />
                  <div style={{ fontSize:8, color:"#999", fontWeight:700 }}>{day}</div>
                </div>
              );
            })}
          </div>
        </Card>

        <div style={{ marginTop:16, display:"flex", gap:10 }}>
          <Btn onClick={() => setScreen("endless")} color="#8E24AA" style={{ flex:1, padding:13 }}>
            â™¾ï¸ Endless Practice
          </Btn>
          <Btn onClick={() => { if(onLogout) onLogout(); else { setUser(null); setScreen("home"); } }} color="#888" style={{ flex:1, padding:13 }}>
            ğŸšª Logout
          </Btn>
        </div>
      </div>
    </div>
  );
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCREEN: TEACHER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const TeacherScreen = ({ setScreen }) => {
  const [tab, setTab] = useState("overview");
  const TECH = [
    {tool:"Next.js + React",   use:"Frontend",    why:"Fast, mobile-first",  cost:"Free"},
    {tool:"Supabase",          use:"DB + Auth",    why:"Easy, free tier",     cost:"Free"},
    {tool:"Vercel",            use:"Hosting",      why:"1-click deploy",      cost:"Free"},
    {tool:"Google TTS API",    use:"Hindi Audio",  why:"Native Hindi voice",  cost:"Free"},
    {tool:"Tailwind CSS",      use:"Styling",      why:"Quick beautiful UI",  cost:"Free"},
    {tool:"Airtable / Notion", use:"Content CMS",  why:"Teacher-editable",    cost:"Free"},
  ];
  return (
    <div style={{ minHeight:"100vh", background:"#f4f6f9", paddingBottom:40 }}>
      <div style={{ background:"linear-gradient(135deg,#1A237E,#283593)", padding:"16px 20px 24px" }}>
        <div onClick={() => setScreen("home")} style={{ color:"rgba(255,255,255,.6)",
          fontSize:12, cursor:"pointer", marginBottom:8 }}>â† Back to app</div>
        <div style={{ color:"#fff", fontWeight:900, fontSize:22 }}>ğŸ§‘â€ğŸ« Teacher Dashboard</div>
        <div style={{ color:"rgba(255,255,255,.7)", fontSize:11, marginTop:2 }}>Monitor Â· Manage Â· Motivate</div>
      </div>

      <div style={{ display:"flex", gap:7, padding:"12px 20px",
        overflowX:"auto", scrollbarWidth:"none", background:"#fff",
        boxShadow:"0 2px 8px rgba(0,0,0,.06)" }}>
        {[["overview","ğŸ“Š","Overview"],["students","ğŸ‘¥","Students"],["reports","ğŸ“‹","Reports"],["tech","ğŸ’»","Tech Guide"]].map(([id,icon,label]) => (
          <div key={id} onClick={() => setTab(id)}
            style={{ flexShrink:0, background:tab===id?"#1A237E":"#f4f6f9",
              color:tab===id?"#fff":"#555", padding:"6px 14px", borderRadius:20,
              fontSize:12, fontWeight:700, cursor:"pointer" }}>
            {icon} {label}
          </div>
        ))}
      </div>

      <div style={{ padding:"14px 20px" }}>
        {tab==="overview" && (
          <div>
            <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr", gap:10, marginBottom:14 }}>
              {[["ğŸ‘¥","24","Total Students"],["ğŸ“ˆ","73%","Avg. Progress"],["â±ï¸","28","Avg. WPM"],["ğŸ…","142","Badges Given"]].map(([icon,val,label]) => (
                <Card key={label}>
                  <div style={{ fontSize:24 }}>{icon}</div>
                  <div style={{ fontWeight:900, fontSize:22, color:"#333", marginTop:3 }}>{val}</div>
                  <div style={{ fontSize:11, color:"#888" }}>{label}</div>
                </Card>
              ))}
            </div>
            <Card style={{ marginBottom:12 }}>
              <div style={{ fontWeight:700, fontSize:14, color:"#333", marginBottom:12 }}>ğŸ“Š Class Distribution</div>
              {LEVELS.map((lv, i) => (
                <div key={lv.id} style={{ marginBottom:9 }}>
                  <div style={{ display:"flex", justifyContent:"space-between", marginBottom:3 }}>
                    <div className="hin" style={{ fontSize:12, fontWeight:700 }}>{lv.label}</div>
                    <div style={{ fontSize:11, color:"#888" }}>{[5,5,6,4,4][i]} students</div>
                  </div>
                  <Bar pct={[60,75,85,40,20][i]} color={lv.color} />
                </div>
              ))}
            </Card>
            <Card style={{ background:"#FFF3E0", border:"2px dashed #FF9800" }}>
              <div style={{ fontWeight:700, fontSize:13, color:"#FF7043", marginBottom:8 }}>âš ï¸ Needs Attention</div>
              {[["Dev Kumar","BV3","No activity in 3 days"],["Rohan","Class 1","WPM below target"]].map(([n,c,note]) => (
                <div key={n} style={{ display:"flex", gap:10, marginBottom:8, alignItems:"flex-start" }}>
                  <span style={{ fontSize:22 }}>ğŸ‘¦</span>
                  <div>
                    <div style={{ fontWeight:700, fontSize:12, color:"#333" }}>{n} Â· {c}</div>
                    <div style={{ fontSize:11, color:"#888" }}>{note}</div>
                  </div>
                </div>
              ))}
            </Card>
          </div>
        )}

        {tab==="students" && (
          <div>
            {LEADERBOARD_DATA.map((s, i) => (
              <Card key={s.name} style={{ marginBottom:9, padding:"11px 14px",
                display:"flex", alignItems:"center", gap:12 }}>
                <div style={{ fontSize:26 }}>{s.av}</div>
                <div style={{ flex:1 }}>
                  <div style={{ fontWeight:700, fontSize:13, color:"#333" }}>{s.name}</div>
                  <div style={{ fontSize:11, color:"#888" }}>{s.lvl} Â· {s.wpm} WPM</div>
                  <div style={{ marginTop:4 }}><Bar pct={(s.wpm/50)*100} color="#FF7043" /></div>
                </div>
                <div style={{ textAlign:"right" }}>
                  <div style={{ fontWeight:800, fontSize:13, color:"#FF7043" }}>{s.pts}</div>
                  <div style={{ fontSize:11, color:"#888" }}>ğŸ”¥{s.streak}</div>
                </div>
              </Card>
            ))}
          </div>
        )}

        {tab==="reports" && (
          <div>
            <Card style={{ marginBottom:14 }}>
              <div style={{ fontWeight:800, fontSize:14, color:"#333", marginBottom:12 }}>ğŸ“‹ Auto Report Card â€” Sample</div>
              <div style={{ border:"2px solid #e8eaf6", borderRadius:14, overflow:"hidden" }}>
                <div style={{ background:"linear-gradient(135deg,#1A237E,#283593)",
                  padding:"11px 16px", color:"#fff" }}>
                  <div style={{ fontWeight:800, fontSize:14 }}>Hindi Pathshala Â· Progress Report</div>
                  <div style={{ fontSize:10, opacity:.75 }}>Term 1 Â· 2025â€“26</div>
                </div>
                <div style={{ padding:"14px 16px" }}>
                  {[["Letter Recognition","A+","100%","#43A047"],["Matra Reading","A","92%","#43A047"],
                    ["Word Reading","A","89%","#43A047"],["Fluency (WPM)","B+","42 WPM","#FB8C00"],
                    ["Comprehension","A","85%","#43A047"],["Voice Practice","A","10/10","#1E88E5"],
                    ["Endless Practice","A+","120 Qs","#8E24AA"]].map(([skill,grade,score,color]) => (
                    <div key={skill} style={{ display:"flex", justifyContent:"space-between",
                      padding:"6px 0", borderBottom:"1px solid #f5f5f5" }}>
                      <div style={{ fontSize:12, color:"#555" }}>{skill}</div>
                      <div style={{ display:"flex", gap:10 }}>
                        <div style={{ fontWeight:800, fontSize:12, color }}>{grade}</div>
                        <div style={{ fontSize:11, color:"#888" }}>{score}</div>
                      </div>
                    </div>
                  ))}
                  <div style={{ marginTop:10, background:"#E8F5E9", borderRadius:8,
                    padding:"7px 10px", fontSize:11, color:"#2e7d32", fontWeight:700 }}>
                    ğŸ‰ Overall: Excellent â€” All targets achieved!
                  </div>
                </div>
              </div>
            </Card>
            <Btn style={{ width:"100%", padding:13, background:"#1A237E", fontSize:13 }}>
              ğŸ“¥ Download All Reports (PDF)
            </Btn>
          </div>
        )}

        {tab==="tech" && (
          <div>
            <Card style={{ background:"#E3F2FD", border:"2px solid #1E88E530", marginBottom:12 }}>
              <div style={{ fontWeight:700, fontSize:13, color:"#1565C0", marginBottom:3 }}>
                ğŸ’¡ For Teachers with Limited Coding Knowledge
              </div>
              <div style={{ fontSize:11, color:"#444" }}>
                Hire a freelancer on <strong>Freelancer.in</strong> or <strong>Fiverr.com</strong>.
                Budget: <strong>â‚¹15,000â€“â‚¹40,000 Â· 6â€“8 weeks</strong>
              </div>
            </Card>
            {TECH.map(t => (
              <Card key={t.tool} style={{ marginBottom:8, padding:"11px 14px",
                display:"flex", alignItems:"center", gap:12 }}>
                <div style={{ width:40, height:40, borderRadius:12, background:"#EBF5FB",
                  display:"flex", alignItems:"center", justifyContent:"center", fontSize:20 }}>ğŸ’»</div>
                <div style={{ flex:1 }}>
                  <div style={{ fontWeight:700, fontSize:13, color:"#333" }}>{t.tool}</div>
                  <div style={{ fontSize:11, color:"#888" }}>{t.use} Â· {t.why}</div>
                </div>
                <div style={{ background:"#E8F5E9", color:"#2e7d32",
                  padding:"3px 10px", borderRadius:8, fontSize:10, fontWeight:700 }}>{t.cost}</div>
              </Card>
            ))}
            <div style={{ marginTop:14 }}>
              <H>ğŸ—ºï¸ Build Roadmap</H>
              {[["Phase 1 (Wk 1â€“2)","Student auth, letter cards, audio TTS"],
                ["Phase 2 (Wk 3â€“4)","Points, badges, leaderboard, level unlock"],
                ["Phase 3 (Wk 5â€“6)","Speed test, WPM tracker, voice recording, teacher panel"],
                ["Phase 4 (Wk 7â€“8)","Endless practice engine, report cards, certificates, offline mode"]].map(([ph,d], i) => (
                <div key={i} style={{ display:"flex", gap:12, marginBottom:12, alignItems:"flex-start" }}>
                  <div style={{ width:28, height:28, borderRadius:"50%",
                    background:["#FF7043","#43A047","#1E88E5","#8E24AA"][i],
                    color:"#fff", display:"flex", alignItems:"center",
                    justifyContent:"center", fontWeight:800, fontSize:13, flexShrink:0 }}>{i+1}</div>
                  <Card style={{ flex:1, padding:"9px 13px" }}>
                    <div style={{ fontWeight:700, fontSize:12,
                      color:["#FF7043","#43A047","#1E88E5","#8E24AA"][i] }}>{ph}</div>
                    <div style={{ fontSize:11, color:"#666", marginTop:2 }}>{d}</div>
                  </Card>
                </div>
              ))}
            </div>
          </div>
        )}
      </div>
    </div>
  );
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCREEN: READING TEST â€” 5 Levels, Non-repeating content
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const ReadingTestScreen = ({ user, setUser }) => {

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• STATE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  const [phase,      setPhase]      = useState("select");
  const [selLevel,   setSelLevel]   = useState(null);
  const [tokens,     setTokens]     = useState([]);
  const [passTitle,  setPassTitle]  = useState("");
  const [passMoral,  setPassMoral]  = useState("");
  const [passEmoji,  setPassEmoji]  = useState("ğŸ“–");
  const [tapped,     setTapped]     = useState(new Set());
  const [testSecs,   setTestSecs]   = useState(0);
  const [wpm,        setWpm]        = useState(0);
  const [prevBest,   setPrevBest]   = useState({});
  const [aiLoading,  setAiLoading]  = useState(false);
  const [aiError,    setAiError]    = useState(null);
  const [storyHist,  setStoryHist]  = useState(() =>
    user ? storyHistGet(user.email) : { count:0, difficulty:1, usedTitles:[] }
  );

  // Mic permission â€” managed as a distinct step before test starts
  const [micStep,   setMicStep]   = useState("idle"); // idle|asking|granted|denied|unsupported
  const [micBusy,   setMicBusy]   = useState(false);

  // Recording UI state
  const [recSecs,   setRecSecs]   = useState(0);
  const [recLive,   setRecLive]   = useState(false);
  const [audioURL,  setAudioURL]  = useState(null);

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• REFS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  const testTimerRef = useRef(null);
  const recTimerRef  = useRef(null);
  const streamRef    = useRef(null);
  const mrRef        = useRef(null);
  const chunksRef    = useRef([]);
  const blobURLRef   = useRef(null);
  const shuffPools   = useRef(null);
  const cursors      = useRef({ lv1:0, lv2:0, lv3:0, c1:0 });

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• LIFECYCLE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  useEffect(() => {
    shuffPools.current = {
      lv1: [...RT_LV1_POOL].sort(() => Math.random() - .5),
      lv2: [...RT_LV2_POOL].sort(() => Math.random() - .5),
      lv3: [...RT_LV3_POOL].sort(() => Math.random() - .5),
      c1:  [...RT_LV4_POOL].sort(() => Math.random() - .5),
    };
    if (!navigator.mediaDevices || !window.MediaRecorder) setMicStep("unsupported");
    return () => {
      clearInterval(testTimerRef.current);
      clearInterval(recTimerRef.current);
      _killRecorder();
      _killStream();
      if (blobURLRef.current) URL.revokeObjectURL(blobURLRef.current);
    };
  }, []);

  useEffect(() => {
    if (user) setStoryHist(storyHistGet(user.email));
  }, [user?.email]);

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• RECORDING HELPERS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  const _killStream = () => {
    if (streamRef.current) {
      streamRef.current.getTracks().forEach(t => t.stop());
      streamRef.current = null;
    }
  };

  const _killRecorder = () => {
    clearInterval(recTimerRef.current);
    try {
      if (mrRef.current && mrRef.current.state !== "inactive") mrRef.current.stop();
    } catch {}
    mrRef.current = null;
  };

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     handleAllowMic â€” called DIRECTLY from button onClick
     This is the ONLY way to guarantee the browser shows the
     microphone permission popup. Never call getUserMedia from
     inside a setTimeout or another async function chain.
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  const handleAllowMic = async () => {
    if (micStep === "unsupported") return;
    // Reuse existing live stream
    if (streamRef.current) {
      const t = streamRef.current.getAudioTracks()[0];
      if (t && t.readyState === "live") { setMicStep("granted"); return; }
      _killStream();
    }
    setMicBusy(true);
    setMicStep("asking");
    try {
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true, video: false });
      streamRef.current = stream;
      setMicStep("granted");
    } catch (e) {
      setMicStep(["NotAllowedError","PermissionDeniedError"].includes(e.name) ? "denied" : "unsupported");
    } finally {
      setMicBusy(false);
    }
  };

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     _beginRecording â€” stream is already live when this is called
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  const _beginRecording = () => {
    const stream = streamRef.current;
    if (!stream) return;

    chunksRef.current = [];
    if (blobURLRef.current) { URL.revokeObjectURL(blobURLRef.current); blobURLRef.current = null; }
    setAudioURL(null);

    const mime = ["audio/webm;codecs=opus","audio/webm","audio/ogg;codecs=opus","audio/ogg",""]
      .find(m => !m || MediaRecorder.isTypeSupported(m)) || "";

    let mr;
    try { mr = new MediaRecorder(stream, mime ? { mimeType: mime } : {}); }
    catch { try { mr = new MediaRecorder(stream); } catch { return; } }

    mrRef.current = mr;
    mr.ondataavailable = e => { if (e.data?.size > 0) chunksRef.current.push(e.data); };
    mr.onstop = () => {
      clearInterval(recTimerRef.current);
      setRecLive(false);
      if (!chunksRef.current.length) return;
      const blob = new Blob(chunksRef.current, { type: mime || "audio/webm" });
      const url  = URL.createObjectURL(blob);
      blobURLRef.current = url;
      setAudioURL(url);
    };
    mr.onerror = () => { clearInterval(recTimerRef.current); setRecLive(false); };

    mr.start(100);
    setRecSecs(0);
    setRecLive(true);
    clearInterval(recTimerRef.current);
    recTimerRef.current = setInterval(() => setRecSecs(s => s + 1), 1000);
  };

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• BUILD PASSAGE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  const buildPassage = async (lvId) => {
    setAiError(null); setPassMoral(""); setPassEmoji("ğŸ“–");
    const p = shuffPools.current; if (!p) return;

    if (lvId === "lv1") {
      const N=28, c=cursors.current.lv1;
      setTokens(Array.from({length:N},(_,i)=>p.lv1[(c+i)%p.lv1.length]));
      cursors.current.lv1=(c+N)%p.lv1.length;
      setPassTitle("à¤…à¤•à¥à¤·à¤° à¤ªà¤¢à¤¼à¥‹ â€” Read each letter / syllable");
    } else if (lvId === "lv2") {
      const N=18, c=cursors.current.lv2;
      setTokens(Array.from({length:N},(_,i)=>p.lv2[(c+i)%p.lv2.length]));
      cursors.current.lv2=(c+N)%p.lv2.length;
      setPassTitle("à¤¶à¤¬à¥à¤¦ à¤ªà¤¢à¤¼à¥‹ â€” Read each word");
    } else if (lvId === "lv3") {
      const N=18, c=cursors.current.lv3;
      setTokens(Array.from({length:N},(_,i)=>p.lv3[(c+i)%p.lv3.length]));
      cursors.current.lv3=(c+N)%p.lv3.length;
      setPassTitle("à¤®à¤¾à¤¤à¥à¤°à¤¾ à¤¶à¤¬à¥à¤¦ à¤ªà¤¢à¤¼à¥‹ â€” Read words with matras");
    } else if (lvId === "c1") {
      const N=6, c=cursors.current.c1;
      const sl=Array.from({length:N},(_,i)=>p.c1[(c+i)%p.c1.length]);
      cursors.current.c1=(c+N)%p.c1.length;
      setTokens(sl.join(" ").split(" "));
      setPassTitle("à¤µà¤¾à¤•à¥à¤¯ à¤ªà¤¢à¤¼à¥‹ â€” Read sentences aloud");
    } else if (lvId === "c2") {
      setAiLoading(true);
      const hist = user ? storyHistGet(user.email) : storyHist;
      try {
        const story = await generateAIStory(hist.difficulty, hist.usedTitles);
        setTokens(story.text.split(" ")); setPassTitle(story.title);
        setPassMoral(story.moral||""); setPassEmoji(story.emoji||"ğŸ“–");
        const nc=hist.count+1, nd=Math.min(10,nc%3===0?hist.difficulty+1:hist.difficulty);
        const nh={count:nc,difficulty:nd,usedTitles:[...hist.usedTitles,story.title].slice(-30)};
        if (user) storyHistSave(user.email,nh); setStoryHist(nh);
      } catch { setAiError("Could not generate story. Check internet connection."); }
      finally  { setAiLoading(false); }
    }
  };

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• CONTROLS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  const selectLevel = async (lvId) => {
    setSelLevel(lvId);
    setAudioURL(null); setRecLive(false); setRecSecs(0);
    setPhase("ready");
    await buildPassage(lvId);
  };

  const startTest = () => {
    setTapped(new Set()); setTestSecs(0);
    setAudioURL(null); setRecLive(false); setRecSecs(0);
    setPhase("test");
    clearInterval(testTimerRef.current);
    testTimerRef.current = setInterval(() => setTestSecs(s => s + 1), 1000);
    _beginRecording(); // stream already live â€” starts immediately, no delay needed
  };

  const tapToken = (idx) => {
    if (phase !== "test") return;
    setTapped(prev => { const n=new Set(prev); n.add(idx); return n; });
    if (tokens[idx]) speak(tokens[idx], 0.75);
  };

  const stopTest = () => {
    clearInterval(testTimerRef.current);
    _killRecorder(); // onstop fires â†’ audioURL gets set
    const count=tapped.size, elapsed=testSecs>0?testSecs:1;
    const speed=Math.round((count/elapsed)*60);
    setWpm(speed);
    if (user) {
      const pts=Math.min(count*3,150);
      setUser(u=>({...u,points:u.points+pts,wpm:Math.max(u.wpm||0,speed)}));
    }
    setPrevBest(pb=>({...pb,[selLevel]:Math.max(pb[selLevel]||0,speed)}));
    setPhase("result");
  };

  const tryAgain = async () => {
    _killRecorder();
    setAudioURL(null); setRecLive(false); setRecSecs(0);
    setPhase("ready");
    await buildPassage(selLevel);
  };

  const timeStr = `${String(Math.floor(testSecs/60)).padStart(2,"0")}:${String(testSecs%60).padStart(2,"0")}`;
  const meta    = selLevel ? RT_LEVELS_META.find(l=>l.id===selLevel) : null;
  const pctDone = tokens.length>0 ? Math.round((tapped.size/tokens.length)*100) : 0;

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SELECT
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  if (phase==="select") return (
    <div className="fade-up" style={{minHeight:"calc(100vh - 56px)",background:"#FFF9F0",paddingBottom:90,paddingTop:8}}>
      <div style={{padding:"0 20px 16px"}}>
        <div style={{background:"linear-gradient(135deg,#1A237E,#311B92)",borderRadius:20,padding:"20px",marginBottom:18,color:"#fff"}}>
          <div style={{fontSize:30,marginBottom:4}}>ğŸ“–</div>
          <div style={{fontWeight:900,fontSize:20}}>Reading Test</div>
          <div style={{fontSize:12,opacity:.8,marginTop:3}}>5 levels Â· AI stories Â· ğŸ¤ Record &amp; listen back</div>
        </div>
        <div style={{fontWeight:800,fontSize:14,color:"#444",marginBottom:12}}>Choose your level:</div>
        {RT_LEVELS_META.map((lv,i)=>(
          <div key={lv.id} onClick={()=>selectLevel(lv.id)} className="press"
            style={{background:"#fff",borderRadius:18,padding:"15px 16px",marginBottom:11,cursor:"pointer",
              boxShadow:"0 3px 14px rgba(0,0,0,.08)",border:`2px solid ${lv.color}22`}}>
            <div style={{display:"flex",alignItems:"center",gap:13}}>
              <div style={{background:`linear-gradient(135deg,${lv.color},${lv.color}bb)`,width:52,height:52,
                borderRadius:14,display:"flex",flexDirection:"column",alignItems:"center",
                justifyContent:"center",flexShrink:0}}>
                <div style={{fontSize:22}}>{lv.icon}</div>
                <div style={{color:"#fff",fontSize:8,fontWeight:800}}>LV{i+1}</div>
              </div>
              <div style={{flex:1}}>
                <div style={{display:"flex",alignItems:"center",gap:6}}>
                  <span className="hin" style={{fontWeight:900,fontSize:14,color:lv.color}}>{lv.label}</span>
                  {lv.id==="c2"&&<span style={{background:"linear-gradient(90deg,#FF7043,#8E24AA)",
                    color:"#fff",fontSize:8,fontWeight:800,padding:"2px 7px",borderRadius:8}}>âœ¨ AI</span>}
                </div>
                <div style={{fontSize:11,color:"#666",marginTop:1}}>{lv.en}</div>
                <div style={{fontSize:10,color:"#aaa"}}>{lv.desc}</div>
              </div>
              <div style={{textAlign:"right",flexShrink:0}}>
                <div style={{background:`${lv.color}18`,color:lv.color,borderRadius:10,padding:"4px 9px",fontSize:10,fontWeight:800}}>
                  {lv.wpmTarget>0?`${lv.wpmTarget} WPM`:`${lv.lpmTarget} LPM`}
                </div>
                {prevBest[lv.id]>0&&<div style={{fontSize:9,color:"#FF7043",fontWeight:700,marginTop:3}}>Best: {prevBest[lv.id]}</div>}
              </div>
            </div>
          </div>
        ))}
        <div style={{background:"#F3E5F5",borderRadius:14,padding:"12px 16px",border:"1px solid #CE93D8"}}>
          <div style={{fontWeight:700,fontSize:12,color:"#7B1FA2",marginBottom:5}}>ğŸ’¡ How it works</div>
          <div style={{fontSize:11,color:"#555",lineHeight:1.9}}>
            1. Pick a level<br/>
            2. Tap <strong>"Allow Microphone"</strong> â€” Chrome will ask permission<br/>
            3. Read aloud &amp; tap each word<br/>
            4. Tap STOP â†’ see WPM score + grade<br/>
            5. ğŸ§ <strong>Listen back to your own voice!</strong>
          </div>
        </div>
      </div>
    </div>
  );

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     READY â€” dedicated mic permission step
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  if (phase==="ready") return (
    <div className="fade-up" style={{minHeight:"calc(100vh - 56px)",background:"#FFF9F0",paddingBottom:90,paddingTop:8}}>
      <div style={{padding:"0 20px"}}>
        <div onClick={()=>setPhase("select")}
          style={{color:"#FF7043",fontSize:12,fontWeight:700,cursor:"pointer",marginBottom:14}}>
          â† Back to levels
        </div>

        {/* Level card */}
        <div style={{background:meta.bg,border:`2px solid ${meta.color}30`,borderRadius:18,padding:"18px",marginBottom:16,textAlign:"center"}}>
          <div style={{fontSize:44}}>{aiLoading?"â³":passEmoji}</div>
          <div className="hin" style={{fontWeight:900,fontSize:22,color:meta.color,marginTop:8}}>
            {aiLoading?"AI Story à¤¬à¤¨ à¤°à¤¹à¥€ à¤¹à¥ˆ...":passTitle}
          </div>
          {selLevel==="c2"&&!aiLoading&&(
            <div style={{marginTop:8,display:"flex",justifyContent:"center"}}>
              <div style={{background:"linear-gradient(90deg,#FF7043,#8E24AA)",color:"#fff",borderRadius:12,padding:"4px 14px",fontSize:11,fontWeight:800}}>
                âœ¨ AI Story Â· Difficulty {storyHist.difficulty}/10
              </div>
            </div>
          )}
          {passMoral&&!aiLoading&&<div style={{marginTop:8,background:"rgba(255,255,255,.6)",borderRadius:10,padding:"6px 12px",fontSize:11,color:"#555"}}><span className="hin">ğŸ’¡ {passMoral}</span></div>}
        </div>

        {aiLoading&&<div style={{textAlign:"center",padding:"14px 0"}}><div className="spin" style={{display:"inline-block",fontSize:36}}>âš™ï¸</div><div style={{color:"#8E24AA",fontWeight:700,marginTop:10}}>Claude AI à¤¨à¤ˆ Hindi à¤•à¤¹à¤¾à¤¨à¥€ à¤²à¤¿à¤– à¤°à¤¹à¤¾ à¤¹à¥ˆ...</div></div>}
        {aiError&&<div style={{background:"#FFEBEE",borderRadius:12,padding:"14px",marginBottom:14,border:"2px solid #EF9A9A",textAlign:"center"}}><div style={{fontWeight:700,color:"#c62828"}}>{aiError}</div><Btn onClick={()=>buildPassage(selLevel)} color="#e53935" style={{marginTop:10,padding:"8px 20px",fontSize:12}}>ğŸ”„ Try Again</Btn></div>}

        {!aiLoading&&!aiError&&tokens.length>0&&(<>
          {/* Passage preview */}
          <div style={{background:"#fff",borderRadius:14,padding:"12px 16px",marginBottom:16,boxShadow:"0 2px 10px rgba(0,0,0,.07)",maxHeight:160,overflowY:"auto"}}>
            <div style={{fontSize:10,color:"#bbb",fontWeight:700,marginBottom:6}}>PASSAGE PREVIEW</div>
            <div className="hin" style={{fontSize:14,color:"#555",lineHeight:2.2}}>
              {["lv1","lv2","lv3"].includes(selLevel)?tokens.join("  Â·  "):tokens.join(" ")}
            </div>
          </div>

          {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
              MICROPHONE PERMISSION CARD
              Step 1 â€” must do this BEFORE starting the test
          â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
          <div style={{borderRadius:18,overflow:"hidden",
            boxShadow:"0 6px 24px rgba(0,0,0,.12)",marginBottom:16,
            border:`2px solid ${micStep==="granted"?"#43A047":micStep==="denied"?"#e53935":"#FF7043"}`}}>

            {/* Card header */}
            <div style={{
              background: micStep==="granted"?"linear-gradient(135deg,#2E7D32,#43A047)":
                          micStep==="denied" ?"linear-gradient(135deg,#b71c1c,#e53935)":
                          micStep==="asking" ?"linear-gradient(135deg,#E65100,#FF9800)":
                                              "linear-gradient(135deg,#E65100,#FF7043)",
              padding:"14px 18px",display:"flex",alignItems:"center",gap:12}}>
              <div style={{fontSize:30,flexShrink:0}}>
                {micStep==="granted"?"âœ…":micStep==="denied"?"ğŸš«":micStep==="asking"?"â³":"ğŸ¤"}
              </div>
              <div>
                <div style={{color:"#fff",fontWeight:900,fontSize:16}}>
                  {micStep==="granted"?"Microphone is ON âœ“":
                   micStep==="denied" ?"Microphone Blocked":
                   micStep==="asking" ?"Waiting for permission...":
                   micStep==="unsupported"?"Browser Not Supported":
                   "Step 1 â€” Allow Microphone"}
                </div>
                <div style={{color:"rgba(255,255,255,.9)",fontSize:11,marginTop:2}}>
                  {micStep==="granted"?"Your voice will be recorded during the test":
                   micStep==="denied" ?"Fix it to enable voice recording":
                   micStep==="asking" ?"Look at the top of Chrome for the popup!":
                   "Tap the orange button below to enable your mic"}
                </div>
              </div>
            </div>

            {/* Card body */}
            <div style={{background:"#fff",padding:"16px 18px"}}>

              {(micStep==="idle")&&(
                <>
                  <div style={{fontSize:12,color:"#444",lineHeight:1.8,marginBottom:14}}>
                    When you tap the button below, Chrome will show a popup like this:<br/>
                    <div style={{background:"#F5F5F5",borderRadius:10,padding:"10px 14px",marginTop:10,
                      display:"flex",alignItems:"center",gap:10,border:"1px solid #E0E0E0"}}>
                      <div style={{width:32,height:32,borderRadius:"50%",background:"#FF7043",
                        display:"flex",alignItems:"center",justifyContent:"center",fontSize:18,flexShrink:0}}>ğŸ¤</div>
                      <div style={{flex:1}}>
                        <div style={{fontWeight:700,fontSize:12,color:"#333"}}>wants to use your microphone</div>
                        <div style={{display:"flex",gap:8,marginTop:6}}>
                          <div style={{background:"#1A73E8",color:"#fff",borderRadius:6,padding:"4px 12px",fontSize:11,fontWeight:700}}>Allow</div>
                          <div style={{background:"#fff",border:"1px solid #ddd",borderRadius:6,padding:"4px 12px",fontSize:11,color:"#555"}}>Block</div>
                        </div>
                      </div>
                    </div>
                    <div style={{marginTop:10,fontWeight:700,color:"#E65100"}}>â†’ Tap <strong>"Allow"</strong> in that popup!</div>
                  </div>
                  <button onClick={handleAllowMic} disabled={micBusy}
                    style={{width:"100%",padding:"15px",borderRadius:14,border:"none",
                      background:micBusy?"#ccc":"linear-gradient(135deg,#FF7043,#FF9800)",
                      color:"#fff",fontWeight:900,fontSize:16,cursor:micBusy?"wait":"pointer",
                      boxShadow:micBusy?"none":"0 4px 20px rgba(255,112,67,.55)",
                      display:"flex",alignItems:"center",justifyContent:"center",gap:10,
                      animation:micBusy?"none":"micRing 2s ease-out infinite"}}>
                    {micBusy
                      ?<><span className="spin" style={{display:"inline-block"}}>â³</span> Requesting...</>
                      :<><span style={{fontSize:20}}>ğŸ¤</span> Allow Microphone</>}
                  </button>
                </>
              )}

              {micStep==="asking"&&(
                <div style={{textAlign:"center",padding:"8px 0"}}>
                  <div style={{fontSize:48,marginBottom:10}}>ğŸ‘†</div>
                  <div style={{fontWeight:900,color:"#E65100",fontSize:15}}>
                    Look at the TOP of your browser!
                  </div>
                  <div style={{fontSize:12,color:"#666",marginTop:6,lineHeight:1.7}}>
                    Chrome is showing a permission popup.<br/>
                    Tap <strong style={{color:"#1A73E8"}}>"Allow"</strong> to enable recording.
                  </div>
                </div>
              )}

              {micStep==="granted"&&(
                <div style={{display:"flex",alignItems:"center",gap:14,
                  background:"#E8F5E9",borderRadius:12,padding:"14px 16px"}}>
                  <div style={{fontSize:36}}>ğŸ¤</div>
                  <div>
                    <div style={{fontWeight:900,color:"#2e7d32",fontSize:14}}>Microphone is ready!</div>
                    <div style={{fontSize:11,color:"#555",marginTop:3}}>
                      Scroll down and tap <strong>START READING TEST</strong>
                    </div>
                  </div>
                </div>
              )}

              {micStep==="denied"&&(
                <>
                  <div style={{background:"#FFEBEE",borderRadius:10,padding:"12px",fontSize:12,color:"#c62828",lineHeight:1.8,marginBottom:12}}>
                    <strong>How to fix:</strong><br/>
                    1. Click the ğŸ”’ <strong>lock icon</strong> in the browser address bar<br/>
                    2. Find <strong>"Microphone"</strong> â†’ set to <strong>"Allow"</strong><br/>
                    3. Refresh this page, then try again
                  </div>
                  <button onClick={handleAllowMic} disabled={micBusy}
                    style={{width:"100%",padding:"12px",borderRadius:12,border:"none",
                      background:"#e53935",color:"#fff",fontWeight:800,fontSize:14,cursor:"pointer"}}>
                    ğŸ”„ Try Again
                  </button>
                </>
              )}

              {micStep==="unsupported"&&(
                <div style={{background:"#FFF3E0",borderRadius:10,padding:"12px",fontSize:12,color:"#E65100",lineHeight:1.7}}>
                  âš ï¸ Recording requires <strong>Google Chrome</strong> on Android or Desktop.<br/>
                  The reading test works without recording â€” tap Start below.
                </div>
              )}
            </div>
          </div>

          {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
              START TEST BUTTON â€” Step 2
          â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
          <div style={{textAlign:"center",fontSize:12,fontWeight:700,marginBottom:8,
            color:micStep==="granted"?"#2e7d32":"#999"}}>
            {micStep==="granted"?"âœ… Step 2 â€” Start your test":"Or start without recording â†’"}
          </div>

          <button onClick={startTest}
            style={{width:"100%",padding:"17px",borderRadius:16,border:"none",
              background: micStep==="granted"
                ?`linear-gradient(135deg,${meta.color},${meta.color}cc)`
                :"#9E9E9E",
              color:"#fff",fontWeight:900,fontSize:17,cursor:"pointer",
              boxShadow:micStep==="granted"?`0 6px 24px ${meta.color}55`:"0 4px 12px rgba(0,0,0,.2)",
              transition:"all .2s"}}>
            {micStep==="granted"?"ğŸš€ START READING TEST":"â–¶ Start Without Recording"}
          </button>
        </>)}
      </div>
    </div>
  );

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     TEST
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  if (phase==="test") return (
    <div style={{minHeight:"calc(100vh - 56px)",background:"#FFF9F0",paddingBottom:90,paddingTop:8}}>
      <div style={{padding:"0 16px"}}>

        {/* Recording indicator */}
        {recLive ? (
          <div style={{background:"linear-gradient(90deg,#b71c1c,#e53935)",
            borderRadius:14,padding:"11px 16px",marginBottom:11,
            display:"flex",alignItems:"center",gap:12}}>
            <div style={{width:14,height:14,borderRadius:"50%",background:"#fff",flexShrink:0,
              animation:"recDot .8s ease-in-out infinite"}}/>
            <div style={{color:"#fff",fontWeight:900,fontSize:15,flex:1}}>
              â— REC &nbsp;{String(Math.floor(recSecs/60)).padStart(2,"0")}:{String(recSecs%60).padStart(2,"0")}
            </div>
            <div style={{display:"flex",gap:3,alignItems:"flex-end",height:24}}>
              {[1,2,3,4,5,6,7].map((_,i)=>(
                <div key={i} style={{width:4,borderRadius:2,background:"rgba(255,255,255,.9)",
                  transformOrigin:"bottom",height:"100%",
                  animation:`barAnim ${0.4+i*0.1}s ease-in-out ${i*0.06}s infinite`}}/>
              ))}
            </div>
          </div>
        ):(
          <div style={{background:"#F5F5F5",borderRadius:12,padding:"9px 14px",marginBottom:10,
            border:"1px solid #E0E0E0",display:"flex",alignItems:"center",gap:8}}>
            <span>ğŸ¤</span>
            <span style={{fontSize:11,color:"#888",fontWeight:600}}>
              {micStep==="denied"||micStep==="unsupported"?"No recording (mic not available)":"Connecting recorder..."}
            </span>
          </div>
        )}

        {/* Stats */}
        <div style={{background:`linear-gradient(135deg,${meta.color},${meta.color}cc)`,
          borderRadius:14,padding:"11px 14px",marginBottom:11,
          display:"flex",alignItems:"center",color:"#fff"}}>
          {[["â±ï¸",timeStr,"Time"],["âœ…",tapped.size,"Tapped"],
            ["ğŸ“–",tokens.length-tapped.size,"Left"],["ğŸ’¯",pctDone+"%","Done"]].map(([ic,v,l],i,arr)=>(
            <React.Fragment key={l}>
              <div style={{textAlign:"center",flex:1}}>
                <div style={{fontSize:8,opacity:.75}}>{l}</div>
                <div style={{fontWeight:900,fontSize:i===0?17:21}}>{v}</div>
              </div>
              {i<arr.length-1&&<div style={{width:1,height:30,background:"rgba(255,255,255,.25)",flexShrink:0}}/>}
            </React.Fragment>
          ))}
        </div>

        <div style={{background:"#e0e0e0",borderRadius:6,height:7,marginBottom:11,overflow:"hidden"}}>
          <div style={{width:`${pctDone}%`,height:"100%",background:meta.color,borderRadius:6,transition:"width .3s"}}/>
        </div>

        <div style={{fontSize:12,fontWeight:800,color:meta.color,marginBottom:9}}>
          {meta.icon} {passTitle}
        </div>

        {/* Tokens */}
        {selLevel==="lv1"?(
          <div style={{background:"#fff",borderRadius:16,padding:13,marginBottom:13,boxShadow:"0 2px 12px rgba(0,0,0,.07)"}}>
            <div style={{display:"grid",gridTemplateColumns:"repeat(5,1fr)",gap:7}}>
              {tokens.map((tok,i)=>{const done=tapped.has(i);return(
                <div key={i} onClick={()=>tapToken(i)} style={{background:done?meta.color:"#f7f7f7",
                  borderRadius:11,padding:"9px 4px",textAlign:"center",cursor:"pointer",
                  border:`2px solid ${done?meta.color:"#eee"}`,
                  boxShadow:done?`0 2px 8px ${meta.color}44`:"none",
                  transition:"all .12s",userSelect:"none"}}>
                  <div className="hin" style={{fontSize:20,fontWeight:900,color:done?"#fff":"#333"}}>{tok}</div>
                  {done&&<div style={{fontSize:9,color:"rgba(255,255,255,.85)"}}>âœ“</div>}
                </div>
              );})}
            </div>
          </div>
        ):selLevel==="lv2"||selLevel==="lv3"?(
          <div style={{background:"#fff",borderRadius:16,padding:13,marginBottom:13,boxShadow:"0 2px 12px rgba(0,0,0,.07)"}}>
            <div style={{display:"flex",flexWrap:"wrap",gap:9}}>
              {tokens.map((tok,i)=>{const done=tapped.has(i);return(
                <div key={i} onClick={()=>tapToken(i)} style={{background:done?meta.color:"#f7f7f7",
                  borderRadius:11,padding:"9px 14px",cursor:"pointer",
                  border:`2px solid ${done?meta.color:"#eee"}`,
                  boxShadow:done?`0 2px 10px ${meta.color}44`:"none",
                  transition:"all .12s",userSelect:"none"}}>
                  <div className="hin" style={{fontSize:21,fontWeight:900,color:done?"#fff":"#333"}}>{done?"âœ“ ":""}{tok}</div>
                </div>
              );})}
            </div>
          </div>
        ):(
          <div style={{background:"#fff",borderRadius:16,padding:"14px 16px",marginBottom:13,
            boxShadow:"0 2px 12px rgba(0,0,0,.07)",maxHeight:320,overflowY:"auto"}}>
            <div className="hin" style={{fontSize:18,lineHeight:3.2,color:"#333"}}>
              {tokens.map((tok,i)=>{const done=tapped.has(i);return(
                <span key={i} onClick={()=>tapToken(i)} style={{display:"inline-block",
                  margin:"2px 3px",padding:"2px 8px",borderRadius:7,cursor:"pointer",
                  transition:"all .12s",userSelect:"none",
                  background:done?meta.color:"transparent",
                  color:done?"#fff":"#333",fontWeight:done?800:500,
                  boxShadow:done?`0 2px 8px ${meta.color}55`:"none"}}>
                  {tok}
                </span>
              );})}
            </div>
          </div>
        )}

        <div style={{textAlign:"center",fontSize:11,color:"#999",marginBottom:12}}>
          ğŸ‘† Tap each {selLevel==="lv1"?"letter":"word"} as you read it aloud
        </div>

        <button onClick={stopTest}
          style={{width:"100%",padding:"16px",borderRadius:16,border:"none",
            background:"linear-gradient(135deg,#b71c1c,#E53935)",
            color:"#fff",fontWeight:900,fontSize:16,cursor:"pointer",
            boxShadow:"0 5px 22px rgba(229,57,53,.45)",userSelect:"none"}}>
          â¹ STOP â€” See My Score {recLive?"ğŸ™ï¸":""}
        </button>
      </div>
    </div>
  );

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     RESULT
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  if (phase==="result") {
    const target=meta.wpmTarget>0?meta.wpmTarget:meta.lpmTarget;
    const unit=meta.wpmTarget>0?"WPM":"LPM";
    const grade=target>0?RT_GRADE(wpm,target):null;
    const ptsEarned=Math.min(tapped.size*3,150);
    return (
      <div className="fade-up" style={{minHeight:"calc(100vh - 56px)",background:"#FFF9F0",paddingBottom:90,paddingTop:8}}>
        <div style={{padding:"0 20px"}}>

          {/* Score hero */}
          <div style={{background:`linear-gradient(135deg,${meta.color},${meta.color}99)`,
            borderRadius:22,padding:"24px 20px",marginBottom:16,textAlign:"center",color:"#fff"}}>
            <div style={{fontSize:12,opacity:.85}}>{meta.icon} {meta.label} Â· {passTitle}</div>
            <div style={{background:"rgba(255,255,255,.2)",borderRadius:18,padding:"14px 20px",marginTop:14,marginBottom:12}}>
              <div style={{fontSize:11,opacity:.85}}>Your Reading Speed</div>
              <div style={{fontSize:64,fontWeight:900,lineHeight:1,marginTop:3}}>{wpm}</div>
              <div style={{fontSize:15,fontWeight:700}}>{unit}</div>
              {target>0&&<div style={{fontSize:11,opacity:.8,marginTop:3}}>Target: {target} {unit} Â· {wpm>=target?"âœ… Achieved!":target-wpm+" more to go"}</div>}
            </div>
            {grade&&<div className="pop-in" style={{background:"rgba(255,255,255,.25)",borderRadius:14,padding:"10px 16px",marginBottom:10}}>
              <div style={{fontSize:40,fontWeight:900}}>{grade.g}</div>
              <div style={{fontSize:13,fontWeight:700}}>{grade.label}</div>
            </div>}
            {passMoral&&<div style={{background:"rgba(255,255,255,.2)",borderRadius:12,padding:"8px 14px",marginBottom:10,fontSize:11}}><span className="hin">ğŸ’¡ {passMoral}</span></div>}
            {selLevel==="c2"&&<div style={{fontSize:10,opacity:.8}}>Stories: {storyHist.count} Â· Next: difficulty {storyHist.difficulty}/10</div>}
            <div style={{fontSize:11,opacity:.85,marginTop:6}}>+{ptsEarned} pts Â· {tapped.size}/{tokens.length} words</div>
          </div>

          {/* Stats row */}
          <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:10,marginBottom:16}}>
            {[["â±ï¸",timeStr,"Time"],["âœ…",tapped.size,"Read"],["ğŸ†",prevBest[selLevel]||wpm,"Best"]].map(([ic,v,l])=>(
              <div key={l} style={{background:"#fff",borderRadius:14,padding:"12px 8px",textAlign:"center",boxShadow:"0 2px 10px rgba(0,0,0,.07)"}}>
                <div style={{fontSize:20}}>{ic}</div>
                <div style={{fontWeight:900,fontSize:18,color:"#333",marginTop:2}}>{v}</div>
                <div style={{fontSize:9,color:"#888",marginTop:2}}>{l}</div>
              </div>
            ))}
          </div>

          {/* ğŸ§ PLAYBACK */}
          <div style={{marginBottom:16}}>
            <div style={{fontWeight:800,fontSize:14,color:"#333",marginBottom:10,display:"flex",alignItems:"center",gap:8}}>
              <span style={{fontSize:22}}>ğŸ§</span> Listen to Your Reading
            </div>
            {audioURL?(
              <>
                <AudioPlayer url={audioURL} color={meta.color}/>
                <div style={{marginTop:8,background:"#E8F5E9",borderRadius:10,padding:"9px 13px",fontSize:11,color:"#2e7d32",fontWeight:600}}>
                  ğŸ’¡ Tap â–¶ to hear your voice! Notice your pronunciation and pace.
                </div>
              </>
            ):(
              <div style={{background:"#FFF8E1",borderRadius:12,padding:"14px 16px",border:"1px solid #FFE082",display:"flex",alignItems:"center",gap:12}}>
                <span style={{fontSize:28}}>â³</span>
                <div>
                  <div style={{fontSize:12,fontWeight:700,color:"#F57F17"}}>
                    {micStep==="denied"||micStep==="unsupported"
                      ?"Recording not available â€” mic was not enabled"
                      :"Recording being saved..."}
                  </div>
                  <div style={{fontSize:11,color:"#888",marginTop:2}}>
                    {micStep==="denied"||micStep==="unsupported"
                      ?"Enable microphone before starting next test"
                      :"Should appear in a few seconds"}
                  </div>
                </div>
              </div>
            )}
          </div>

          {/* Grading */}
          {meta.wpmTarget>0&&(
            <div style={{background:"#fff",borderRadius:16,padding:"13px 16px",marginBottom:14,boxShadow:"0 2px 10px rgba(0,0,0,.06)"}}>
              <div style={{fontWeight:700,fontSize:12,color:"#555",marginBottom:8}}>ğŸ“Š Grading Scale (Target: {meta.wpmTarget} WPM)</div>
              {[["A+",`${Math.round(meta.wpmTarget*1.1)}+ WPM`,"#43A047"],
                ["A", `${Math.round(meta.wpmTarget*.9)}â€“${Math.round(meta.wpmTarget*1.1)-1} WPM`,"#43A047"],
                ["B+",`${Math.round(meta.wpmTarget*.75)}â€“${Math.round(meta.wpmTarget*.9)-1} WPM`,"#1E88E5"],
                ["B", `${Math.round(meta.wpmTarget*.6)}â€“${Math.round(meta.wpmTarget*.75)-1} WPM`,"#1E88E5"],
                ["C", `${Math.round(meta.wpmTarget*.4)}â€“${Math.round(meta.wpmTarget*.6)-1} WPM`,"#FB8C00"],
                ["D", `Below ${Math.round(meta.wpmTarget*.4)} WPM`,"#E53935"]
              ].map(([g,range,color])=>{
                const mine=grade&&grade.g===g;
                return(<div key={g} style={{display:"flex",alignItems:"center",gap:10,
                  padding:"5px 8px",borderRadius:8,marginBottom:3,
                  background:mine?`${color}15`:"transparent",border:mine?`2px solid ${color}`:"2px solid transparent"}}>
                  <div style={{fontWeight:900,fontSize:13,color,width:26}}>{g}</div>
                  <div style={{fontSize:11,color:"#666",flex:1}}>{range}</div>
                  {mine&&<div style={{fontSize:14}}>â† You</div>}
                </div>);
              })}
            </div>
          )}

          {/* Actions */}
          <div style={{display:"flex",gap:10,marginBottom:10}}>
            <Btn onClick={tryAgain} color={meta.color} style={{flex:1,padding:14}}>ğŸ”„ New Passage</Btn>
            <Btn onClick={()=>setPhase("select")} color="#555" style={{flex:1,padding:14}}>ğŸ“‹ All Levels</Btn>
          </div>
          {selLevel!=="c2"&&(
            <Btn onClick={async()=>{
              const idx=RT_LEVELS_META.findIndex(l=>l.id===selLevel);
              if(idx<RT_LEVELS_META.length-1) await selectLevel(RT_LEVELS_META[idx+1].id);
            }} color="#8E24AA" style={{width:"100%",padding:13}}>â¬†ï¸ Try Next Level</Btn>
          )}
        </div>
      </div>
    );
  }

  return null;
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ROOT APP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
export default function App() {
  const [screen,    setScreen]    = useState("home");
  const [user,      setUser]      = useState(null);
  const [authReady, setAuthReady] = useState(false); // prevents flash before session check

  // Inject fonts
  useEffect(() => {
    const el = document.createElement("style");
    el.textContent = STYLES;
    document.head.appendChild(el);
    return () => document.head.removeChild(el);
  }, []);

  // â”€â”€ Restore session on mount â”€â”€
  useEffect(() => {
    const token = sessionGet();
    if (token) {
      const email = tokenEmail(token);
      if (email) {
        const saved = dbFindByEmail(email);
        if (saved) {
          setUser({ ...saved });
          setScreen("home");
          setAuthReady(true);
          return;
        }
      }
    }
    sessionClear();
    setAuthReady(true);
  }, []);

  // â”€â”€ Auth success handler â”€â”€
  const handleAuthSuccess = (u) => {
    setUser(u);
    setScreen("home");
  };

  // â”€â”€ Logout â”€â”€
  const handleLogout = () => {
    sessionClear();
    setUser(null);
    setScreen("home");
  };

  // â”€â”€ Persist user changes (points, wpm etc.) back to DB â”€â”€
  const updateUser = (u) => {
    setUser(u);
    if (u && u.email) dbUpdateUser(u.email, u);
  };

  // â”€â”€ Show nothing until session check is done â”€â”€
  if (!authReady) return (
    <div style={{ minHeight:"100vh", display:"flex", alignItems:"center",
      justifyContent:"center", background:"#FFF9F0" }}>
      <div style={{ textAlign:"center" }}>
        <div style={{ fontSize:60 }}>ğŸ“š</div>
        <div className="hin" style={{ fontSize:22, fontWeight:900, color:"#FF7043", marginTop:10 }}>
          à¤¹à¤¿à¤‚à¤¦à¥€ à¤ªà¤¾à¤ à¤¶à¤¾à¤²à¤¾
        </div>
        <div style={{ marginTop:12, color:"#aaa", fontSize:13 }}>Loading...</div>
      </div>
    </div>
  );

  // â”€â”€ GATE: if not logged in, always show AuthScreen â”€â”€
  if (!user) return (
    <div style={{ maxWidth:480, margin:"0 auto", minHeight:"100vh" }}>
      <AuthScreen onAuthSuccess={handleAuthSuccess} />
    </div>
  );

  const showNav = screen !== "teacher";

  const renderScreen = () => {
    if (screen === "teacher") return <TeacherScreen setScreen={setScreen} />;
    switch (screen) {
      case "home":        return <HomeScreen user={user} setUser={updateUser} setScreen={setScreen} />;
      case "learn":       return <LearnScreen user={user} setUser={updateUser} />;
      case "reading":     return <ReadingTestScreen user={user} setUser={updateUser} />;
      case "practice":    return <QuizScreen  user={user} setUser={updateUser} />;
      case "endless":     return <EndlessScreen user={user} setUser={updateUser} />;
      case "leaderboard": return <LeaderboardScreen user={user} />;
      case "dashboard":   return <DashboardScreen user={user} setUser={updateUser} setScreen={setScreen} onLogout={handleLogout} />;
      default:            return <HomeScreen user={user} setUser={updateUser} setScreen={setScreen} />;
    }
  };

  return (
    <div style={{ maxWidth:480, margin:"0 auto", minHeight:"100vh",
      background:"#FFF9F0", position:"relative" }}>
      {showNav && <TopBar user={user} screen={screen} setScreen={setScreen} />}
      <div style={{ paddingBottom: showNav ? 60 : 0 }}>
        {renderScreen()}
      </div>
      {showNav && <BottomNav screen={screen} setScreen={setScreen} />}
    </div>
  );
}
